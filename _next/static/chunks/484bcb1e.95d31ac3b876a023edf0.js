(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{"6Joi":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var r,i=n("mrSG"),o=(r=n("wj3C"))&&"object"==typeof r&&"default"in r?r.default:r,s=n("q/0M"),u=n("zVF4"),a=n("x7I3"),c=n("S+S0"),h=o.SDK_VERSION,f=new s.Logger("@firebase/firestore");function l(){return f.logLevel}function p(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(f.logLevel<=s.LogLevel.DEBUG){var r=e.map(y);f.debug.apply(f,i.__spreadArrays(["Firestore ("+h+"): "+t],r))}}function d(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(f.logLevel<=s.LogLevel.ERROR){var r=e.map(y);f.error.apply(f,i.__spreadArrays(["Firestore ("+h+"): "+t],r))}}function y(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function v(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE ("+h+") INTERNAL ASSERTION FAILED: "+t;throw d(e),new Error(e)}function g(t,e){t||v()}function m(t,e){return t}function w(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var _=function(){function t(){}return t.t=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=w(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function b(t,e){return t<e?-1:t>e?1:0}function I(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function E(t){return t+"\0"}var T=function(t,e,n,r,i){this.s=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i},N=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"i",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t.prototype.o=function(t){return b(this.projectId,t.projectId)||b(this.database,t.database)},t}();function A(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function x(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function D(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var S=function(){function t(t,e){this.h=t,this.u=e,this.l={}}return t.prototype.get=function(t){var e=this.h(t),n=this.l[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];if(this.u(s,t))return u}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.h(t),r=this.l[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.u(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.l[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.h(t),n=this.l[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.u(n[r][0],t))return 1===n.length?delete this.l[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){x(this.l,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];t(s,u)}}))},t.prototype._=function(){return D(this.l)},t}(),k={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},P=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return i.__extends(e,t),e}(Error),L=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new P(k.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new P(k.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new P(k.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new P(k.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype.T=function(t){return this.seconds===t.seconds?b(this.nanoseconds,t.nanoseconds):b(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),O=function(){function t(t){this.timestamp=t}return t.I=function(e){return new t(e)},t.min=function(){return new t(new L(0,0))},t.prototype.o=function(t){return this.timestamp.T(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.m=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.A=function(){return this.timestamp},t}(),R=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&v(),void 0===n?n=t.length-e:n>t.length-e&&v(),this.segments=t,this.offset=e,this.R=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.R},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.P(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.V(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.g=function(t){return t=void 0===t?1:t,this.V(this.segments,this.offset+t,this.length-t)},t.prototype.p=function(){return this.V(this.segments,this.offset,this.length-1)},t.prototype.v=function(){return this.segments[this.offset]},t.prototype.S=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype._=function(){return 0===this.length},t.prototype.D=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.C=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.F=function(){return this.segments.slice(this.offset,this.limit())},t.P=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),V=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.prototype.V=function(t,n,r){return new e(t,n,r)},e.prototype.N=function(){return this.F().join("/")},e.prototype.toString=function(){return this.N()},e.$=function(t){if(t.indexOf("//")>=0)throw new P(k.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new e(t.split("/").filter((function(t){return t.length>0})))},e.k=function(){return new e([])},e}(R),U=/^[_a-zA-Z][_a-zA-Z0-9]*$/,C=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.prototype.V=function(t,n,r){return new e(t,n,r)},e.M=function(t){return U.test(t)},e.prototype.N=function(){return this.F().map((function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),e.M(t)||(t="`"+t+"`"),t})).join(".")},e.prototype.toString=function(){return this.N()},e.prototype.O=function(){return 1===this.length&&"__name__"===this.get(0)},e.L=function(){return new e(["__name__"])},e.B=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new P(k.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var u=t[i];if("\\"===u){if(i+1===t.length)throw new P(k.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var a=t[i+1];if("\\"!==a&&"."!==a&&"`"!==a)throw new P(k.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=a,i+=2}else"`"===u?(s=!s,i++):"."!==u||s?(r+=u,i++):(o(),i++)}if(o(),s)throw new P(k.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.k=function(){return new e([])},e}(R),M=function(){function t(t){this.path=t}return t.q=function(e){return new t(V.$(e).g(5))},t.prototype.U=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===V.P(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.P=function(t,e){return V.P(t.path,e.path)},t.W=function(t){return t.length%2==0},t.j=function(e){return new t(new V(e.slice()))},t}();function F(t){return null==t}function q(t){return-0===t&&1/t==-1/0}function j(t){return"number"==typeof t&&Number.isInteger(t)&&!q(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var z=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.K=null};function B(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new z(t,e,n,r,i,o,s)}function G(t){var e=m(t);if(null===e.K){var n=e.path.N();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((function(t){return function(t){return t.field.N()+t.op.toString()+Vt(t.value)}(t)})).join(","),n+="|ob:",n+=e.orderBy.map((function(t){return(e=t).field.N()+e.dir;var e})).join(","),F(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=_n(e.startAt)),e.endAt&&(n+="|ub:",n+=_n(e.endAt)),e.K=n}return e.K}function Q(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!Nn(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if(i=t.filters[r],o=e.filters[r],!(i instanceof pn&&o instanceof pn&&i.op===o.op&&i.field.isEqual(o.field)&&Pt(i.value,o.value)))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!In(t.startAt,e.startAt)&&In(t.endAt,e.endAt)}function W(t){return M.W(t.path)&&null===t.collectionGroup&&0===t.filters.length}var $=function(){function t(t){this.G=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return t=this.G,btoa(t);var t},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.G)},t.prototype.H=function(){return 2*this.G.length},t.prototype.o=function(t){return b(this.G,t.G)},t.prototype.isEqual=function(t){return this.G===t.G},t}();$.Y=new $("");var K,H,J=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=O.min()),void 0===o&&(o=O.min()),void 0===s&&(s=$.Y),this.target=t,this.targetId=e,this.J=n,this.sequenceNumber=r,this.X=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.Z=function(e){return new t(this.target,this.targetId,this.J,e,this.X,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.tt=function(e,n){return new t(this.target,this.targetId,this.J,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.et=function(e){return new t(this.target,this.targetId,this.J,this.sequenceNumber,this.X,e,this.resumeToken)},t}(),Y=function(t){this.count=t};function X(t){switch(t){case k.OK:return v();case k.CANCELLED:case k.UNKNOWN:case k.DEADLINE_EXCEEDED:case k.RESOURCE_EXHAUSTED:case k.INTERNAL:case k.UNAVAILABLE:case k.UNAUTHENTICATED:return!1;case k.INVALID_ARGUMENT:case k.NOT_FOUND:case k.ALREADY_EXISTS:case k.PERMISSION_DENIED:case k.FAILED_PRECONDITION:case k.ABORTED:case k.OUT_OF_RANGE:case k.UNIMPLEMENTED:case k.DATA_LOSS:return!0;default:return v()}}function Z(t){if(void 0===t)return d("GRPC error has no .code"),k.UNKNOWN;switch(t){case K.OK:return k.OK;case K.CANCELLED:return k.CANCELLED;case K.UNKNOWN:return k.UNKNOWN;case K.DEADLINE_EXCEEDED:return k.DEADLINE_EXCEEDED;case K.RESOURCE_EXHAUSTED:return k.RESOURCE_EXHAUSTED;case K.INTERNAL:return k.INTERNAL;case K.UNAVAILABLE:return k.UNAVAILABLE;case K.UNAUTHENTICATED:return k.UNAUTHENTICATED;case K.INVALID_ARGUMENT:return k.INVALID_ARGUMENT;case K.NOT_FOUND:return k.NOT_FOUND;case K.ALREADY_EXISTS:return k.ALREADY_EXISTS;case K.PERMISSION_DENIED:return k.PERMISSION_DENIED;case K.FAILED_PRECONDITION:return k.FAILED_PRECONDITION;case K.ABORTED:return k.ABORTED;case K.OUT_OF_RANGE:return k.OUT_OF_RANGE;case K.UNIMPLEMENTED:return k.UNIMPLEMENTED;case K.DATA_LOSS:return k.DATA_LOSS;default:return v()}}(H=K||(K={}))[H.OK=0]="OK",H[H.CANCELLED=1]="CANCELLED",H[H.UNKNOWN=2]="UNKNOWN",H[H.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",H[H.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",H[H.NOT_FOUND=5]="NOT_FOUND",H[H.ALREADY_EXISTS=6]="ALREADY_EXISTS",H[H.PERMISSION_DENIED=7]="PERMISSION_DENIED",H[H.UNAUTHENTICATED=16]="UNAUTHENTICATED",H[H.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",H[H.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",H[H.ABORTED=10]="ABORTED",H[H.OUT_OF_RANGE=11]="OUT_OF_RANGE",H[H.UNIMPLEMENTED=12]="UNIMPLEMENTED",H[H.INTERNAL=13]="INTERNAL",H[H.UNAVAILABLE=14]="UNAVAILABLE",H[H.DATA_LOSS=15]="DATA_LOSS";var tt=function(){function t(t,e){this.P=t,this.root=e||nt.EMPTY}return t.prototype.nt=function(e,n){return new t(this.P,this.root.nt(e,n,this.P).copy(null,null,nt.st,null,null))},t.prototype.remove=function(e){return new t(this.P,this.root.remove(e,this.P).copy(null,null,nt.st,null,null))},t.prototype.get=function(t){for(var e=this.root;!e._();){var n=this.P(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n._();){var r=this.P(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype._=function(){return this.root._()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.it=function(){return this.root.it()},t.prototype.rt=function(){return this.root.rt()},t.prototype.ot=function(t){return this.root.ot(t)},t.prototype.forEach=function(t){this.ot((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.ot((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.ht=function(t){return this.root.ht(t)},t.prototype.at=function(){return new et(this.root,null,this.P,!1)},t.prototype.ut=function(t){return new et(this.root,t,this.P,!1)},t.prototype.ct=function(){return new et(this.root,null,this.P,!0)},t.prototype.lt=function(t){return new et(this.root,t,this.P,!0)},t}(),et=function(){function t(t,e,n,r){this._t=r,this.ft=[];for(var i=1;!t._();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this._t?t.left:t.right;else{if(0===i){this.ft.push(t);break}this.ft.push(t),t=this._t?t.right:t.left}}return t.prototype.dt=function(){var t=this.ft.pop(),e={key:t.key,value:t.value};if(this._t)for(t=t.left;!t._();)this.ft.push(t),t=t.right;else for(t=t.right;!t._();)this.ft.push(t),t=t.left;return e},t.prototype.wt=function(){return this.ft.length>0},t.prototype.Tt=function(){if(0===this.ft.length)return null;var t=this.ft[this.ft.length-1];return{key:t.key,value:t.value}},t}(),nt=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype._=function(){return!1},t.prototype.ot=function(t){return this.left.ot(t)||t(this.key,this.value)||this.right.ot(t)},t.prototype.ht=function(t){return this.right.ht(t)||t(this.key,this.value)||this.left.ht(t)},t.prototype.min=function(){return this.left._()?this:this.left.min()},t.prototype.it=function(){return this.min().key},t.prototype.rt=function(){return this.right._()?this.key:this.right.rt()},t.prototype.nt=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.nt(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.nt(t,e,n))).Et()},t.prototype.It=function(){if(this.left._())return t.EMPTY;var e=this;return e.left.At()||e.left.left.At()||(e=e.Rt()),(e=e.copy(null,null,null,e.left.It(),null)).Et()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left._()||i.left.At()||i.left.left.At()||(i=i.Rt()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.At()&&(i=i.Pt()),i.right._()||i.right.At()||i.right.left.At()||(i=i.Vt()),0===n(e,i.key)){if(i.right._())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.It())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.Et()},t.prototype.At=function(){return this.color},t.prototype.Et=function(){var t=this;return t.right.At()&&!t.left.At()&&(t=t.gt()),t.left.At()&&t.left.left.At()&&(t=t.Pt()),t.left.At()&&t.right.At()&&(t=t.yt()),t},t.prototype.Rt=function(){var t=this.yt();return t.right.left.At()&&(t=(t=(t=t.copy(null,null,null,null,t.right.Pt())).gt()).yt()),t},t.prototype.Vt=function(){var t=this.yt();return t.left.left.At()&&(t=(t=t.Pt()).yt()),t},t.prototype.gt=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.Pt=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.yt=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.pt=function(){var t=this.bt();return Math.pow(2,t)<=this.size+1},t.prototype.bt=function(){if(this.At()&&this.left.At())throw v();if(this.right.At())throw v();var t=this.left.bt();if(t!==this.right.bt())throw v();return t+(this.At()?0:1)},t}();nt.EMPTY=null,nt.RED=!0,nt.st=!1,nt.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw v()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw v()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw v()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw v()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw v()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.nt=function(t,e,n){return new nt(t,e)},t.prototype.remove=function(t,e){return this},t.prototype._=function(){return!0},t.prototype.ot=function(t){return!1},t.prototype.ht=function(t){return!1},t.prototype.it=function(){return null},t.prototype.rt=function(){return null},t.prototype.At=function(){return!1},t.prototype.pt=function(){return!0},t.prototype.bt=function(){return 0},t}());var rt=function(){function t(t){this.P=t,this.data=new tt(this.P)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.it()},t.prototype.last=function(){return this.data.rt()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.ot((function(e,n){return t(e),!1}))},t.prototype.vt=function(t,e){for(var n=this.data.ut(t[0]);n.wt();){var r=n.dt();if(this.P(r.key,t[1])>=0)return;e(r.key)}},t.prototype.St=function(t,e){var n;for(n=void 0!==e?this.data.ut(e):this.data.at();n.wt();)if(!t(n.dt().key))return},t.prototype.Dt=function(t){var e=this.data.ut(t);return e.wt()?e.dt().key:null},t.prototype.at=function(){return new it(this.data.at())},t.prototype.ut=function(t){return new it(this.data.ut(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).nt(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype._=function(){return this.data._()},t.prototype.Ct=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.at(),r=e.data.at();n.wt();){var i=n.dt().key,o=r.dt().key;if(0!==this.P(i,o))return!1}return!0},t.prototype.F=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.P);return n.data=e,n},t}(),it=function(){function t(t){this.Ft=t}return t.prototype.dt=function(){return this.Ft.dt().key},t.prototype.wt=function(){return this.Ft.wt()},t}(),ot=new tt(M.P);function st(){return ot}function ut(){return st()}var at=new tt(M.P);function ct(){return at}var ht=new tt(M.P),ft=new rt(M.P);function lt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=ft,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var pt=new rt(b);function dt(){return pt}var yt=function(){function t(t){this.P=t?function(e,n){return t(e,n)||M.P(e.key,n.key)}:function(t,e){return M.P(t.key,e.key)},this.Nt=ct(),this.$t=new tt(this.P)}return t.kt=function(e){return new t(e.P)},t.prototype.has=function(t){return null!=this.Nt.get(t)},t.prototype.get=function(t){return this.Nt.get(t)},t.prototype.first=function(){return this.$t.it()},t.prototype.last=function(){return this.$t.rt()},t.prototype._=function(){return this.$t._()},t.prototype.indexOf=function(t){var e=this.Nt.get(t);return e?this.$t.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.$t.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.$t.ot((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.Nt.nt(t.key,t),e.$t.nt(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.Nt.remove(t),this.$t.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.$t.at(),r=e.$t.at();n.wt();){var i=n.dt().key,o=r.dt().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.P=this.P,r.Nt=e,r.$t=n,r},t}(),vt=function(){function t(){this.xt=new tt(M.P)}return t.prototype.track=function(t){var e=t.doc.key,n=this.xt.get(e);n?0!==t.type&&3===n.type?this.xt=this.xt.nt(e,t):3===t.type&&1!==n.type?this.xt=this.xt.nt(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.xt=this.xt.nt(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.xt=this.xt.nt(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.xt=this.xt.remove(e):1===t.type&&2===n.type?this.xt=this.xt.nt(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.xt=this.xt.nt(e,{type:2,doc:t.doc}):v():this.xt=this.xt.nt(e,t)},t.prototype.Mt=function(){var t=[];return this.xt.ot((function(e,n){t.push(n)})),t},t}(),gt=function(){function t(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.Ot=n,this.docChanges=r,this.Lt=i,this.fromCache=o,this.Bt=s,this.qt=u}return t.Ut=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:0,doc:t})})),new t(e,n,yt.kt(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.Lt._()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.Bt===t.Bt&&this.Lt.isEqual(t.Lt)&&an(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Ot.isEqual(t.Ot)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),mt=function(){function t(t,e,n,r,i){this.X=t,this.Qt=e,this.Wt=n,this.jt=r,this.Kt=i}return t.Gt=function(e,n){var r=new Map;return r.set(e,wt.zt(e,n)),new t(O.min(),r,dt(),st(),lt())},t}(),wt=function(){function t(t,e,n,r,i){this.resumeToken=t,this.Ht=e,this.Yt=n,this.Jt=r,this.Xt=i}return t.zt=function(e,n){return new t($.Y,n,lt(),lt(),lt())},t}(),_t=function(t,e,n,r){this.Zt=t,this.removedTargetIds=e,this.key=n,this.te=r},bt=function(t,e){this.targetId=t,this.ee=e},It=function(t,e,n,r){void 0===n&&(n=$.Y),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Et=function(){function t(){this.ne=0,this.se=At(),this.ie=$.Y,this.re=!1,this.oe=!0}return Object.defineProperty(t.prototype,"Ht",{get:function(){return this.re},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.ie},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"he",{get:function(){return 0!==this.ne},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ae",{get:function(){return this.oe},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){t.H()>0&&(this.oe=!0,this.ie=t)},t.prototype.ce=function(){var t=lt(),e=lt(),n=lt();return this.se.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:v()}})),new wt(this.ie,this.re,t,e,n)},t.prototype.le=function(){this.oe=!1,this.se=At()},t.prototype._e=function(t,e){this.oe=!0,this.se=this.se.nt(t,e)},t.prototype.fe=function(t){this.oe=!0,this.se=this.se.remove(t)},t.prototype.de=function(){this.ne+=1},t.prototype.we=function(){this.ne-=1},t.prototype.Te=function(){this.oe=!0,this.re=!0},t}(),Tt=function(){function t(t){this.Ee=t,this.Ie=new Map,this.me=st(),this.Ae=Nt(),this.Re=new rt(b)}return t.prototype.Pe=function(t){for(var e=0,n=t.Zt;e<n.length;e++){var r=n[e];t.te instanceof rn?this.Ve(r,t.te):t.te instanceof on&&this.ge(r,t.key,t.te)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var s=o[i];this.ge(s,t.key,t.te)}},t.prototype.ye=function(t){var e=this;this.pe(t,(function(n){var r=e.be(n);switch(t.state){case 0:e.ve(n)&&r.ue(t.resumeToken);break;case 1:r.we(),r.he||r.le(),r.ue(t.resumeToken);break;case 2:r.we(),r.he||e.removeTarget(n);break;case 3:e.ve(n)&&(r.Te(),r.ue(t.resumeToken));break;case 4:e.ve(n)&&(e.Se(n),r.ue(t.resumeToken));break;default:v()}}))},t.prototype.pe=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.Ie.forEach((function(t,r){n.ve(r)&&e(r)}))},t.prototype.De=function(t){var e=t.targetId,n=t.ee.count,r=this.Ce(e);if(r){var i=r.target;if(W(i))if(0===n){var o=new M(i.path);this.ge(e,o,new on(o,O.min()))}else g(1===n);else this.Fe(e)!==n&&(this.Se(e),this.Re=this.Re.add(e))}},t.prototype.Ne=function(t){var e=this,n=new Map;this.Ie.forEach((function(r,i){var o=e.Ce(i);if(o){if(r.Ht&&W(o.target)){var s=new M(o.target.path);null!==e.me.get(s)||e.$e(i,s)||e.ge(i,s,new on(s,t))}r.ae&&(n.set(i,r.ce()),r.le())}}));var r=lt();this.Ae.forEach((function(t,n){var i=!0;n.St((function(t){var n=e.Ce(t);return!n||2===n.J||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new mt(t,n,this.Re,this.me,r);return this.me=st(),this.Ae=Nt(),this.Re=new rt(b),i},t.prototype.Ve=function(t,e){if(this.ve(t)){var n=this.$e(t,e.key)?2:0;this.be(t)._e(e.key,n),this.me=this.me.nt(e.key,e),this.Ae=this.Ae.nt(e.key,this.ke(e.key).add(t))}},t.prototype.ge=function(t,e,n){if(this.ve(t)){var r=this.be(t);this.$e(t,e)?r._e(e,1):r.fe(e),this.Ae=this.Ae.nt(e,this.ke(e).delete(t)),n&&(this.me=this.me.nt(e,n))}},t.prototype.removeTarget=function(t){this.Ie.delete(t)},t.prototype.Fe=function(t){var e=this.be(t).ce();return this.Ee.xe(t).size+e.Yt.size-e.Xt.size},t.prototype.de=function(t){this.be(t).de()},t.prototype.be=function(t){var e=this.Ie.get(t);return e||(e=new Et,this.Ie.set(t,e)),e},t.prototype.ke=function(t){var e=this.Ae.get(t);return e||(e=new rt(b),this.Ae=this.Ae.nt(t,e)),e},t.prototype.ve=function(t){var e=null!==this.Ce(t);return e||p("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.Ce=function(t){var e=this.Ie.get(t);return e&&e.he?null:this.Ee.Me(t)},t.prototype.Se=function(t){var e=this;this.Ie.set(t,new Et),this.Ee.xe(t).forEach((function(n){e.ge(t,n,null)}))},t.prototype.$e=function(t,e){return this.Ee.xe(t).has(e)},t}();function Nt(){return new tt(M.P)}function At(){return new tt(M.P)}function xt(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Dt(t){var e=Ut(t.mapValue.fields.__local_write_time__.timestampValue);return new L(e.seconds,e.nanos)}var St=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function kt(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?xt(t)?4:10:v()}function Pt(t,e){var n=kt(t);if(n!==kt(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Dt(t).isEqual(Dt(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=Ut(t.timestampValue),r=Ut(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Mt(t.bytesValue).isEqual(Mt(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Ct(t.geoPointValue.latitude)===Ct(e.geoPointValue.latitude)&&Ct(t.geoPointValue.longitude)===Ct(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Ct(t.integerValue)===Ct(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=Ct(t.doubleValue),r=Ct(e.doubleValue);return n===r?q(n)===q(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return I(t.arrayValue.values||[],e.arrayValue.values||[],Pt);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(A(n)!==A(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Pt(n[i],r[i])))return!1;return!0}(t,e);default:return v()}}function Lt(t,e){return void 0!==(t.values||[]).find((function(t){return Pt(t,e)}))}function Ot(t,e){var n=kt(t),r=kt(e);if(n!==r)return b(n,r);switch(n){case 0:return 0;case 1:return b(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=Ct(t.integerValue||t.doubleValue),r=Ct(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Rt(t.timestampValue,e.timestampValue);case 4:return Rt(Dt(t),Dt(e));case 5:return b(t.stringValue,e.stringValue);case 6:return function(t,e){var n=Mt(t),r=Mt(e);return n.o(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=b(n[i],r[i]);if(0!==o)return o}return b(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=b(Ct(t.latitude),Ct(e.latitude));return 0!==n?n:b(Ct(t.longitude),Ct(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Ot(n[i],r[i]);if(o)return o}return b(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=b(r[s],o[s]);if(0!==u)return u;var a=Ot(n[r[s]],i[o[s]]);if(0!==a)return a}return b(r.length,o.length)}(t.mapValue,e.mapValue);default:throw v()}}function Rt(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return b(t,e);var n=Ut(t),r=Ut(e),i=b(n.seconds,r.seconds);return 0!==i?i:b(n.nanos,r.nanos)}function Vt(t){return function t(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(t){var e=Ut(t);return"time("+e.seconds+","+e.nanos+")"}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Mt(e.bytesValue).toBase64():"referenceValue"in e?(r=e.referenceValue,M.q(r).toString()):"geoPointValue"in e?"geo("+(n=e.geoPointValue).latitude+","+n.longitude+")":"arrayValue"in e?function(e){for(var n="[",r=!0,i=0,o=e.values||[];i<o.length;i++){var s=o[i];r?r=!1:n+=",",n+=t(s)}return n+"]"}(e.arrayValue):"mapValue"in e?function(e){for(var n="{",r=!0,i=0,o=Object.keys(e.fields||{}).sort();i<o.length;i++){var s=o[i];r?r=!1:n+=",",n+=s+":"+t(e.fields[s])}return n+"}"}(e.mapValue):v();var n,r}(t)}function Ut(t){if(g(!!t),"string"==typeof t){var e=0,n=St.exec(t);if(g(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Ct(t.seconds),nanos:Ct(t.nanos)}}function Ct(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Mt(t){return"string"==typeof t?$.fromBase64String(t):$.fromUint8Array(t)}function Ft(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.N()}}function qt(t){return!!t&&"integerValue"in t}function jt(t){return!!t&&"arrayValue"in t}function zt(t){return!!t&&"nullValue"in t}function Bt(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Gt(t){return!!t&&"mapValue"in t}var Qt={asc:"ASCENDING",desc:"DESCENDING"},Wt={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","array-contains-any":"ARRAY_CONTAINS_ANY"},$t=function(t,e){this.s=t,this.Oe=e};function Kt(t){return{integerValue:""+t}}function Ht(t,e){if(t.Oe){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:q(e)?"-0":e}}function Jt(t,e){return j(e)?Kt(e):Ht(t,e)}function Yt(t,e){return t.Oe?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function Xt(t,e){return t.Oe?e.toBase64():e.toUint8Array()}function Zt(t,e){return Yt(t,e.A())}function te(t){return g(!!t),O.I(function(t){var e=Ut(t);return new L(e.seconds,e.nanos)}(t))}function ee(t,e){return function(t){return new V(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).N()}function ne(t){var e=V.$(t);return g(be(e)),e}function re(t,e){return ee(t.s,e.path)}function ie(t,e){var n=ne(e);return g(n.get(1)===t.s.projectId),g(!n.get(3)&&!t.s.database||n.get(3)===t.s.database),new M(ae(n))}function oe(t,e){return ee(t.s,e)}function se(t){var e=ne(t);return 4===e.length?V.k():ae(e)}function ue(t){return new V(["projects",t.s.projectId,"databases",t.s.database]).N()}function ae(t){return g(t.length>4&&"documents"===t.get(4)),t.g(5)}function ce(t,e,n){return{name:re(t,e),fields:n.proto.mapValue.fields}}function he(t,e){var n;if(e instanceof Qe)n={update:ce(t,e.key,e.value)};else if(e instanceof Ye)n={delete:re(t,e.key)};else if(e instanceof We)n={update:ce(t,e.key,e.data),updateMask:_e(e.Le)};else if(e instanceof Ke)n={transform:{document:re(t,e.key),fieldTransforms:e.fieldTransforms.map((function(t){return function(t,e){var n=e.transform;if(n instanceof Ae)return{fieldPath:e.field.N(),setToServerValue:"REQUEST_TIME"};if(n instanceof xe)return{fieldPath:e.field.N(),appendMissingElements:{values:n.elements}};if(n instanceof Se)return{fieldPath:e.field.N(),removeAllFromArray:{values:n.elements}};if(n instanceof Pe)return{fieldPath:e.field.N(),increment:n.Be};throw v()}(0,t)}))}};else{if(!(e instanceof Xe))return v();n={verify:re(t,e.key)}}return e.Ue.qe||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Zt(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:v()}(t,e.Ue)),n}function fe(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?Ce.updateTime(te(t.updateTime)):void 0!==t.exists?Ce.exists(t.exists):Ce.Qe()}(e.currentDocument):Ce.Qe();if(e.update){e.update.name;var r=ie(t,e.update.name),i=new Ze({mapValue:{fields:e.update.fields}});if(e.updateMask){var o=function(t){var e=t.fieldPaths||[];return new Re(e.map((function(t){return C.B(t)})))}(e.updateMask);return new We(r,i,o,n)}return new Qe(r,i,n)}if(e.delete){var s=ie(t,e.delete);return new Ye(s,n)}if(e.transform){var u=ie(t,e.transform.document),a=e.transform.fieldTransforms.map((function(e){return function(t,e){var n=null;if("setToServerValue"in e)g("REQUEST_TIME"===e.setToServerValue),n=new Ae;else if("appendMissingElements"in e){var r=e.appendMissingElements.values||[];n=new xe(r)}else if("removeAllFromArray"in e){var i=e.removeAllFromArray.values||[];n=new Se(i)}else"increment"in e?n=new Pe(t,e.increment):v();var o=C.B(e.fieldPath);return new Ve(o,n)}(t,e)}));return g(!0===n.exists),new Ke(u,a)}if(e.verify){var c=ie(t,e.verify);return new Xe(c,n)}return v()}function le(t,e){return{documents:[oe(t,e.path)]}}function pe(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=oe(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=oe(t,r.p()),n.structuredQuery.from=[{collectionId:r.S()}]);var i=function(t){if(0!==t.length){var e=t.map((function(t){return t instanceof pn?function(t){if("=="===t.op){if(Bt(t.value))return{unaryFilter:{field:ve(t.field),op:"IS_NAN"}};if(zt(t.value))return{unaryFilter:{field:ve(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:ve(t.field),op:(e=t.op,Wt[e]),value:t.value}};var e}(t):v()}));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map((function(t){return{field:ve((e=t).field),direction:(n=e.dir,Qt[n])};var e,n}))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.Oe||F(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=de(e.startAt)),e.endAt&&(n.structuredQuery.endAt=de(e.endAt)),n}function de(t){return{before:t.before,values:t.position}}function ye(t){var e=!!t.before,n=t.values||[];return new wn(n,e)}function ve(t){return{fieldPath:t.N()}}function ge(t){return C.B(t.fieldPath)}function me(t){return pn.create(ge(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return v()}}(t.fieldFilter.op),t.fieldFilter.value)}function we(t){switch(t.unaryFilter.op){case"IS_NAN":var e=ge(t.unaryFilter.field);return pn.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=ge(t.unaryFilter.field);return pn.create(n,"==",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return v()}}function _e(t){var e=[];return t.fields.forEach((function(t){return e.push(t.N())})),{fieldPaths:e}}function be(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}var Ie=function(){this.je=void 0};function Ee(t,e,n){return t instanceof Ae?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof xe?De(t,e):t instanceof Se?ke(t,e):function(t,e){var n=Ne(t,e),r=Le(n)+Le(t.Be);return qt(n)&&qt(t.Be)?Kt(r):Ht(t.serializer,r)}(t,e)}function Te(t,e,n){return t instanceof xe?De(t,e):t instanceof Se?ke(t,e):n}function Ne(t,e){return t instanceof Pe?qt(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var Ae=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e}(Ie),xe=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return i.__extends(e,t),e}(Ie);function De(t,e){for(var n=Oe(e),r=function(t){n.some((function(e){return Pt(e,t)}))||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Se=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return i.__extends(e,t),e}(Ie);function ke(t,e){for(var n=Oe(e),r=function(t){n=n.filter((function(e){return!Pt(e,t)}))},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Pe=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).serializer=e,r.Be=n,r}return i.__extends(e,t),e}(Ie);function Le(t){return Ct(t.integerValue||t.doubleValue)}function Oe(t){return jt(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var Re=function(){function t(t){this.fields=t,t.sort(C.P)}return t.prototype.Ke=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].D(t))return!0;return!1},t.prototype.isEqual=function(t){return I(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},t}(),Ve=function(t,e){this.field=t,this.transform=e},Ue=function(t,e){this.version=t,this.transformResults=e},Ce=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.Qe=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"qe",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function Me(t,e){return void 0!==t.updateTime?e instanceof rn&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof rn}var Fe=function(){};function qe(t,e,n){return t instanceof Qe?function(t,e,n){return new rn(t.key,n.version,t.value,{hasCommittedMutations:!0})}(t,0,n):t instanceof We?function(t,e,n){if(!Me(t.Ue,e))return new sn(t.key,n.version);var r=$e(t,e);return new rn(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):t instanceof Ke?function(t,e,n){if(g(null!=n.transformResults),!Me(t.Ue,e))return new sn(t.key,n.version);var r=He(t,e),i=function(t,e,n){var r=[];g(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,u=null;e instanceof rn&&(u=e.field(o.field)),r.push(Te(s,u,n[i]))}return r}(t.fieldTransforms,e,n.transformResults),o=n.version,s=Je(t,r.data(),i);return new rn(t.key,o,s,{hasCommittedMutations:!0})}(t,e,n):function(t,e,n){return new on(t.key,n.version,{hasCommittedMutations:!0})}(t,0,n)}function je(t,e,n,r){return t instanceof Qe?function(t,e){if(!Me(t.Ue,e))return e;var n=Ge(e);return new rn(t.key,n,t.value,{Ge:!0})}(t,e):t instanceof We?function(t,e){if(!Me(t.Ue,e))return e;var n=Ge(e),r=$e(t,e);return new rn(t.key,n,r,{Ge:!0})}(t,e):t instanceof Ke?function(t,e,n,r){if(!Me(t.Ue,e))return e;var i=He(t,e),o=function(t,e,n,r){for(var i=[],o=0,s=t;o<s.length;o++){var u=s[o],a=u.transform,c=null;n instanceof rn&&(c=n.field(u.field)),null===c&&r instanceof rn&&(c=r.field(u.field)),i.push(Ee(a,c,e))}return i}(t.fieldTransforms,n,e,r),s=Je(t,i.data(),o);return new rn(t.key,i.version,s,{Ge:!0})}(t,e,r,n):function(t,e){return Me(t.Ue,e)?new on(t.key,O.min()):e}(t,e)}function ze(t,e){return t instanceof Ke?function(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e instanceof rn?e.field(o.field):void 0,u=Ne(o.transform,s||null);null!=u&&(n=null==n?(new tn).set(o.field,u):n.set(o.field,u))}return n?n.ze():null}(t,e):null}function Be(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Ue.isEqual(e.Ue)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.Le.isEqual(e.Le):2!==t.type||I(t.fieldTransforms,t.fieldTransforms,(function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof xe&&e instanceof xe||t instanceof Se&&e instanceof Se?I(t.elements,e.elements,Pt):t instanceof Pe&&e instanceof Pe?Pt(t.Be,e.Be):t instanceof Ae&&e instanceof Ae}(t.transform,e.transform)}(t,e)})))}function Ge(t){return t instanceof rn?t.version:O.min()}var Qe=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).key=e,i.value=n,i.Ue=r,i.type=0,i}return i.__extends(e,t),e}(Fe),We=function(t){function e(e,n,r,i){var o=this;return(o=t.call(this)||this).key=e,o.data=n,o.Le=r,o.Ue=i,o.type=1,o}return i.__extends(e,t),e}(Fe);function $e(t,e){return function(t,e){var n=new tn(e);return t.Le.fields.forEach((function(e){if(!e._()){var r=t.data.field(e);null!==r?n.set(e,r):n.delete(e)}})),n.ze()}(t,e instanceof rn?e.data():Ze.empty())}var Ke=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.fieldTransforms=n,r.type=2,r.Ue=Ce.exists(!0),r}return i.__extends(e,t),e}(Fe);function He(t,e){return e}function Je(t,e,n){for(var r=new tn(e),i=0;i<t.fieldTransforms.length;i++){var o=t.fieldTransforms[i];r.set(o.field,n[i])}return r.ze()}var Ye=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.Ue=n,r.type=3,r}return i.__extends(e,t),e}(Fe),Xe=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.Ue=n,r.type=4,r}return i.__extends(e,t),e}(Fe),Ze=function(){function t(t){this.proto=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t._())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!Gt(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.S()])||null},t.prototype.isEqual=function(t){return Pt(this.proto,t.proto)},t}(),tn=function(){function t(t){void 0===t&&(t=Ze.empty()),this.He=t,this.Ye=new Map}return t.prototype.set=function(t,e){return this.Je(t,e),this},t.prototype.delete=function(t){return this.Je(t,null),this},t.prototype.Je=function(t,e){for(var n=this.Ye,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map?n=o:o&&10===kt(o)?(o=new Map(Object.entries(o.mapValue.fields||{})),n.set(i,o),n=o):(o=new Map,n.set(i,o),n=o)}n.set(t.S(),e)},t.prototype.ze=function(){var t=this.Xe(C.k(),this.Ye);return null!=t?new Ze(t):this.He},t.prototype.Xe=function(t,e){var n=this,r=!1,i=this.He.field(t),o=Gt(i)?Object.assign({},i.mapValue.fields):{};return e.forEach((function(e,i){if(e instanceof Map){var s=n.Xe(t.child(i),e);null!=s&&(o[i]=s,r=!0)}else null!==e?(o[i]=e,r=!0):o.hasOwnProperty(i)&&(delete o[i],r=!0)})),r?{mapValue:{fields:o}}:null},t}();function en(t){var e=[];return x(t.fields||{},(function(t,n){var r=new C([t]);if(Gt(n)){var i=en(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++){var u=s[o];e.push(r.child(u))}}else e.push(r)})),new Re(e)}var nn=function(t,e){this.key=t,this.version=e},rn=function(t){function e(e,n,r,i){var o=this;return(o=t.call(this,e,n)||this).Ze=r,o.Ge=!!i.Ge,o.hasCommittedMutations=!!i.hasCommittedMutations,o}return i.__extends(e,t),e.prototype.field=function(t){return this.Ze.field(t)},e.prototype.data=function(){return this.Ze},e.prototype.tn=function(){return this.Ze.proto},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.Ge===t.Ge&&this.hasCommittedMutations===t.hasCommittedMutations&&this.Ze.isEqual(t.Ze)},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.Ze.toString()+", {hasLocalMutations: "+this.Ge+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.Ge||this.hasCommittedMutations},enumerable:!1,configurable:!0}),e}(nn),on=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n)||this).hasCommittedMutations=!(!r||!r.hasCommittedMutations),i}return i.__extends(e,t),e.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(nn),sn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(nn),un=function(){function t(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.en=n,this.filters=r,this.limit=i,this.nn=o,this.startAt=s,this.endAt=u,this.sn=null,this.rn=null,this.startAt&&this.on(this.startAt),this.endAt&&this.on(this.endAt)}return t.hn=function(e){return new t(e)},Object.defineProperty(t.prototype,"orderBy",{get:function(){if(null===this.sn){this.sn=[];var t=this.an(),e=this.un();if(null!==t&&null===e)t.O()||this.sn.push(new En(t)),this.sn.push(new En(C.L(),"asc"));else{for(var n=!1,r=0,i=this.en;r<i.length;r++){var o=i[r];this.sn.push(o),o.field.O()&&(n=!0)}if(!n){var s=this.en.length>0?this.en[this.en.length-1].dir:"asc";this.sn.push(new En(C.L(),s))}}}return this.sn},enumerable:!1,configurable:!0}),t.prototype.cn=function(e){var n=this.filters.concat([e]);return new t(this.path,this.collectionGroup,this.en.slice(),n,this.limit,this.nn,this.startAt,this.endAt)},t.prototype.ln=function(e){var n=this.en.concat([e]);return new t(this.path,this.collectionGroup,n,this.filters.slice(),this.limit,this.nn,this.startAt,this.endAt)},t.prototype._n=function(e){return new t(this.path,this.collectionGroup,this.en.slice(),this.filters.slice(),e,"F",this.startAt,this.endAt)},t.prototype.fn=function(e){return new t(this.path,this.collectionGroup,this.en.slice(),this.filters.slice(),e,"L",this.startAt,this.endAt)},t.prototype.dn=function(e){return new t(this.path,this.collectionGroup,this.en.slice(),this.filters.slice(),this.limit,this.nn,e,this.endAt)},t.prototype.wn=function(e){return new t(this.path,this.collectionGroup,this.en.slice(),this.filters.slice(),this.limit,this.nn,this.startAt,e)},t.prototype.Tn=function(e){return new t(e,null,this.en.slice(),this.filters.slice(),this.limit,this.nn,this.startAt,this.endAt)},t.prototype.En=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.en.length||1===this.en.length&&this.en[0].field.O())},t.prototype.In=function(){return!F(this.limit)&&"F"===this.nn},t.prototype.mn=function(){return!F(this.limit)&&"L"===this.nn},t.prototype.un=function(){return this.en.length>0?this.en[0].field:null},t.prototype.an=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof pn&&n.An())return n.field}return null},t.prototype.Rn=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof pn&&t.indexOf(r.op)>=0)return r.op}return null},t.prototype.Pn=function(){return W(this.We())},t.prototype.Vn=function(){return null!==this.collectionGroup},t.prototype.We=function(){if(!this.rn)if("F"===this.nn)this.rn=B(this.path,this.collectionGroup,this.orderBy,this.filters,this.limit,this.startAt,this.endAt);else{for(var t=[],e=0,n=this.orderBy;e<n.length;e++){var r=n[e],i="desc"===r.dir?"asc":"desc";t.push(new En(r.field,i))}var o=this.endAt?new wn(this.endAt.position,!this.endAt.before):null,s=this.startAt?new wn(this.startAt.position,!this.startAt.before):null;this.rn=B(this.path,this.collectionGroup,t,this.filters,this.limit,o,s)}return this.rn},t.prototype.on=function(t){},t}();function an(t,e){return Q(t.We(),e.We())&&t.nn===e.nn}function cn(t){return G(t.We())+"|lt:"+t.nn}function hn(t){return"Query(target="+function(t){var e=t.path.N();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map((function(t){return(e=t).field.N()+" "+e.op+" "+Vt(e.value);var e})).join(", ")+"]"),F(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map((function(t){return(e=t).field.N()+" ("+e.dir+")";var e})).join(", ")+"]"),t.startAt&&(e+=", startAt: "+_n(t.startAt)),t.endAt&&(e+=", endAt: "+_n(t.endAt)),"Target("+e+")"}(t.We())+"; limitType="+t.nn+")"}function fn(t,e){return function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.U(t.collectionGroup)&&t.path.D(n):M.W(t.path)?t.path.isEqual(n):t.path.C(n)}(t,e)&&function(t,e){for(var n=0,r=t.en;n<r.length;n++){var i=r[n];if(!i.field.O()&&null===e.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!bn(t.startAt,t.orderBy,e))&&(!t.endAt||!bn(t.endAt,t.orderBy,e))}(t,e)}function ln(t){return function(e,n){for(var r=!1,i=0,o=t.orderBy;i<o.length;i++){var s=o[i],u=Tn(s,e,n);if(0!==u)return u;r=r||s.field.O()}return 0}}var pn=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return i.__extends(e,t),e.create=function(t,n,r){if(t.O())return"in"===n?new yn(t,r):new dn(t,n,r);if(zt(r)){if("=="!==n)throw new P(k.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new e(t,n,r)}if(Bt(r)){if("=="!==n)throw new P(k.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new e(t,n,r)}return"array-contains"===n?new vn(t,r):"in"===n?new gn(t,r):"array-contains-any"===n?new mn(t,r):new e(t,n,r)},e.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&kt(this.value)===kt(e)&&this.gn(Ot(e,this.value))},e.prototype.gn=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case">":return t>0;case">=":return t>=0;default:return v()}},e.prototype.An=function(){return["<","<=",">",">="].indexOf(this.op)>=0},e}((function(){})),dn=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=M.q(r.referenceValue),i}return i.__extends(e,t),e.prototype.matches=function(t){var e=M.P(t.key,this.key);return this.gn(e)},e}(pn),yn=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=(n.arrayValue.values||[]).map((function(t){return M.q(t.referenceValue)})),r}return i.__extends(e,t),e.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},e}(pn),vn=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return i.__extends(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return jt(e)&&Lt(e.arrayValue,this.value)},e}(pn),gn=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return i.__extends(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&Lt(this.value.arrayValue,e)},e}(pn),mn=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return i.__extends(e,t),e.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!jt(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return Lt(e.value.arrayValue,t)}))},e}(pn),wn=function(t,e){this.position=t,this.before=e};function _n(t){return(t.before?"b":"a")+":"+t.position.map((function(t){return Vt(t)})).join(",")}function bn(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.O()?M.P(M.q(s.referenceValue),n.key):Ot(s,n.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function In(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!Pt(t.position[n],e.position[n]))return!1;return!0}var En=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Tn(t,e,n){var r=t.field.O()?M.P(e.key,n.key):function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?Ot(r,i):v()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return v()}}function Nn(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}var An=function(){function t(t,e,n,r){this.batchId=t,this.yn=e,this.baseMutations=n,this.mutations=r}return t.prototype.pn=function(t,e,n){for(var r=n.bn,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t)&&(e=qe(o,e,r[i]))}return e},t.prototype.vn=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=je(i,e,e,this.yn))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=je(a,e,o,this.yn))}return e},t.prototype.Sn=function(t){var e=this,n=t;return this.mutations.forEach((function(r){var i=e.vn(r.key,t.get(r.key));i&&(n=n.nt(r.key,i))})),n},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),lt())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&I(this.mutations,t.mutations,(function(t,e){return Be(t,e)}))&&I(this.baseMutations,t.baseMutations,(function(t,e){return Be(t,e)}))},t}(),xn=function(){function t(t,e,n,r){this.batch=t,this.Dn=e,this.bn=n,this.Cn=r}return t.from=function(e,n,r){g(e.mutations.length===r.length);for(var i=ht,o=e.mutations,s=0;s<o.length;s++)i=i.nt(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),Dn=function(){function t(t){var e=this;this.Fn=null,this.Nn=null,this.result=void 0,this.error=void 0,this.$n=!1,this.kn=!1,t((function(t){e.$n=!0,e.result=t,e.Fn&&e.Fn(t)}),(function(t){e.$n=!0,e.error=t,e.Nn&&e.Nn(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.kn&&v(),this.kn=!0,this.$n?this.error?this.xn(n,this.error):this.Mn(e,this.result):new t((function(t,i){r.Fn=function(n){r.Mn(e,n).next(t,i)},r.Nn=function(e){r.xn(n,e).next(t,i)}}))},t.prototype.On=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.Ln=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.Mn=function(e,n){return e?this.Ln((function(){return e(n)})):t.resolve(n)},t.prototype.xn=function(e,n){return e?this.Ln((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.Bn=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t()}),(function(t){return n(t)}))})),o=!0,i===r&&t()}))},t.qn=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.Bn(r)},t}(),Sn=function(){function t(){this.Un=new S((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.Qn=!1}return Object.defineProperty(t.prototype,"readTime",{get:function(){return this.Wn},set:function(t){this.Wn=t},enumerable:!1,configurable:!0}),t.prototype.jn=function(t,e){this.Kn(),this.readTime=e,this.Un.set(t.key,t)},t.prototype.Gn=function(t,e){this.Kn(),e&&(this.readTime=e),this.Un.set(t,null)},t.prototype.zn=function(t,e){this.Kn();var n=this.Un.get(e);return void 0!==n?Dn.resolve(n):this.Hn(t,e)},t.prototype.getEntries=function(t,e){return this.Yn(t,e)},t.prototype.apply=function(t){return this.Kn(),this.Qn=!0,this.Jn(t)},t.prototype.Kn=function(){},t}(),kn="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Pn=function(){function t(){this.Xn=[]}return t.prototype.Zn=function(t){this.Xn.push(t)},t.prototype.ts=function(){this.Xn.forEach((function(t){return t()}))},t}(),Ln=function(){function t(t,e,n){this.es=t,this.ns=e,this.ss=n}return t.prototype.rs=function(t,e){var n=this;return this.ns.os(t,e).next((function(r){return n.hs(t,e,r)}))},t.prototype.hs=function(t,e,n){return this.es.zn(t,e).next((function(t){for(var r=0,i=n;r<i.length;r++)t=i[r].vn(e,t);return t}))},t.prototype.as=function(t,e,n){var r=ut();return e.forEach((function(t,e){for(var i=0,o=n;i<o.length;i++)e=o[i].vn(t,e);r=r.nt(t,e)})),r},t.prototype.us=function(t,e){var n=this;return this.es.getEntries(t,e).next((function(e){return n.cs(t,e)}))},t.prototype.cs=function(t,e){var n=this;return this.ns.ls(t,e).next((function(r){var i=n.as(t,e,r),o=st();return i.forEach((function(t,e){e||(e=new on(t,O.min())),o=o.nt(t,e)})),o}))},t.prototype._s=function(t,e,n){return e.Pn()?this.fs(t,e.path):e.Vn()?this.ds(t,e,n):this.ws(t,e,n)},t.prototype.fs=function(t,e){return this.rs(t,new M(e)).next((function(t){var e=ct();return t instanceof rn&&(e=e.nt(t.key,t)),e}))},t.prototype.ds=function(t,e,n){var r=this,i=e.collectionGroup,o=ct();return this.ss.Ts(t,i).next((function(s){return Dn.forEach(s,(function(s){var u=e.Tn(s.child(i));return r.ws(t,u,n).next((function(t){t.forEach((function(t,e){o=o.nt(t,e)}))}))})).next((function(){return o}))}))},t.prototype.ws=function(t,e,n){var r,i,o=this;return this.es._s(t,e,n).next((function(n){return r=n,o.ns.Es(t,e)})).next((function(e){return i=e,o.Is(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,u=o.mutations;s<u.length;s++){var a=u[s],c=a.key,h=r.get(c),f=je(a,h,h,o.yn);r=f instanceof rn?r.nt(c,f):r.remove(c)}}))})).next((function(){return r.forEach((function(t,n){fn(e,n)||(r=r.remove(t))})),r}))},t.prototype.Is=function(t,e,n){for(var r=lt(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof We&&null===n.get(a.key)&&(r=r.add(a.key))}var c=n;return this.es.getEntries(t,r).next((function(t){return t.forEach((function(t,e){null!==e&&e instanceof rn&&(c=c.nt(t,e))})),c}))},t}(),On=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.ms=n,this.As=r}return t.Rs=function(e,n){for(var r=lt(),i=lt(),o=0,s=n.docChanges;o<s.length;o++){var u=s[o];switch(u.type){case 0:r=r.add(u.doc.key);break;case 1:i=i.add(u.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),Rn=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.Ps=function(t){return n.Vs(t)},this.gs=function(t){return e.ys(t)})}return t.prototype.Vs=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.gs&&this.gs(t),t},t}();Rn.ps=-1;var Vn=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},Un=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.bs=t,this.vs=e,this.Ss=n,this.Ds=r,this.Cs=i,this.Fs=0,this.Ns=null,this.$s=Date.now(),this.reset()}return t.prototype.reset=function(){this.Fs=0},t.prototype.ks=function(){this.Fs=this.Cs},t.prototype.xs=function(t){var e=this;this.cancel();var n=Math.floor(this.Fs+this.Ms()),r=Math.max(0,Date.now()-this.$s),i=Math.max(0,n-r);i>0&&p("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Fs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ns=this.bs.Os(this.vs,i,(function(){return e.$s=Date.now(),t()})),this.Fs*=this.Ds,this.Fs<this.Ss&&(this.Fs=this.Ss),this.Fs>this.Cs&&(this.Fs=this.Cs)},t.prototype.Ls=function(){null!==this.Ns&&(this.Ns.Bs(),this.Ns=null)},t.prototype.cancel=function(){null!==this.Ns&&(this.Ns.cancel(),this.Ns=null)},t.prototype.Ms=function(){return(Math.random()-.5)*this.Fs},t}();function Cn(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=Fn(e)),e=Mn(t.get(n),e);return Fn(e)}function Mn(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}function Fn(t){return t+"\x01\x01"}function qn(t){var e=t.length;if(g(e>=2),2===e)return g("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),V.k();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||s>n)&&v(),t.charAt(s+1)){case"\x01":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:v()}o=s+2}return new V(r)}var jn=function(){function t(){this.qs=new zn}return t.prototype.Us=function(t,e){return this.qs.add(e),Dn.resolve()},t.prototype.Ts=function(t,e){return Dn.resolve(this.qs.getEntries(e))},t}(),zn=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.S(),n=t.p(),r=this.index[e]||new rt(V.P),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.S(),n=t.p(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new rt(V.P)).F()},t}(),Bn=function(){function t(){this.Qs=new zn}return t.prototype.Us=function(t,e){var n=this;if(!this.Qs.has(e)){var r=e.S(),i=e.p();t.Zn((function(){n.Qs.add(e)}));var o={collectionId:r,parent:Cn(i)};return Gn(t).put(o)}return Dn.resolve()},t.prototype.Ts=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[E(e),""],!1,!0);return Gn(t).Ws(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(qn(o.parent))}return n}))},t}();function Gn(t){return pr.js(t,Fr.store)}var Qn=function(t){this.Ks=t};function Wn(t,e){if(e.document)return function(t,e,n){var r=ie(t,e.name),i=te(e.updateTime),o=new Ze({mapValue:{fields:e.fields}});return new rn(r,i,o,{hasCommittedMutations:!!n})}(t.Ks,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=M.j(e.noDocument.path),r=Yn(e.noDocument.readTime);return new on(n,r,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){var i=M.j(e.unknownDocument.path),o=Yn(e.unknownDocument.version);return new sn(i,o)}return v()}function $n(t,e,n){var r=Kn(n),i=e.key.path.p().F();if(e instanceof rn){var o=function(t,e){return{name:re(t,e.key),fields:e.tn().mapValue.fields,updateTime:Yt(t,e.version.A())}}(t.Ks,e),s=e.hasCommittedMutations;return new Rr(null,null,o,s,r,i)}if(e instanceof on){var u=e.key.path.F(),a=Jn(e.version),c=e.hasCommittedMutations;return new Rr(null,new Lr(u,a),null,c,r,i)}if(e instanceof sn){var h=e.key.path.F(),f=Jn(e.version);return new Rr(new Or(h,f),null,null,!0,r,i)}return v()}function Kn(t){var e=t.A();return[e.seconds,e.nanoseconds]}function Hn(t){var e=new L(t[0],t[1]);return O.I(e)}function Jn(t){var e=t.A();return new xr(e.seconds,e.nanoseconds)}function Yn(t){var e=new L(t.seconds,t.nanoseconds);return O.I(e)}function Xn(t,e){var n=(e.baseMutations||[]).map((function(e){return fe(t.Ks,e)})),r=e.mutations.map((function(e){return fe(t.Ks,e)})),i=L.fromMillis(e.localWriteTimeMs);return new An(e.batchId,i,n,r)}function Zn(t){var e,n=Yn(t.readTime),r=void 0!==t.lastLimboFreeSnapshotVersion?Yn(t.lastLimboFreeSnapshotVersion):O.min();return e=void 0!==t.query.documents?function(t){g(1===t.documents.length);var e=t.documents[0];return un.hn(se(e)).We()}(t.query):function(t){var e=se(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){g(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=function t(e){return e?void 0!==e.unaryFilter?[we(e)]:void 0!==e.fieldFilter?[me(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((function(e){return t(e)})).reduce((function(t,e){return t.concat(e)})):v():[]}(n.where));var u=[];n.orderBy&&(u=n.orderBy.map((function(t){return new En(ge((e=t).field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction));var e})));var a=null;n.limit&&(a=function(t){var e;return F(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=ye(n.startAt));var h=null;return n.endAt&&(h=ye(n.endAt)),new un(e,i,u,s,a,"F",c,h).We()}(t.query),new J(e,t.targetId,0,t.lastListenSequenceNumber,n,r,$.fromBase64String(t.resumeToken))}function tr(t,e){var n,r=Jn(e.X),i=Jn(e.lastLimboFreeSnapshotVersion);n=W(e.target)?le(t.Ks,e.target):pe(t.Ks,e.target);var o=e.resumeToken.toBase64();return new Ur(e.targetId,G(e.target),r,o,e.sequenceNumber,i,n)}var er=function(){function t(t,e){this.serializer=t,this.ss=e}return t.prototype.jn=function(t,e,n){return rr(t).put(ir(e),n)},t.prototype.Gn=function(t,e){var n=rr(t),r=ir(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.Gs(t,r)}))},t.prototype.zn=function(t,e){var n=this;return rr(t).get(ir(e)).next((function(t){return n.zs(t)}))},t.prototype.Hs=function(t,e){var n=this;return rr(t).get(ir(e)).next((function(t){var e=n.zs(t);return e?{Ys:e,size:or(t)}:null}))},t.prototype.getEntries=function(t,e){var n=this,r=ut();return this.Js(t,e,(function(t,e){var i=n.zs(e);r=r.nt(t,i)})).next((function(){return r}))},t.prototype.Xs=function(t,e){var n=this,r=ut(),i=new tt(M.P);return this.Js(t,e,(function(t,e){var o=n.zs(e);o?(r=r.nt(t,o),i=i.nt(t,or(e))):(r=r.nt(t,null),i=i.nt(t,0))})).next((function(){return{Zs:r,ti:i}}))},t.prototype.Js=function(t,e,n){if(e._())return Dn.resolve();var r=IDBKeyRange.bound(e.first().path.F(),e.last().path.F()),i=e.at(),o=i.dt();return rr(t).ei({range:r},(function(t,e,r){for(var s=M.j(t);o&&M.P(o,s)<0;)n(o,null),o=i.dt();o&&o.isEqual(s)&&(n(o,e),o=i.wt()?i.dt():null),o?r.ni(o.path.F()):r.done()})).next((function(){for(;o;)n(o,null),o=i.wt()?i.dt():null}))},t.prototype._s=function(t,e,n){var r=this,i=ct(),o=e.path.length+1,s={};if(n.isEqual(O.min())){var u=e.path.F();s.range=IDBKeyRange.lowerBound(u)}else{var a=e.path.F(),c=Kn(n);s.range=IDBKeyRange.lowerBound([a,c],!0),s.index=Rr.collectionReadTimeIndex}return rr(t).ei(s,(function(t,n,s){if(t.length===o){var u=Wn(r.serializer,n);e.path.D(u.key.path)?u instanceof rn&&fn(e,u)&&(i=i.nt(u.key,u)):s.done()}})).next((function(){return i}))},t.prototype.si=function(t,e){var n=this,r=st(),i=Kn(e),o=rr(t),s=IDBKeyRange.lowerBound(i,!0);return o.ei({index:Rr.readTimeIndex,range:s},(function(t,e){var o=Wn(n.serializer,e);r=r.nt(o.key,o),i=e.readTime})).next((function(){return{ii:r,readTime:Hn(i)}}))},t.prototype.ri=function(t){var e=rr(t),n=O.min();return e.ei({index:Rr.readTimeIndex,reverse:!0},(function(t,e,r){e.readTime&&(n=Hn(e.readTime)),r.done()})).next((function(){return n}))},t.prototype.oi=function(e){return new t.hi(this,!!e&&e.ai)},t.prototype.ui=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return nr(t).get(Vr.key).next((function(t){return g(!!t),t}))},t.prototype.Gs=function(t,e){return nr(t).put(Vr.key,e)},t.prototype.zs=function(t){if(t){var e=Wn(this.serializer,t);return e instanceof on&&e.version.isEqual(O.min())?null:e}return null},t}();function nr(t){return pr.js(t,Vr.store)}function rr(t){return pr.js(t,Rr.store)}function ir(t){return t.path.F()}function or(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw v();e=t.noDocument}return JSON.stringify(e).length}er.hi=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).ci=e,r.ai=n,r.li=new S((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),r}return i.__extends(e,t),e.prototype.Jn=function(t){var e=this,n=[],r=0,i=new rt((function(t,e){return b(t.N(),e.N())}));return this.Un.forEach((function(o,s){var u=e.li.get(o);if(s){var a=$n(e.ci.serializer,s,e.readTime);i=i.add(o.path.p());var c=or(a);r+=c-u,n.push(e.ci.jn(t,o,a))}else if(r-=u,e.ai){var h=$n(e.ci.serializer,new on(o,O.min()),e.readTime);n.push(e.ci.jn(t,o,h))}else n.push(e.ci.Gn(t,o))})),i.forEach((function(r){n.push(e.ci.ss.Us(t,r))})),n.push(this.ci.updateMetadata(t,r)),Dn.Bn(n)},e.prototype.Hn=function(t,e){var n=this;return this.ci.Hs(t,e).next((function(t){return null===t?(n.li.set(e,0),null):(n.li.set(e,t.size),t.Ys)}))},e.prototype.Yn=function(t,e){var n=this;return this.ci.Xs(t,e).next((function(t){var e=t.Zs;return t.ti.forEach((function(t,e){n.li.set(t,e)})),e}))},e}(Sn);var sr=function(){function t(t){this._i=t}return t.prototype.next=function(){return this._i+=2,this._i},t.fi=function(){return new t(0)},t.di=function(){return new t(-1)},t}(),ur=function(){function t(t,e){this.wi=t,this.serializer=e}return t.prototype.Ti=function(t){var e=this;return this.Ei(t).next((function(n){var r=new sr(n.highestTargetId);return n.highestTargetId=r.next(),e.Ii(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.mi=function(t){return this.Ei(t).next((function(t){return O.I(new L(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.Ai=function(t){return this.Ei(t).next((function(t){return t.highestListenSequenceNumber}))},t.prototype.Ri=function(t,e,n){var r=this;return this.Ei(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.A()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Ii(t,i)}))},t.prototype.Pi=function(t,e){var n=this;return this.Vi(t,e).next((function(){return n.Ei(t).next((function(r){return r.targetCount+=1,n.gi(e,r),n.Ii(t,r)}))}))},t.prototype.yi=function(t,e){return this.Vi(t,e)},t.prototype.pi=function(t,e){var n=this;return this.bi(t,e.targetId).next((function(){return ar(t).delete(e.targetId)})).next((function(){return n.Ei(t)})).next((function(e){return g(e.targetCount>0),e.targetCount-=1,n.Ii(t,e)}))},t.prototype.vi=function(t,e,n){var r=this,i=0,o=[];return ar(t).ei((function(s,u){var a=Zn(u);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(i++,o.push(r.pi(t,a)))})).next((function(){return Dn.Bn(o)})).next((function(){return i}))},t.prototype.pe=function(t,e){return ar(t).ei((function(t,n){var r=Zn(n);e(r)}))},t.prototype.Ei=function(t){return cr(t).get(Mr.key).next((function(t){return g(null!==t),t}))},t.prototype.Ii=function(t,e){return cr(t).put(Mr.key,e)},t.prototype.Vi=function(t,e){return ar(t).put(tr(this.serializer,e))},t.prototype.gi=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.Si=function(t){return this.Ei(t).next((function(t){return t.targetCount}))},t.prototype.Di=function(t,e){var n=G(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return ar(t).ei({range:r,index:Ur.queryTargetsIndexName},(function(t,n,r){var o=Zn(n);Q(e,o.target)&&(i=o,r.done())})).next((function(){return i}))},t.prototype.Ci=function(t,e,n){var r=this,i=[],o=hr(t);return e.forEach((function(e){var s=Cn(e.path);i.push(o.put(new Cr(n,s))),i.push(r.wi.Fi(t,n,e))})),Dn.Bn(i)},t.prototype.Ni=function(t,e,n){var r=this,i=hr(t);return Dn.forEach(e,(function(e){var o=Cn(e.path);return Dn.Bn([i.delete([n,o]),r.wi.$i(t,n,e)])}))},t.prototype.bi=function(t,e){var n=hr(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.ki=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=hr(t),i=lt();return r.ei({range:n,xi:!0},(function(t,e,n){var r=qn(t[1]),o=new M(r);i=i.add(o)})).next((function(){return i}))},t.prototype.Mi=function(t,e){var n=Cn(e.path),r=IDBKeyRange.bound([n],[E(n)],!1,!0),i=0;return hr(t).ei({index:Cr.documentTargetsIndex,xi:!0,range:r},(function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.Me=function(t,e){return ar(t).get(e).next((function(t){return t?Zn(t):null}))},t}();function ar(t){return pr.js(t,Ur.store)}function cr(t){return pr.js(t,Mr.store)}function hr(t){return pr.js(t,Cr.store)}var fr="Failed to obtain exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",lr=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Oi=e,r.Li=n,r}return i.__extends(e,t),e}(Pn),pr=function(){function t(e,n,r,i,o,s,u,a,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.bs=o,this.window=s,this.document=u,this.Bi=c,this.qi=h,this.Ui=null,this.Qi=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Wi=null,this.inForeground=!1,this.ji=null,this.Ki=null,this.Gi=Number.NEGATIVE_INFINITY,this.zi=function(t){return Promise.resolve()},!t.Hi())throw new P(k.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.wi=new vr(this,i),this.Yi=n+"main",this.serializer=new Qn(a),this.Ji=new ur(this.wi,this.serializer),this.ss=new Bn,this.es=new er(this.serializer,this.ss),this.window&&this.window.localStorage?this.Xi=this.window.localStorage:(this.Xi=null,!1===h&&d("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.js=function(t,e){if(t instanceof lr)return Br.js(t.Oi,e);throw v()},t.prototype.start=function(){var t=this;return Br.Zi(this.Yi,Nr,new Ar(this.serializer)).then((function(e){return t.tr=e,t.er()})).then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new P(k.FAILED_PRECONDITION,fr);return t.nr(),t.sr(),t.ir(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t.Ji.Ai(e)}))})).then((function(e){t.Ui=new Rn(e,t.Bi)})).then((function(){t.Qi=!0})).catch((function(e){return t.tr&&t.tr.close(),Promise.reject(e)}))},t.prototype.rr=function(t){var e=this;return this.zi=function(n){return i.__awaiter(e,void 0,void 0,(function(){return i.__generator(this,(function(e){return this.or?[2,t(n)]:[2]}))}))},t(this.isPrimary)},t.prototype.hr=function(t){var e=this;this.tr.ar((function(n){return i.__awaiter(e,void 0,void 0,(function(){return i.__generator(this,(function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.ur=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.bs.cr((function(){return i.__awaiter(e,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return this.or?[4,this.er()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.er=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return yr(e).put(new jr(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.lr(e).next((function(e){e||(t.isPrimary=!1,t.bs._r((function(){return t.zi(!1)})))}))})).next((function(){return t.dr(e)})).next((function(n){return t.isPrimary&&!n?t.wr(e).next((function(){return!1})):!!n&&t.Tr(e).next((function(){return!0}))}))})).catch((function(e){if(Wr(e))return p("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return p("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.bs._r((function(){return t.zi(e)})),t.isPrimary=e}))},t.prototype.lr=function(t){var e=this;return dr(t).get(Dr.key).next((function(t){return Dn.resolve(e.Er(t))}))},t.prototype.Ir=function(t){return yr(t).delete(this.clientId)},t.prototype.mr=function(){return i.__awaiter(this,void 0,void 0,(function(){var e,n,r,o,s=this;return i.__generator(this,(function(i){switch(i.label){case 0:return!this.isPrimary||this.Ar(this.Gi,18e5)?[3,2]:(this.Gi=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(e){var n=t.js(e,jr.store);return n.Ws().next((function(t){var e=s.Rr(t,18e5),r=t.filter((function(t){return-1===e.indexOf(t)}));return Dn.forEach(r,(function(t){return n.delete(t.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}))]);case 1:if(e=i.sent(),this.Xi)for(n=0,r=e;n<r.length;n++)o=r[n],this.Xi.removeItem(this.Pr(o.clientId));i.label=2;case 2:return[2]}}))}))},t.prototype.ir=function(){var t=this;this.Ki=this.bs.Os("client_metadata_refresh",4e3,(function(){return t.er().then((function(){return t.mr()})).then((function(){return t.ir()}))}))},t.prototype.Er=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.dr=function(t){var e=this;return this.qi?Dn.resolve(!0):dr(t).get(Dr.key).next((function(n){if(null!==n&&e.Ar(n.leaseTimestampMs,5e3)&&!e.Vr(n.ownerId)){if(e.Er(n)&&e.networkEnabled)return!0;if(!e.Er(n)){if(!n.allowTabSynchronization)throw new P(k.FAILED_PRECONDITION,fr);return!1}}return!(!e.networkEnabled||!e.inForeground)||yr(t).Ws().next((function(t){return void 0===e.Rr(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&p("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},t.prototype.gr=function(){return i.__awaiter(this,void 0,void 0,(function(){var t=this;return i.__generator(this,(function(e){switch(e.label){case 0:return this.Qi=!1,this.yr(),this.Ki&&(this.Ki.cancel(),this.Ki=null),this.pr(),this.br(),[4,this.runTransaction("shutdown","readwrite",(function(e){return t.wr(e).next((function(){return t.Ir(e)}))})).catch((function(t){p("IndexedDbPersistence","Proceeding with shutdown despite failure: ",t)}))];case 1:return e.sent(),this.tr.close(),this.vr(),[2]}}))}))},t.prototype.Rr=function(t,e){var n=this;return t.filter((function(t){return n.Ar(t.updateTimeMs,e)&&!n.Vr(t.clientId)}))},t.prototype.Sr=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return yr(e).Ws().next((function(e){return t.Rr(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(t.prototype,"or",{get:function(){return this.Qi},enumerable:!1,configurable:!0}),t.prototype.Dr=function(t){return wr.Cr(t,this.serializer,this.ss,this.wi)},t.prototype.Fr=function(){return this.Ji},t.prototype.Nr=function(){return this.es},t.prototype.$r=function(){return this.ss},t.prototype.runTransaction=function(t,e,n){var r=this;p("IndexedDbPersistence","Starting transaction:",t);var i,o="readonly"===e?"readonly":"readwrite";return this.tr.runTransaction(o,zr,(function(o){return i=new lr(o,r.Ui?r.Ui.next():Rn.ps),"readwrite-primary"===e?r.lr(i).next((function(t){return!!t||r.dr(i)})).next((function(e){if(!e)throw d("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.bs._r((function(){return r.zi(!1)})),new P(k.FAILED_PRECONDITION,kn);return n(i)})).next((function(t){return r.Tr(i).next((function(){return t}))})):r.kr(i).next((function(){return n(i)}))})).then((function(t){return i.ts(),t}))},t.prototype.kr=function(t){var e=this;return dr(t).get(Dr.key).next((function(t){if(null!==t&&e.Ar(t.leaseTimestampMs,5e3)&&!e.Vr(t.ownerId)&&!e.Er(t)&&!(e.qi||e.allowTabSynchronization&&t.allowTabSynchronization))throw new P(k.FAILED_PRECONDITION,fr)}))},t.prototype.Tr=function(t){var e=new Dr(this.clientId,this.allowTabSynchronization,Date.now());return dr(t).put(Dr.key,e)},t.Hi=function(){return Br.Hi()},t.prototype.wr=function(t){var e=this,n=dr(t);return n.get(Dr.key).next((function(t){return e.Er(t)?(p("IndexedDbPersistence","Releasing primary lease."),n.delete(Dr.key)):Dn.resolve()}))},t.prototype.Ar=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(d("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.nr=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ji=function(){t.bs.cr((function(){return t.inForeground="visible"===t.document.visibilityState,t.er()}))},this.document.addEventListener("visibilitychange",this.ji),this.inForeground="visible"===this.document.visibilityState)},t.prototype.pr=function(){this.ji&&(this.document.removeEventListener("visibilitychange",this.ji),this.ji=null)},t.prototype.sr=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Wi=function(){e.yr(),e.bs.cr((function(){return e.gr()}))},this.window.addEventListener("unload",this.Wi))},t.prototype.br=function(){this.Wi&&(this.window.removeEventListener("unload",this.Wi),this.Wi=null)},t.prototype.Vr=function(t){var e;try{var n=null!==(null===(e=this.Xi)||void 0===e?void 0:e.getItem(this.Pr(t)));return p("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return d("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.yr=function(){if(this.Xi)try{this.Xi.setItem(this.Pr(this.clientId),String(Date.now()))}catch(t){d("Failed to set zombie client id.",t)}},t.prototype.vr=function(){if(this.Xi)try{this.Xi.removeItem(this.Pr(this.clientId))}catch(t){}},t.prototype.Pr=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function dr(t){return pr.js(t,Dr.store)}function yr(t){return pr.js(t,jr.store)}var vr=function(){function t(t,e){this.db=t,this.xr=new ui(this,e)}return t.prototype.Mr=function(t){var e=this.Or(t);return this.db.Fr().Si(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.Or=function(t){var e=0;return this.Lr(t,(function(t){e++})).next((function(){return e}))},t.prototype.pe=function(t,e){return this.db.Fr().pe(t,e)},t.prototype.Lr=function(t,e){return this.Br(t,(function(t,n){return e(n)}))},t.prototype.Fi=function(t,e,n){return gr(t,n)},t.prototype.$i=function(t,e,n){return gr(t,n)},t.prototype.vi=function(t,e,n){return this.db.Fr().vi(t,e,n)},t.prototype.qr=function(t,e){return gr(t,e)},t.prototype.Ur=function(t,e){return function(t,e){var n=!1;return Tr(t).Qr((function(r){return _r(t,r,e).next((function(t){return t&&(n=!0),Dn.resolve(!t)}))})).next((function(){return n}))}(t,e)},t.prototype.Wr=function(t,e){var n=this,r=this.db.Nr().oi(),i=[],o=0;return this.Br(t,(function(s,u){if(u<=e){var a=n.Ur(t,s).next((function(e){if(!e)return o++,r.zn(t,s).next((function(){return r.Gn(s),hr(t).delete([0,Cn(s.path)])}))}));i.push(a)}})).next((function(){return Dn.Bn(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},t.prototype.removeTarget=function(t,e){var n=e.Z(t.Li);return this.db.Fr().yi(t,n)},t.prototype.jr=function(t,e){return gr(t,e)},t.prototype.Br=function(t,e){var n,r=hr(t),i=Rn.ps;return r.ei({index:Cr.documentTargetsIndex},(function(t,r){var o=t[0],s=(t[1],r.path),u=r.sequenceNumber;0===o?(i!==Rn.ps&&e(new M(qn(n)),i),i=u,n=s):i=Rn.ps})).next((function(){i!==Rn.ps&&e(new M(qn(n)),i)}))},t.prototype.Kr=function(t){return this.db.Nr().ui(t)},t}();function gr(t,e){return hr(t).put(function(t,e){return new Cr(0,Cn(t.path),e)}(e,t.Li))}function mr(t,e){var n=t.projectId;return t.i||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var wr=function(){function t(t,e,n,r){this.userId=t,this.serializer=e,this.ss=n,this.wi=r,this.Gr={}}return t.Cr=function(e,n,r,i){return g(""!==e.uid),new t(e.zr()?e.uid:"",n,r,i)},t.prototype.Hr=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ir(t).ei({index:kr.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.Yr=function(t,e,n,r){var i=this,o=Er(t),s=Ir(t);return s.add({}).next((function(u){g("number"==typeof u);for(var a=new An(u,e,n,r),c=function(t,e,n){var r=n.baseMutations.map((function(e){return he(t.Ks,e)})),i=n.mutations.map((function(e){return he(t.Ks,e)}));return new kr(e,n.batchId,n.yn.toMillis(),r,i)}(i.serializer,i.userId,a),h=[],f=new rt((function(t,e){return b(t.N(),e.N())})),l=0,p=r;l<p.length;l++){var d=p[l],y=Pr.key(i.userId,d.key.path,u);f=f.add(d.key.path.p()),h.push(s.put(c)),h.push(o.put(y,Pr.PLACEHOLDER))}return f.forEach((function(e){h.push(i.ss.Us(t,e))})),t.Zn((function(){i.Gr[u]=a.keys()})),Dn.Bn(h).next((function(){return a}))}))},t.prototype.Jr=function(t,e){var n=this;return Ir(t).get(e).next((function(t){return t?(g(t.userId===n.userId),Xn(n.serializer,t)):null}))},t.prototype.Xr=function(t,e){var n=this;return this.Gr[e]?Dn.resolve(this.Gr[e]):this.Jr(t,e).next((function(t){if(t){var r=t.keys();return n.Gr[e]=r,r}return null}))},t.prototype.Zr=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return Ir(t).ei({index:kr.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(g(e.batchId>=r),o=Xn(n.serializer,e)),i.done()})).next((function(){return o}))},t.prototype.to=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Ir(t).ei({index:kr.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.eo=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ir(t).Ws(kr.userMutationsIndex,n).next((function(t){return t.map((function(t){return Xn(e.serializer,t)}))}))},t.prototype.os=function(t,e){var n=this,r=Pr.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return Er(t).ei({range:i},(function(r,i,s){var u=r[0],a=r[1],c=r[2],h=qn(a);if(u===n.userId&&e.path.isEqual(h))return Ir(t).get(c).next((function(t){if(!t)throw v();g(t.userId===n.userId),o.push(Xn(n.serializer,t))}));s.done()})).next((function(){return o}))},t.prototype.ls=function(t,e){var n=this,r=new rt(b),i=[];return e.forEach((function(e){var o=Pr.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),u=Er(t).ei({range:s},(function(t,i,o){var s=t[0],u=t[1],a=t[2],c=qn(u);s===n.userId&&e.path.isEqual(c)?r=r.add(a):o.done()}));i.push(u)})),Dn.Bn(i).next((function(){return n.no(t,r)}))},t.prototype.Es=function(t,e){var n=this,r=e.path,i=r.length+1,o=Pr.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),u=new rt(b);return Er(t).ei({range:s},(function(t,e,o){var s=t[0],a=t[1],c=t[2],h=qn(a);s===n.userId&&r.D(h)?h.length===i&&(u=u.add(c)):o.done()})).next((function(){return n.no(t,u)}))},t.prototype.no=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(Ir(t).get(e).next((function(t){if(null===t)throw v();g(t.userId===n.userId),r.push(Xn(n.serializer,t))})))})),Dn.Bn(i).next((function(){return r}))},t.prototype.so=function(t,e){var n=this;return br(t.Oi,this.userId,e).next((function(r){return t.Zn((function(){n.io(e.batchId)})),Dn.forEach(r,(function(e){return n.wi.qr(t,e)}))}))},t.prototype.io=function(t){delete this.Gr[t]},t.prototype.ro=function(t){var e=this;return this.Hr(t).next((function(n){if(!n)return Dn.resolve();var r=IDBKeyRange.lowerBound(Pr.prefixForUser(e.userId)),i=[];return Er(t).ei({range:r},(function(t,n,r){if(t[0]===e.userId){var o=qn(t[1]);i.push(o)}else r.done()})).next((function(){g(0===i.length)}))}))},t.prototype.Mi=function(t,e){return _r(t,this.userId,e)},t.prototype.oo=function(t){var e=this;return Tr(t).get(this.userId).next((function(t){return t||new Sr(e.userId,-1,"")}))},t}();function _r(t,e,n){var r=Pr.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return Er(t).ei({range:o,xi:!0},(function(t,n,r){var o=t[0],u=t[1];t[2],o===e&&u===i&&(s=!0),r.done()})).next((function(){return s}))}function br(t,e,n){var r=t.store(kr.store),i=t.store(Pr.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.ei({range:s},(function(t,e,n){return u++,n.delete()}));o.push(a.next((function(){g(1===u)})));for(var c=[],h=0,f=n.mutations;h<f.length;h++){var l=f[h],p=Pr.key(e,l.key.path,n.batchId);o.push(i.delete(p)),c.push(l.key)}return Dn.Bn(o).next((function(){return c}))}function Ir(t){return pr.js(t,kr.store)}function Er(t){return pr.js(t,Pr.store)}function Tr(t){return pr.js(t,Sr.store)}var Nr=10,Ar=function(){function t(t){this.serializer=t}return t.prototype.createOrUpgrade=function(t,e,n,r){var i=this;g(n<r&&n>=0&&r<=Nr);var o=new $r(e);n<1&&r>=1&&(function(t){t.createObjectStore(Dr.store)}(t),function(t){t.createObjectStore(Sr.store,{keyPath:Sr.keyPath}),t.createObjectStore(kr.store,{keyPath:kr.keyPath,autoIncrement:!0}).createIndex(kr.userMutationsIndex,kr.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Pr.store)}(t),qr(t),function(t){t.createObjectStore(Rr.store)}(t));var s=Dn.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(Cr.store),t.deleteObjectStore(Ur.store),t.deleteObjectStore(Mr.store)}(t),qr(t)),s=s.next((function(){return function(t){var e=t.store(Mr.store),n=new Mr(0,0,O.min().A(),0);return e.put(Mr.key,n)}(o)}))),n<4&&r>=4&&(0!==n&&(s=s.next((function(){return function(t,e){return e.store(kr.store).Ws().next((function(n){t.deleteObjectStore(kr.store),t.createObjectStore(kr.store,{keyPath:kr.keyPath,autoIncrement:!0}).createIndex(kr.userMutationsIndex,kr.userMutationsKeyPath,{unique:!0});var r=e.store(kr.store),i=n.map((function(t){return r.put(t)}));return Dn.Bn(i)}))}(t,o)}))),s=s.next((function(){!function(t){t.createObjectStore(jr.store,{keyPath:jr.keyPath})}(t)}))),n<5&&r>=5&&(s=s.next((function(){return i.removeAcknowledgedMutations(o)}))),n<6&&r>=6&&(s=s.next((function(){return function(t){t.createObjectStore(Vr.store)}(t),i.addDocumentGlobal(o)}))),n<7&&r>=7&&(s=s.next((function(){return i.ensureSequenceNumbers(o)}))),n<8&&r>=8&&(s=s.next((function(){return i.createCollectionParentIndex(t,o)}))),n<9&&r>=9&&(s=s.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(Rr.store);e.createIndex(Rr.readTimeIndex,Rr.readTimeIndexPath,{unique:!1}),e.createIndex(Rr.collectionReadTimeIndex,Rr.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(s=s.next((function(){return i.rewriteCanonicalIds(o)}))),s},t.prototype.addDocumentGlobal=function(t){var e=0;return t.store(Rr.store).ei((function(t,n){e+=or(n)})).next((function(){var n=new Vr(e);return t.store(Vr.store).put(Vr.key,n)}))},t.prototype.removeAcknowledgedMutations=function(t){var e=this,n=t.store(Sr.store),r=t.store(kr.store);return n.Ws().next((function(n){return Dn.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Ws(kr.userMutationsIndex,i).next((function(r){return Dn.forEach(r,(function(r){g(r.userId===n.userId);var i=Xn(e.serializer,r);return br(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.ensureSequenceNumbers=function(t){var e=t.store(Cr.store),n=t.store(Rr.store);return t.store(Mr.store).get(Mr.key).next((function(t){var r=[];return n.ei((function(n,i){var o=new V(n),s=function(t){return[0,Cn(t)]}(o);r.push(e.get(s).next((function(n){return n?Dn.resolve():function(n){return e.put(new Cr(0,Cn(n),t.highestListenSequenceNumber))}(o)})))})).next((function(){return Dn.Bn(r)}))}))},t.prototype.createCollectionParentIndex=function(t,e){t.createObjectStore(Fr.store,{keyPath:Fr.keyPath});var n=e.store(Fr.store),r=new zn,i=function(t){if(r.add(t)){var e=t.S(),i=t.p();return n.put({collectionId:e,parent:Cn(i)})}};return e.store(Rr.store).ei({xi:!0},(function(t,e){var n=new V(t);return i(n.p())})).next((function(){return e.store(Pr.store).ei({xi:!0},(function(t,e){t[0];var n=t[1],r=(t[2],qn(n));return i(r.p())}))}))},t.prototype.rewriteCanonicalIds=function(t){var e=this,n=t.store(Ur.store);return n.ei((function(t,r){var i=Zn(r),o=tr(e.serializer,i);return n.put(o)}))},t}(),xr=function(t,e){this.seconds=t,this.nanoseconds=e},Dr=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};Dr.store="owner",Dr.key="owner";var Sr=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Sr.store="mutationQueues",Sr.keyPath="userId";var kr=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};kr.store="mutations",kr.keyPath="batchId",kr.userMutationsIndex="userMutationsIndex",kr.userMutationsKeyPath=["userId","batchId"];var Pr=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,Cn(e)]},t.key=function(t,e,n){return[t,Cn(e),n]},t}();Pr.store="documentMutations",Pr.PLACEHOLDER=new Pr;var Lr=function(t,e){this.path=t,this.readTime=e},Or=function(t,e){this.path=t,this.version=e},Rr=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Rr.store="remoteDocuments",Rr.readTimeIndex="readTimeIndex",Rr.readTimeIndexPath="readTime",Rr.collectionReadTimeIndex="collectionReadTimeIndex",Rr.collectionReadTimeIndexPath=["parentPath","readTime"];var Vr=function(t){this.byteSize=t};Vr.store="remoteDocumentGlobal",Vr.key="remoteDocumentGlobalKey";var Ur=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Ur.store="targets",Ur.keyPath="targetId",Ur.queryTargetsIndexName="queryTargetsIndex",Ur.queryTargetsKeyPath=["canonicalId","targetId"];var Cr=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Cr.store="targetDocuments",Cr.keyPath=["targetId","path"],Cr.documentTargetsIndex="documentTargetsIndex",Cr.documentTargetsKeyPath=["path","targetId"];var Mr=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Mr.key="targetGlobalKey",Mr.store="targetGlobal";var Fr=function(t,e){this.collectionId=t,this.parent=e};function qr(t){t.createObjectStore(Cr.store,{keyPath:Cr.keyPath}).createIndex(Cr.documentTargetsIndex,Cr.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Ur.store,{keyPath:Ur.keyPath}).createIndex(Ur.queryTargetsIndexName,Ur.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Mr.store)}Fr.store="collectionParents",Fr.keyPath=["collectionId","parent"];var jr=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};jr.store="clientMetadata",jr.keyPath="clientId";var zr=i.__spreadArrays(i.__spreadArrays(i.__spreadArrays([Sr.store,kr.store,Pr.store,Rr.store,Ur.store,Dr.store,Mr.store,Cr.store],[jr.store]),[Vr.store]),[Fr.store]),Br=function(){function e(t){this.db=t,12.2===e.ho(u.getUA())&&d("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return e.Zi=function(t,n,r){return p("SimpleDb","Opening database:",t),new Dn((function(i,o){var s=indexedDB.open(t,n);s.onsuccess=function(t){var n=t.target.result;i(new e(n))},s.onblocked=function(){o(new P(k.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=function(t){var e=t.target.error;"VersionError"===e.name?o(new P(k.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o(e)},s.onupgradeneeded=function(e){p("SimpleDb",'Database "'+t+'" requires upgrade from version:',e.oldVersion);var n=e.target.result;r.createOrUpgrade(n,s.transaction,e.oldVersion,Nr).next((function(){p("SimpleDb","Database upgrade to version "+Nr+" complete")}))}})).On()},e.delete=function(t){return p("SimpleDb","Removing database:",t),Hr(window.indexedDB.deleteDatabase(t)).On()},e.Hi=function(){if("undefined"==typeof indexedDB)return!1;if(e.ao())return!0;var t=u.getUA(),n=e.ho(t),r=0<n&&n<10,i=e.uo(t),o=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||o)},e.ao=function(){var e;return"undefined"!=typeof t&&"YES"===(null===(e=t.env)||void 0===e?void 0:e.co)},e.js=function(t,e){return t.store(e)},e.ho=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},e.uo=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},e.prototype.ar=function(t){this.db.onversionchange=function(e){return t(e)}},e.prototype.runTransaction=function(t,e,n){return i.__awaiter(this,void 0,void 0,(function(){var r,o,s,u,a;return i.__generator(this,(function(c){switch(c.label){case 0:r="readonly"===t,o=0,s=function(){var t,s,a,c,h;return i.__generator(this,(function(i){switch(i.label){case 0:++o,t=$r.open(u.db,r?"readonly":"readwrite",e),i.label=1;case 1:return i.trys.push([1,3,,4]),s=n(t).catch((function(e){return t.abort(e),Dn.reject(e)})).On(),a={},s.catch((function(){})),[4,t.lo];case 2:return[2,(a.value=(i.sent(),s),a)];case 3:return c=i.sent(),h="FirebaseError"!==c.name&&o<3,p("SimpleDb","Transaction failed with error: %s. Retrying: %s.",c.message,h),h?[3,4]:[2,{value:Promise.reject(c)}];case 4:return[2]}}))},u=this,c.label=1;case 1:return[5,s()];case 2:if("object"==typeof(a=c.sent()))return[2,a.value];c.label=3;case 3:return[3,1];case 4:return[2]}}))}))},e.prototype.close=function(){this.db.close()},e}(),Gr=function(){function t(t){this._o=t,this.fo=!1,this.do=null}return Object.defineProperty(t.prototype,"$n",{get:function(){return this.fo},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wo",{get:function(){return this.do},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this._o=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.fo=!0},t.prototype.ni=function(t){this.do=t},t.prototype.delete=function(){return Hr(this._o.delete())},t}(),Qr=function(t){function e(e){var n=this;return(n=t.call(this,k.UNAVAILABLE,"IndexedDB transaction failed: "+e)||this).name="IndexedDbTransactionError",n}return i.__extends(e,t),e}(P);function Wr(t){return"IndexedDbTransactionError"===t.name}var $r=function(){function t(t){var e=this;this.transaction=t,this.aborted=!1,this.To=new Vn,this.transaction.oncomplete=function(){e.To.resolve()},this.transaction.onabort=function(){t.error?e.To.reject(new Qr(t.error)):e.To.resolve()},this.transaction.onerror=function(t){var n=Yr(t.target.error);e.To.reject(new Qr(n))}}return t.open=function(e,n,r){return new t(e.transaction(r,n))},Object.defineProperty(t.prototype,"lo",{get:function(){return this.To.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.To.reject(t),this.aborted||(p("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Kr(e)},t}(),Kr=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(p("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(p("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Hr(n)},t.prototype.add=function(t){return p("SimpleDb","ADD",this.store.name,t,t),Hr(this.store.add(t))},t.prototype.get=function(t){var e=this;return Hr(this.store.get(t)).next((function(n){return void 0===n&&(n=null),p("SimpleDb","GET",e.store.name,t,n),n}))},t.prototype.delete=function(t){return p("SimpleDb","DELETE",this.store.name,t),Hr(this.store.delete(t))},t.prototype.count=function(){return p("SimpleDb","COUNT",this.store.name),Hr(this.store.count())},t.prototype.Ws=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.Eo(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.Io=function(t,e){p("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.xi=!1;var r=this.cursor(n);return this.Eo(r,(function(t,e,n){return n.delete()}))},t.prototype.ei=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.Eo(r,e)},t.prototype.Qr=function(t){var e=this.cursor({});return new Dn((function(n,r){e.onerror=function(t){var e=Yr(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.Eo=function(t,e){var n=[];return new Dn((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Gr(i),s=e(i.primaryKey,i.value,o);if(s instanceof Dn){var u=s.catch((function(t){return o.done(),Dn.reject(t)}));n.push(u)}o.$n?r():null===o.wo?i.continue():i.continue(o.wo)}else r()}})).next((function(){return Dn.Bn(n)}))},t.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.xi?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function Hr(t){return new Dn((function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=Yr(t.target.error);n(e)}}))}var Jr=!1;function Yr(t){var e=Br.ho(u.getUA());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new P("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Jr||(Jr=!0,setTimeout((function(){throw r}),0)),r}}return t}function Xr(){return"undefined"!=typeof window?window:null}var Zr=function(){function t(t,e,n,r,i){this.mo=t,this.vs=e,this.Ao=n,this.op=r,this.Ro=i,this.Po=new Vn,this.then=this.Po.promise.then.bind(this.Po.promise),this.Po.promise.catch((function(t){}))}return t.Vo=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.yo=setTimeout((function(){return e.po()}),t)},t.prototype.Bs=function(){return this.po()},t.prototype.cancel=function(t){null!==this.yo&&(this.clearTimeout(),this.Po.reject(new P(k.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.po=function(){var t=this;this.mo.cr((function(){return null!==t.yo?(t.clearTimeout(),t.op().then((function(e){return t.Po.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this.yo&&(this.Ro(this),clearTimeout(this.yo),this.yo=null)},t}(),ti=function(){function t(){var t=this;this.bo=Promise.resolve(),this.vo=[],this.So=!1,this.Do=[],this.Co=null,this.Fo=!1,this.No=[],this.$o=new Un(this,"async_queue_retry"),this.ko=function(){return t.$o.Ls()};var e=Xr();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.ko)}return Object.defineProperty(t.prototype,"xo",{get:function(){return this.So},enumerable:!1,configurable:!0}),t.prototype.cr=function(t){this.enqueue(t)},t.prototype.Mo=function(t){this.Oo(),this.Lo(t)},t.prototype.Bo=function(t){return this.Oo(),this.Lo(t)},t.prototype.qo=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e;return i.__generator(this,(function(n){switch(n.label){case 0:return this.Oo(),this.So?[3,2]:(this.So=!0,(e=Xr())&&e.removeEventListener("visibilitychange",this.ko),[4,this.Bo(t)]);case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype.enqueue=function(t){return this.Oo(),this.So?new Promise((function(t){})):this.Lo(t)},t.prototype._r=function(t){var e=this;this.vo.push(t),this.cr((function(){return e.Uo()}))},t.prototype.Uo=function(){return i.__awaiter(this,void 0,void 0,(function(){var t,e=this;return i.__generator(this,(function(n){switch(n.label){case 0:if(0===this.vo.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.vo[0]()];case 2:return n.sent(),this.vo.shift(),this.$o.reset(),[3,4];case 3:if(!Wr(t=n.sent()))throw t;return p("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.vo.length>0&&this.$o.xs((function(){return e.Uo()})),n.label=5;case 5:return[2]}}))}))},t.prototype.Lo=function(t){var e=this,n=this.bo.then((function(){return e.Fo=!0,t().catch((function(t){throw e.Co=t,e.Fo=!1,d("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t})).then((function(t){return e.Fo=!1,t}))}));return this.bo=n,n},t.prototype.Os=function(t,e,n){var r=this;this.Oo(),this.No.indexOf(t)>-1&&(e=0);var i=Zr.Vo(this,t,e,n,(function(t){return r.Qo(t)}));return this.Do.push(i),i},t.prototype.Oo=function(){this.Co&&v()},t.prototype.Wo=function(){},t.prototype.jo=function(){return i.__awaiter(this,void 0,void 0,(function(){var t;return i.__generator(this,(function(e){switch(e.label){case 0:return[4,t=this.bo];case 1:e.sent(),e.label=2;case 2:if(t!==this.bo)return[3,0];e.label=3;case 3:return[2]}}))}))},t.prototype.Ko=function(t){for(var e=0,n=this.Do;e<n.length;e++)if(n[e].vs===t)return!0;return!1},t.prototype.Go=function(t){var e=this;return this.jo().then((function(){e.Do.sort((function(t,e){return t.Ao-e.Ao}));for(var n=0,r=e.Do;n<r.length;n++){var i=r[n];if(i.Bs(),"all"!==t&&i.vs===t)break}return e.jo()}))},t.prototype.zo=function(t){this.No.push(t)},t.prototype.Qo=function(t){var e=this.Do.indexOf(t);this.Do.splice(e,1)},t}();function ei(t,e){if(d("AsyncQueue",e+": "+t),Wr(t))return new P(k.UNAVAILABLE,e+": "+t);throw t}function ni(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=b(n,i);return 0===s?b(r,o):s}var ri=function(){function t(t){this.Ho=t,this.buffer=new rt(ni),this.Yo=0}return t.prototype.Jo=function(){return++this.Yo},t.prototype.Xo=function(t){var e=[t,this.Jo()];if(this.buffer.size<this.Ho)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();ni(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),ii={Zo:!1,th:0,eh:0,nh:0},oi=function(){function t(t,e,n){this.sh=t,this.ih=e,this.rh=n}return t.oh=function(e){return new t(e,t.hh,t.ah)},t}();oi.uh=-1,oi.lh=1048576,oi._h=41943040,oi.hh=10,oi.ah=1e3,oi.fh=new oi(oi._h,oi.hh,oi.ah),oi.dh=new oi(oi.uh,0,0);var si=function(){function t(t,e){this.xr=t,this.mo=e,this.wh=!1,this.Th=null}return t.prototype.start=function(t){this.xr.params.sh!==oi.uh&&this.Eh(t)},t.prototype.stop=function(){this.Th&&(this.Th.cancel(),this.Th=null)},Object.defineProperty(t.prototype,"or",{get:function(){return null!==this.Th},enumerable:!1,configurable:!0}),t.prototype.Eh=function(t){var e=this,n=this.wh?3e5:6e4;p("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.Th=this.mo.Os("lru_garbage_collection",n,(function(){return i.__awaiter(e,void 0,void 0,(function(){var e;return i.__generator(this,(function(n){switch(n.label){case 0:this.Th=null,this.wh=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.Ih(this.xr)];case 2:return n.sent(),[3,7];case 3:return Wr(e=n.sent())?(p("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,fi(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.Eh(t)];case 8:return n.sent(),[2]}}))}))}))},t}(),ui=function(){function t(t,e){this.mh=t,this.params=e}return t.prototype.Ah=function(t,e){return this.mh.Mr(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.Rh=function(t,e){var n=this;if(0===e)return Dn.resolve(Rn.ps);var r=new ri(e);return this.mh.pe(t,(function(t){return r.Xo(t.sequenceNumber)})).next((function(){return n.mh.Lr(t,(function(t){return r.Xo(t)}))})).next((function(){return r.maxValue}))},t.prototype.vi=function(t,e,n){return this.mh.vi(t,e,n)},t.prototype.Wr=function(t,e){return this.mh.Wr(t,e)},t.prototype.Ph=function(t,e){var n=this;return this.params.sh===oi.uh?(p("LruGarbageCollector","Garbage collection skipped; disabled"),Dn.resolve(ii)):this.Kr(t).next((function(r){return r<n.params.sh?(p("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.sh),ii):n.Vh(t,e)}))},t.prototype.Kr=function(t){return this.mh.Kr(t)},t.prototype.Vh=function(t,e){var n,r,i,o,u,a,c,h=this,f=Date.now();return this.Ah(t,this.params.ih).next((function(e){return e>h.params.rh?(p("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.rh+" from "+e),r=h.params.rh):r=e,o=Date.now(),h.Rh(t,r)})).next((function(r){return n=r,u=Date.now(),h.vi(t,n,e)})).next((function(e){return i=e,a=Date.now(),h.Wr(t,n)})).next((function(t){return c=Date.now(),l()<=s.LogLevel.DEBUG&&p("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-f)+"ms\n\tDetermined least recently used "+r+" in "+(u-o)+"ms\n\tRemoved "+i+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(c-a)+"ms\nTotal Duration: "+(c-f)+"ms"),Dn.resolve({Zo:!0,th:r,eh:i,nh:t})}))},t}(),ai=function(){function t(t,e,n){this.persistence=t,this.gh=e,this.yh=new tt(b),this.ph=new S((function(t){return G(t)}),Q),this.bh=O.min(),this.ns=t.Dr(n),this.vh=t.Nr(),this.Ji=t.Fr(),this.Sh=new Ln(this.vh,this.ns,this.persistence.$r()),this.gh.Dh(this.Sh)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.Ch=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n,r,o=this;return i.__generator(this,(function(i){switch(i.label){case 0:return e=this.ns,n=this.Sh,[4,this.persistence.runTransaction("Handle user change","readonly",(function(r){var i;return o.ns.eo(r).next((function(s){return i=s,e=o.persistence.Dr(t),n=new Ln(o.vh,e,o.persistence.$r()),e.eo(r)})).next((function(t){for(var e=[],o=[],s=lt(),u=0,a=i;u<a.length;u++){var c=a[u];e.push(c.batchId);for(var h=0,f=c.mutations;h<f.length;h++){var l=f[h];s=s.add(l.key)}}for(var p=0,d=t;p<d.length;p++){var y=d[p];o.push(y.batchId);for(var v=0,g=y.mutations;v<g.length;v++){var m=g[v];s=s.add(m.key)}}return n.us(r,s).next((function(t){return{Fh:t,Nh:e,$h:o}}))}))}))];case 1:return r=i.sent(),[2,(this.ns=e,this.Sh=n,this.gh.Dh(this.Sh),r)]}}))}))},t.prototype.kh=function(t){var e,n=this,r=L.now(),i=t.reduce((function(t,e){return t.add(e.key)}),lt());return this.persistence.runTransaction("Locally write mutations","readwrite",(function(o){return n.Sh.us(o,i).next((function(i){e=i;for(var s=[],u=0,a=t;u<a.length;u++){var c=a[u],h=ze(c,e.get(c.key));null!=h&&s.push(new We(c.key,h,en(h.proto.mapValue),Ce.exists(!0)))}return n.ns.Yr(o,r,s,t)}))})).then((function(t){var n=t.Sn(e);return{batchId:t.batchId,Un:n}}))},t.prototype.xh=function(t){var e=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(n){var r=t.batch.keys(),i=e.vh.oi({ai:!0});return e.Mh(n,t,i).next((function(){return i.apply(n)})).next((function(){return e.ns.ro(n)})).next((function(){return e.Sh.us(n,r)}))}))},t.prototype.Oh=function(t){var e=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",(function(n){var r;return e.ns.Jr(n,t).next((function(t){return g(null!==t),r=t.keys(),e.ns.so(n,t)})).next((function(){return e.ns.ro(n)})).next((function(){return e.Sh.us(n,r)}))}))},t.prototype.to=function(){var t=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(e){return t.ns.to(e)}))},t.prototype.mi=function(){var t=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",(function(e){return t.Ji.mi(e)}))},t.prototype.Lh=function(e){var n=this,r=e.X,i=this.yh;return this.persistence.runTransaction("Apply remote event","readwrite-primary",(function(o){var s=n.vh.oi({ai:!0});i=n.yh;var u=[];e.Qt.forEach((function(e,s){var a=i.get(s);if(a){u.push(n.Ji.Ni(o,e.Xt,s).next((function(){return n.Ji.Ci(o,e.Yt,s)})));var c=e.resumeToken;if(c.H()>0){var h=a.tt(c,r).Z(o.Li);i=i.nt(s,h),t.Bh(a,h,e)&&u.push(n.Ji.yi(o,h))}}}));var a=st(),c=lt();if(e.jt.forEach((function(t,e){c=c.add(t)})),u.push(s.getEntries(o,c).next((function(t){e.jt.forEach((function(i,c){var h=t.get(i);c instanceof on&&c.version.isEqual(O.min())?(s.Gn(i,r),a=a.nt(i,c)):null==h||c.version.o(h.version)>0||0===c.version.o(h.version)&&h.hasPendingWrites?(s.jn(c,r),a=a.nt(i,c)):p("LocalStore","Ignoring outdated watch update for ",i,". Current version:",h.version," Watch version:",c.version),e.Kt.has(i)&&u.push(n.persistence.wi.jr(o,i))}))}))),!r.isEqual(O.min())){var h=n.Ji.mi(o).next((function(t){return n.Ji.Ri(o,o.Li,r)}));u.push(h)}return Dn.Bn(u).next((function(){return s.apply(o)})).next((function(){return n.Sh.cs(o,a)}))})).then((function(t){return n.yh=i,t}))},t.Bh=function(t,e,n){return g(e.resumeToken.H()>0),0===t.resumeToken.H()||e.X.m()-t.X.m()>=this.qh||n.Yt.size+n.Jt.size+n.Xt.size>0},t.prototype.Uh=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n,r,o,s,u,a,c,h=this;return i.__generator(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(e){return Dn.forEach(t,(function(t){return Dn.forEach(t.ms,(function(n){return h.persistence.wi.Fi(e,t.targetId,n)})).next((function(){return Dn.forEach(t.As,(function(n){return h.persistence.wi.$i(e,t.targetId,n)}))}))}))}))];case 1:return i.sent(),[3,3];case 2:if(!Wr(e=i.sent()))throw e;return p("LocalStore","Failed to update sequence numbers: "+e),[3,3];case 3:for(n=0,r=t;n<r.length;n++)o=r[n],s=o.targetId,o.fromCache||(u=this.yh.get(s),a=u.X,c=u.et(a),this.yh=this.yh.nt(s,c));return[2]}}))}))},t.prototype.Qh=function(t){var e=this;return this.persistence.runTransaction("Get next mutation batch","readonly",(function(n){return void 0===t&&(t=-1),e.ns.Zr(n,t)}))},t.prototype.Wh=function(t){var e=this;return this.persistence.runTransaction("read document","readonly",(function(n){return e.Sh.rs(n,t)}))},t.prototype.jh=function(t){var e=this;return this.persistence.runTransaction("Allocate target","readwrite",(function(n){var r;return e.Ji.Di(n,t).next((function(i){return i?(r=i,Dn.resolve(r)):e.Ji.Ti(n).next((function(i){return r=new J(t,i,0,n.Li),e.Ji.Pi(n,r).next((function(){return r}))}))}))})).then((function(n){var r=e.yh.get(n.targetId);return(null===r||n.X.o(r.X)>0)&&(e.yh=e.yh.nt(n.targetId,n),e.ph.set(t,n.targetId)),n}))},t.prototype.Di=function(t,e){var n=this.ph.get(e);return void 0!==n?Dn.resolve(this.yh.get(n)):this.Ji.Di(t,e)},t.prototype.Kh=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n,r,o,s=this;return i.__generator(this,(function(i){switch(i.label){case 0:n=this.yh.get(t),r=e?"readwrite":"readwrite-primary",i.label=1;case 1:return i.trys.push([1,4,,5]),e?[3,3]:[4,this.persistence.runTransaction("Release target",r,(function(t){return s.persistence.wi.removeTarget(t,n)}))];case 2:i.sent(),i.label=3;case 3:return[3,5];case 4:if(!Wr(o=i.sent()))throw o;return p("LocalStore","Failed to update sequence numbers for target "+t+": "+o),[3,5];case 5:return this.yh=this.yh.remove(t),this.ph.delete(n.target),[2]}}))}))},t.prototype.Gh=function(t,e){var n=this,r=O.min(),i=lt();return this.persistence.runTransaction("Execute query","readonly",(function(o){return n.Di(o,t.We()).next((function(t){if(t)return r=t.lastLimboFreeSnapshotVersion,n.Ji.ki(o,t.targetId).next((function(t){i=t}))})).next((function(){return n.gh._s(o,t,e?r:O.min(),e?i:lt())})).next((function(t){return{documents:t,zh:i}}))}))},t.prototype.Mh=function(t,e,n){var r=this,i=e.batch,o=i.keys(),s=Dn.resolve();return o.forEach((function(r){s=s.next((function(){return n.zn(t,r)})).next((function(t){var o=t,s=e.Cn.get(r);g(null!==s),(!o||o.version.o(s)<0)&&(o=i.pn(r,o,e))&&n.jn(o,e.Dn)}))})),s.next((function(){return r.ns.so(t,i)}))},t.prototype.Ih=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.Ph(n,e.yh)}))},t}();function ci(t,e,n){return new ai(t,e,n)}ai.qh=3e8;var hi=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).persistence=e,i.ns=e.Dr(r),i.vh=e.Nr(),i.Ji=e.Fr(),i}return i.__extends(e,t),e.prototype.start=function(){return this.Hh()},e.prototype.Yh=function(t){var e=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",(function(n){return e.ns.Xr(n,t).next((function(t){return t?e.Sh.us(n,t):Dn.resolve(null)}))}))},e.prototype.Jh=function(t){this.ns.io(t)},e.prototype.ur=function(t){this.persistence.ur(t)},e.prototype.Sr=function(){return this.persistence.Sr()},e.prototype.Xh=function(t){var e=this,n=this.yh.get(t);return n?Promise.resolve(n.target):this.persistence.runTransaction("Get target data","readonly",(function(n){return e.Ji.Me(n,t).next((function(t){return t?t.target:null}))}))},e.prototype.si=function(){var t=this;return this.persistence.runTransaction("Get new document changes","readonly",(function(e){return t.vh.si(e,t.bh)})).then((function(e){var n=e.ii,r=e.readTime;return t.bh=r,n}))},e.prototype.Hh=function(){return i.__awaiter(this,void 0,void 0,(function(){var t,e=this;return i.__generator(this,(function(n){switch(n.label){case 0:return t=this,[4,this.persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return e.vh.ri(t)}))];case 1:return t.bh=n.sent(),[2]}}))}))},e}(ai);function fi(t){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){if(t.code!==k.FAILED_PRECONDITION||t.message!==kn)throw t;return p("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}var li=function(){function t(){this.Zh=new rt(pi.ta),this.ea=new rt(pi.na)}return t.prototype._=function(){return this.Zh._()},t.prototype.Fi=function(t,e){var n=new pi(t,e);this.Zh=this.Zh.add(n),this.ea=this.ea.add(n)},t.prototype.sa=function(t,e){var n=this;t.forEach((function(t){return n.Fi(t,e)}))},t.prototype.$i=function(t,e){this.ia(new pi(t,e))},t.prototype.ra=function(t,e){var n=this;t.forEach((function(t){return n.$i(t,e)}))},t.prototype.oa=function(t){var e=this,n=new M(new V([])),r=new pi(n,t),i=new pi(n,t+1),o=[];return this.ea.vt([r,i],(function(t){e.ia(t),o.push(t.key)})),o},t.prototype.ha=function(){var t=this;this.Zh.forEach((function(e){return t.ia(e)}))},t.prototype.ia=function(t){this.Zh=this.Zh.delete(t),this.ea=this.ea.delete(t)},t.prototype.aa=function(t){var e=new M(new V([])),n=new pi(e,t),r=new pi(e,t+1),i=lt();return this.ea.vt([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.Mi=function(t){var e=new pi(t,0),n=this.Zh.Dt(e);return null!==n&&t.isEqual(n.key)},t}(),pi=function(){function t(t,e){this.key=t,this.ua=e}return t.ta=function(t,e){return M.P(t.key,e.key)||b(t.ua,e.ua)},t.na=function(t,e){return b(t.ua,e.ua)||M.P(t.key,e.key)},t}();function di(t,e){if(0!==e.length)throw new P(k.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+Li(e.length,"argument")+".")}function yi(t,e,n){if(e.length!==n)throw new P(k.INVALID_ARGUMENT,"Function "+t+"() requires "+Li(n,"argument")+", but was called with "+Li(e.length,"argument")+".")}function vi(t,e,n){if(e.length<n)throw new P(k.INVALID_ARGUMENT,"Function "+t+"() requires at least "+Li(n,"argument")+", but was called with "+Li(e.length,"argument")+".")}function gi(t,e,n,r){if(e.length<n||e.length>r)throw new P(k.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+Li(e.length,"argument")+".")}function mi(t,e,n,r){Ti(t,e,Pi(n)+" argument",r)}function wi(t,e,n,r){void 0!==r&&mi(t,e,n,r)}function _i(t,e,n,r){Ti(t,e,n+" option",r)}function bi(t,e,n,r){void 0!==r&&_i(t,e,n,r)}function Ii(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],s=0,u=i;s<u.length;s++){var a=u[s];if(a===r)return;o.push(Ai(a))}var c=Ai(r);throw new P(k.INVALID_ARGUMENT,"Invalid value "+c+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r,i)}function Ei(t,e,n,r){if(!e.some((function(t){return t===r})))throw new P(k.INVALID_ARGUMENT,"Invalid value "+Ai(r)+" provided to function "+t+"() for its "+Pi(n)+" argument. Acceptable values: "+e.join(", "));return r}function Ti(t,e,n,r){if(!("object"===e?Ni(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=Ai(r);throw new P(k.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function Ni(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Ai(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":v()}function xi(t,e,n){if(void 0===n)throw new P(k.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+Pi(e)+" argument, but it was undefined.")}function Di(t,e,n){x(e,(function(e,r){if(n.indexOf(e)<0)throw new P(k.INVALID_ARGUMENT,"Unknown option '"+e+"' passed to function "+t+"(). Available options: "+n.join(", "))}))}function Si(t,e,n,r){var i=Ai(r);return new P(k.INVALID_ARGUMENT,"Function "+t+"() requires its "+Pi(n)+" argument to be a "+e+", but it was: "+i)}function ki(t,e,n){if(n<=0)throw new P(k.INVALID_ARGUMENT,"Function "+t+"() requires its "+Pi(e)+" argument to be a positive number, but it was: "+n+".")}function Pi(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Li(t,e){return t+" "+e+(1===t?"":"s")}function Oi(){if("undefined"==typeof Uint8Array)throw new P(k.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Ri(){if("undefined"==typeof atob)throw new P(k.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Vi=function(){function t(t){Ri(),this.ca=t}return t.fromBase64String=function(e){yi("Blob.fromBase64String",arguments,1),mi("Blob.fromBase64String","string",1,e),Ri();try{return new t($.fromBase64String(e))}catch(e){throw new P(k.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+e)}},t.fromUint8Array=function(e){if(yi("Blob.fromUint8Array",arguments,1),Oi(),!(e instanceof Uint8Array))throw Si("Blob.fromUint8Array","Uint8Array",1,e);return new t($.fromUint8Array(e))},t.prototype.toBase64=function(){return yi("Blob.toBase64",arguments,0),Ri(),this.ca.toBase64()},t.prototype.toUint8Array=function(){return yi("Blob.toUint8Array",arguments,0),Oi(),this.ca.toUint8Array()},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this.ca.isEqual(t.ca)},t}(),Ui=function(t){!function(t,e,n,r){if(!(e instanceof Array)||e.length<1)throw new P(k.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least "+Li(1,"element")+".")}(0,t);for(var e=0;e<t.length;++e)if(mi("FieldPath","string",e,t[e]),0===t[e].length)throw new P(k.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.la=new C(t)},Ci=function(t){function e(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.call(this,e)||this}return i.__extends(e,t),e.documentId=function(){return new e(C.L().N())},e.prototype.isEqual=function(t){if(!(t instanceof e))throw Si("isEqual","FieldPath",1,t);return this.la.isEqual(t.la)},e}(Ui),Mi=new RegExp("[~\\*/\\[\\]]"),Fi=function(){this._a=this},qi=function(t){function e(e){var n=this;return(n=t.call(this)||this).fa=e,n}return i.__extends(e,t),e.prototype.da=function(t){if(2!==t.wa)throw 1===t.wa?t.Ta(this.fa+"() can only appear at the top level of your update data"):t.Ta(this.fa+"() cannot be used with set() unless you pass {merge:true}");return t.Le.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(Fi);function ji(t,e,n){return new eo({wa:3,Ea:e.settings.Ea,methodName:t.fa,Ia:n},e.s,e.serializer,e.ignoreUndefinedProperties)}var zi=function(t){function e(e){var n=this;return(n=t.call(this)||this).fa=e,n}return i.__extends(e,t),e.prototype.da=function(t){return new Ve(t.path,new Ae)},e.prototype.isEqual=function(t){return t instanceof e},e}(Fi),Bi=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).fa=e,r.ma=n,r}return i.__extends(e,t),e.prototype.da=function(t){var e=ji(this,t,!0),n=this.ma.map((function(t){return uo(t,e)})),r=new xe(n);return new Ve(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Fi),Gi=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).fa=e,r.ma=n,r}return i.__extends(e,t),e.prototype.da=function(t){var e=ji(this,t,!0),n=this.ma.map((function(t){return uo(t,e)})),r=new Se(n);return new Ve(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Fi),Qi=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).fa=e,r.Aa=n,r}return i.__extends(e,t),e.prototype.da=function(t){var e=new Pe(t.serializer,Jt(t.serializer,this.Aa));return new Ve(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(Fi),Wi=function(t){function e(){return t.call(this)||this}return i.__extends(e,t),e.delete=function(){return di("FieldValue.delete",arguments),new $i(new qi("FieldValue.delete"))},e.serverTimestamp=function(){return di("FieldValue.serverTimestamp",arguments),new $i(new zi("FieldValue.serverTimestamp"))},e.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return vi("FieldValue.arrayUnion",arguments,1),new $i(new Bi("FieldValue.arrayUnion",t))},e.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return vi("FieldValue.arrayRemove",arguments,1),new $i(new Gi("FieldValue.arrayRemove",t))},e.increment=function(t){return mi("FieldValue.increment","number",1,t),yi("FieldValue.increment",arguments,1),new $i(new Qi("FieldValue.increment",t))},e}(Fi),$i=function(t){function e(e){var n=this;return(n=t.call(this)||this)._a=e,n.fa=e.fa,n}return i.__extends(e,t),e.prototype.da=function(t){return this._a.da(t)},e.prototype.isEqual=function(t){return t instanceof e&&this._a.isEqual(t._a)},e}(Wi),Ki=function(){function t(t,e){if(yi("GeoPoint",arguments,2),mi("GeoPoint","number",1,t),mi("GeoPoint","number",2,e),!isFinite(t)||t<-90||t>90)throw new P(k.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new P(k.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.Ra=t,this.Pa=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this.Ra},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this.Pa},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.Ra===t.Ra&&this.Pa===t.Pa},t.prototype.T=function(t){return b(this.Ra,t.Ra)||b(this.Pa,t.Pa)},t}();function Hi(t){return new $t(t,!0)}var Ji=/^__.*__$/,Yi=function(t,e,n){this.Va=t,this.ga=e,this.ya=n},Xi=function(){function t(t,e,n){this.data=t,this.Le=e,this.fieldTransforms=n}return t.prototype.pa=function(t,e){var n=[];return null!==this.Le?n.push(new We(t,this.data,this.Le,e)):n.push(new Qe(t,this.data,e)),this.fieldTransforms.length>0&&n.push(new Ke(t,this.fieldTransforms)),n},t}(),Zi=function(){function t(t,e,n){this.data=t,this.Le=e,this.fieldTransforms=n}return t.prototype.pa=function(t,e){var n=[new We(t,this.data,this.Le,e)];return this.fieldTransforms.length>0&&n.push(new Ke(t,this.fieldTransforms)),n},t}();function to(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw v()}}var eo=function(){function t(t,e,n,r,i,o){this.settings=t,this.s=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.ba(),this.fieldTransforms=i||[],this.Le=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wa",{get:function(){return this.settings.wa},enumerable:!1,configurable:!0}),t.prototype.va=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.s,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.Le)},t.prototype.Sa=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.va({path:n,Ia:!1});return r.Da(t),r},t.prototype.Ca=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.va({path:n,Ia:!1});return r.ba(),r},t.prototype.Fa=function(t){return this.va({path:void 0,Ia:!0})},t.prototype.Ta=function(t){return po(t,this.settings.methodName,this.settings.Na||!1,this.path,this.settings.Ea)},t.prototype.contains=function(t){return void 0!==this.Le.find((function(e){return t.D(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.D(e.field)}))},t.prototype.ba=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.Da(this.path.get(t))},t.prototype.Da=function(t){if(0===t.length)throw this.Ta("Document fields must not be empty");if(to(this.wa)&&Ji.test(t))throw this.Ta('Document fields cannot begin and end with "__"')},t}(),no=function(){function t(t,e,n){this.s=t,this.ignoreUndefinedProperties=e,this.serializer=n||Hi(t)}return t.prototype.$a=function(t,e,n,r){return void 0===r&&(r=!1),new eo({wa:t,methodName:e,Ea:n,path:C.k(),Ia:!1,Na:r},this.s,this.serializer,this.ignoreUndefinedProperties)},t}();function ro(t,e,n,r,i,o){void 0===o&&(o={});var s=t.$a(o.merge||o.mergeFields?2:0,e,n,i);ho("Data must be an object, but it was:",s,r);var u,a,c=ao(r,s);if(o.merge)u=new Re(s.Le),a=s.fieldTransforms;else if(o.mergeFields){for(var h=[],f=0,l=o.mergeFields;f<l.length;f++){var p=l[f],d=void 0;if(p instanceof Ui)d=p.la;else{if("string"!=typeof p)throw v();d=lo(e,p,n)}if(!s.contains(d))throw new P(k.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");yo(h,d)||h.push(d)}u=new Re(h),a=s.fieldTransforms.filter((function(t){return u.Ke(t.field)}))}else u=null,a=s.fieldTransforms;return new Xi(new Ze(c),u,a)}function io(t,e,n,r){var i=t.$a(1,e,n);ho("Data must be an object, but it was:",i,r);var o=[],s=new tn;x(r,(function(t,r){var u=lo(e,t,n),a=i.Ca(u);if(r instanceof Fi&&r._a instanceof qi)o.push(u);else{var c=uo(r,a);null!=c&&(o.push(u),s.set(u,c))}}));var u=new Re(o);return new Zi(s.ze(),u,i.fieldTransforms)}function oo(t,e,n,r,i,o){var s=t.$a(1,e,n),u=[fo(e,r,n)],a=[i];if(o.length%2!=0)throw new P(k.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)u.push(fo(e,o[c])),a.push(o[c+1]);for(var h=[],f=new tn,l=u.length-1;l>=0;--l)if(!yo(h,u[l])){var p=u[l],d=a[l],y=s.Ca(p);if(d instanceof Fi&&d._a instanceof qi)h.push(p);else{var v=uo(d,y);null!=v&&(h.push(p),f.set(p,v))}}var g=new Re(h);return new Zi(f.ze(),g,s.fieldTransforms)}function so(t,e,n,r){return void 0===r&&(r=!1),uo(n,t.$a(r?4:3,e))}function uo(t,e){if(co(t))return ho("Unsupported field value:",e,t),ao(t,e);if(t instanceof Fi)return function(t,e){if(!to(e.wa))throw e.Ta(t.fa+"() can only be used with update() and set()");if(!e.path)throw e.Ta(t.fa+"() is not currently supported inside arrays");var n=t.da(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(e.path&&e.Le.push(e.path),t instanceof Array){if(e.settings.Ia&&4!==e.wa)throw e.Ta("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=uo(o[i],e.Fa(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Jt(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=L.fromDate(t);return{timestampValue:Yt(e.serializer,n)}}if(t instanceof L){var r=new L(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Yt(e.serializer,r)}}if(t instanceof Ki)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Vi)return{bytesValue:Xt(e.serializer,t)};if(t instanceof Yi){var i=e.s,o=t.Va;if(!o.isEqual(i))throw e.Ta("Document reference is for database "+o.projectId+"/"+o.database+" but should be for database "+i.projectId+"/"+i.database);return{referenceValue:ee(t.Va||e.s,t.ga.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.Ta("Unsupported field value: "+Ai(t))}(t,e)}function ao(t,e){var n={};return D(t)?e.path&&e.path.length>0&&e.Le.push(e.path):x(t,(function(t,r){var i=uo(r,e.Sa(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function co(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof L||t instanceof Ki||t instanceof Vi||t instanceof Yi||t instanceof Fi)}function ho(t,e,n){if(!co(n)||!Ni(n)){var r=Ai(n);throw"an object"===r?e.Ta(t+" a custom object"):e.Ta(t+" "+r)}}function fo(t,e,n){if(e instanceof Ui)return e.la;if("string"==typeof e)return lo(t,e);throw po("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}function lo(t,e,n){try{return function(t){if(t.search(Mi)>=0)throw new P(k.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(Ci.bind.apply(Ci,i.__spreadArrays([void 0],t.split("."))))}catch(i){throw new P(k.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e).la}catch(e){throw po((r=e)instanceof Error?r.message:r.toString(),t,!1,void 0,n)}var r}function po(t,e,n,r,i){var o=r&&!r._(),s=void 0!==i,u="Function "+e+"() called with invalid data";n&&(u+=" (via `toFirestore()`)");var a="";return(o||s)&&(a+=" (found",o&&(a+=" in field "+r),s&&(a+=" in document "+i),a+=")"),new P(k.INVALID_ARGUMENT,(u+=". ")+t+a)}function yo(t,e){return t.some((function(t){return t.isEqual(e)}))}var vo=function(){function t(t){this.uid=t}return t.prototype.zr=function(){return null!=this.uid},t.prototype.ka=function(){return this.zr()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();vo.UNAUTHENTICATED=new vo(null),vo.xa=new vo("google-credentials-uid"),vo.Ma=new vo("first-party-uid");var go=function(t,e){this.user=e,this.type="OAuth",this.Oa={},this.Oa.Authorization="Bearer "+t},mo=function(){function t(){this.La=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.Ba=function(){},t.prototype.qa=function(t){this.La=t,t(vo.UNAUTHENTICATED)},t.prototype.Ua=function(){this.La=null},t}(),wo=function(){function t(t){var e=this;this.Qa=null,this.currentUser=vo.UNAUTHENTICATED,this.Wa=!1,this.ja=0,this.La=null,this.forceRefresh=!1,this.Qa=function(){e.ja++,e.currentUser=e.Ka(),e.Wa=!0,e.La&&e.La(e.currentUser)},this.ja=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.Qa):(this.Qa(null),t.get().then((function(t){e.auth=t,e.Qa&&e.auth.addAuthTokenListener(e.Qa)}),(function(){})))}return t.prototype.getToken=function(){var t=this,e=this.ja,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.ja!==e?(p("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(g("string"==typeof n.accessToken),new go(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.Ba=function(){this.forceRefresh=!0},t.prototype.qa=function(t){this.La=t,this.Wa&&t(this.currentUser)},t.prototype.Ua=function(){this.auth&&this.auth.removeAuthTokenListener(this.Qa),this.Qa=null,this.La=null},t.prototype.Ka=function(){var t=this.auth&&this.auth.getUid();return g(null===t||"string"==typeof t),new vo(t)},t}(),_o=function(){function t(t,e){this.Ga=t,this.za=e,this.type="FirstParty",this.user=vo.Ma}return Object.defineProperty(t.prototype,"Oa",{get:function(){var t={"X-Goog-AuthUser":this.za},e=this.Ga.auth.Ha([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),t}(),bo=function(){function t(t,e){this.Ga=t,this.za=e}return t.prototype.getToken=function(){return Promise.resolve(new _o(this.Ga,this.za))},t.prototype.qa=function(t){t(vo.Ma)},t.prototype.Ua=function(){},t.prototype.Ba=function(){},t}(),Io=function(){function t(t,e,n,r,i,o){this.bs=t,this.Ya=n,this.Ja=r,this.Xa=i,this.listener=o,this.state=0,this.Za=0,this.tu=null,this.stream=null,this.$o=new Un(t,e)}return t.prototype.eu=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.nu=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.su()},t.prototype.stop=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return this.eu()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.iu=function(){this.state=0,this.$o.reset()},t.prototype.ru=function(){var t=this;this.nu()&&null===this.tu&&(this.tu=this.bs.Os(this.Ya,6e4,(function(){return t.ou()})))},t.prototype.hu=function(t){this.au(),this.stream.send(t)},t.prototype.ou=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(t){return this.nu()?[2,this.close(0)]:[2]}))}))},t.prototype.au=function(){this.tu&&(this.tu.cancel(),this.tu=null)},t.prototype.close=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(n){switch(n.label){case 0:return this.au(),this.$o.cancel(),this.Za++,3!==t?this.$o.reset():e&&e.code===k.RESOURCE_EXHAUSTED?(d(e.toString()),d("Using maximum backoff delay to prevent overloading the backend."),this.$o.ks()):e&&e.code===k.UNAUTHENTICATED&&this.Xa.Ba(),null!==this.stream&&(this.uu(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.cu(e)];case 1:return n.sent(),[2]}}))}))},t.prototype.uu=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.lu(this.Za),n=this.Za;this.Xa.getToken().then((function(e){t.Za===n&&t._u(e)}),(function(n){e((function(){var e=new P(k.UNKNOWN,"Fetching auth token failed: "+n.message);return t.fu(e)}))}))},t.prototype._u=function(t){var e=this,n=this.lu(this.Za);this.stream=this.du(t),this.stream.wu((function(){n((function(){return e.state=2,e.listener.wu()}))})),this.stream.cu((function(t){n((function(){return e.fu(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.su=function(){var t=this;this.state=4,this.$o.xs((function(){return i.__awaiter(t,void 0,void 0,(function(){return i.__generator(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},t.prototype.fu=function(t){return p("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.lu=function(t){var e=this;return function(n){e.bs.cr((function(){return e.Za===t?n():(p("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},t}(),Eo=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).serializer=i,s}return i.__extends(e,t),e.prototype.du=function(t){return this.Ja.Tu("Listen",t)},e.prototype.onMessage=function(t){this.$o.reset();var e=function(t,e){var n;if("targetChange"in e){e.targetChange;var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:v()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.Oe?(g(void 0===e||"string"==typeof e),$.fromBase64String(e||"")):(g(void 0===e||e instanceof Uint8Array),$.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=e.targetChange.cause,u=s&&function(t){var e=void 0===t.code?k.UNKNOWN:Z(t.code);return new P(e,t.message||"")}(s);n=new It(r,i,o,u||null)}else if("documentChange"in e){e.documentChange;var a=e.documentChange;a.document,a.document.name,a.document.updateTime;var c=ie(t,a.document.name),h=te(a.document.updateTime),f=new Ze({mapValue:{fields:a.document.fields}}),l=new rn(c,h,f,{}),p=a.targetIds||[],d=a.removedTargetIds||[];n=new _t(p,d,l.key,l)}else if("documentDelete"in e){e.documentDelete;var y=e.documentDelete;y.document;var m=ie(t,y.document),w=y.readTime?te(y.readTime):O.min(),_=new on(m,w),b=y.removedTargetIds||[];n=new _t([],b,_.key,_)}else if("documentRemove"in e){e.documentRemove;var I=e.documentRemove;I.document;var E=ie(t,I.document),T=I.removedTargetIds||[];n=new _t([],T,E,null)}else{if(!("filter"in e))return v();e.filter;var N=e.filter;N.targetId;var A=N.count||0,x=new Y(A),D=N.targetId;n=new bt(D,x)}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return O.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?O.min():e.readTime?te(e.readTime):O.min()}(t);return this.listener.Eu(e,n)},e.prototype.Iu=function(t){var e={};e.database=ue(this.serializer),e.addTarget=function(t,e){var n,r=e.target;return(n=W(r)?{documents:le(t,r)}:{query:pe(t,r)}).targetId=e.targetId,e.resumeToken.H()>0&&(n.resumeToken=Xt(t,e.resumeToken)),n}(this.serializer,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return v()}}(0,e.J);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.hu(e)},e.prototype.mu=function(t){var e={};e.database=ue(this.serializer),e.removeTarget=t,this.hu(e)},e}(Io),To=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).serializer=i,s.Au=!1,s}return i.__extends(e,t),Object.defineProperty(e.prototype,"Ru",{get:function(){return this.Au},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.Au=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.uu=function(){this.Au&&this.Pu([])},e.prototype.du=function(t){return this.Ja.Tu("Write",t)},e.prototype.onMessage=function(t){if(g(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Au){this.$o.reset();var e=function(t,e){return t&&t.length>0?(g(void 0!==e),t.map((function(t){return function(t,e){var n=t.updateTime?te(t.updateTime):te(e);n.isEqual(O.min())&&(n=te(e));var r=null;return t.transformResults&&t.transformResults.length>0&&(r=t.transformResults),new Ue(n,r)}(t,e)}))):[]}(t.writeResults,t.commitTime),n=te(t.commitTime);return this.listener.Vu(n,e)}return g(!t.writeResults||0===t.writeResults.length),this.Au=!0,this.listener.gu()},e.prototype.yu=function(){var t={};t.database=ue(this.serializer),this.hu(t)},e.prototype.Pu=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map((function(t){return he(e.serializer,t)}))};this.hu(n)},e}(Io),No=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Ja=e,i.credentials=n,i.serializer=r,i.pu=!1,i}return i.__extends(e,t),e.prototype.bu=function(){if(this.pu)throw new P(k.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.vu=function(t,e){var n=this;return this.bu(),this.credentials.getToken().then((function(r){return n.Ja.vu(t,e,r)})).catch((function(t){throw t.code===k.UNAUTHENTICATED&&n.credentials.Ba(),t}))},e.prototype.Su=function(t,e){var n=this;return this.bu(),this.credentials.getToken().then((function(r){return n.Ja.Su(t,e,r)})).catch((function(t){throw t.code===k.UNAUTHENTICATED&&n.credentials.Ba(),t}))},e}((function(){this.je=void 0})),Ao=function(){function t(t){this.Du=t,this.Cu=new Map,this.mutations=[],this.Fu=!1,this.Nu=null,this.$u=new Set}return t.prototype.ku=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n=this;return i.__generator(this,(function(r){switch(r.label){case 0:if(this.xu(),this.mutations.length>0)throw new P(k.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n,r,o,s,u;return i.__generator(this,(function(i){switch(i.label){case 0:return n=m(t),r={database:ue(n.serializer),documents:e.map((function(t){return re(n.serializer,t)}))},[4,n.Su("BatchGetDocuments",r)];case 1:return o=i.sent(),s=new Map,o.forEach((function(t){var e=function(t,e){return"found"in e?function(t,e){g(!!e.found),e.found.name,e.found.updateTime;var n=ie(t,e.found.name),r=te(e.found.updateTime),i=new Ze({mapValue:{fields:e.found.fields}});return new rn(n,r,i,{})}(t,e):"missing"in e?function(t,e){g(!!e.missing),g(!!e.readTime);var n=ie(t,e.missing),r=te(e.readTime);return new on(n,r)}(t,e):v()}(n.serializer,t);s.set(e.key.toString(),e)})),u=[],[2,(e.forEach((function(t){var e=s.get(t.toString());g(!!e),u.push(e)})),u)]}}))}))}(this.Du,t)];case 1:return[2,((e=r.sent()).forEach((function(t){t instanceof on||t instanceof rn?n.Mu(t):v()})),e)]}}))}))},t.prototype.set=function(t,e){this.write(e.pa(t,this.Ue(t))),this.$u.add(t)},t.prototype.update=function(t,e){try{this.write(e.pa(t,this.Ou(t)))}catch(t){this.Nu=t}this.$u.add(t)},t.prototype.delete=function(t){this.write([new Ye(t,this.Ue(t))]),this.$u.add(t)},t.prototype.commit=function(){return i.__awaiter(this,void 0,void 0,(function(){var t,e=this;return i.__generator(this,(function(n){switch(n.label){case 0:if(this.xu(),this.Nu)throw this.Nu;return t=this.Cu,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,n){var r=new M(V.$(n));e.mutations.push(new Xe(r,e.Ue(r)))})),[4,function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n,r;return i.__generator(this,(function(i){switch(i.label){case 0:return n=m(t),r={database:ue(n.serializer),writes:e.map((function(t){return he(n.serializer,t)}))},[4,n.vu("Commit",r)];case 1:return i.sent(),[2]}}))}))}(this.Du,this.mutations)];case 1:return n.sent(),this.Fu=!0,[2]}}))}))},t.prototype.Mu=function(t){var e;if(t instanceof rn)e=t.version;else{if(!(t instanceof on))throw v();e=O.min()}var n=this.Cu.get(t.key.toString());if(n){if(!e.isEqual(n))throw new P(k.ABORTED,"Document version changed between two reads.")}else this.Cu.set(t.key.toString(),e)},t.prototype.Ue=function(t){var e=this.Cu.get(t.toString());return!this.$u.has(t)&&e?Ce.updateTime(e):Ce.Qe()},t.prototype.Ou=function(t){var e=this.Cu.get(t.toString());if(!this.$u.has(t)&&e){if(e.isEqual(O.min()))throw new P(k.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ce.updateTime(e)}return Ce.exists(!0)},t.prototype.write=function(t){this.xu(),this.mutations=this.mutations.concat(t)},t.prototype.xu=function(){},t}(),xo=function(){function t(t,e){this.mo=t,this.Lu=e,this.state="Unknown",this.Bu=0,this.qu=null,this.Uu=!0}return t.prototype.Qu=function(){var t=this;0===this.Bu&&(this.Wu("Unknown"),this.qu=this.mo.Os("online_state_timeout",1e4,(function(){return t.qu=null,t.ju("Backend didn't respond within 10 seconds."),t.Wu("Offline"),Promise.resolve()})))},t.prototype.Ku=function(t){"Online"===this.state?this.Wu("Unknown"):(this.Bu++,this.Bu>=1&&(this.Gu(),this.ju("Connection failed 1 times. Most recent error: "+t.toString()),this.Wu("Offline")))},t.prototype.set=function(t){this.Gu(),this.Bu=0,"Online"===t&&(this.Uu=!1),this.Wu(t)},t.prototype.Wu=function(t){t!==this.state&&(this.state=t,this.Lu(t))},t.prototype.ju=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Uu?(d(e),this.Uu=!1):p("OnlineStateTracker",e)},t.prototype.Gu=function(){null!==this.qu&&(this.qu.cancel(),this.qu=null)},t}(),Do=function(){function t(t,e,n,r,o){var s=this;this.zu=t,this.Du=e,this.mo=n,this.Hu=[],this.Yu=new Map,this.Ju=null,this.Xu=new Set,this.Zu=o,this.Zu.tc((function(t){n.cr((function(){return i.__awaiter(s,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return this.ec()?(p("RemoteStore","Restarting streams for network reachability change."),[4,this.nc()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.sc=new xo(n,r),this.ic=function(t,e,n){var r=m(t);return new Eo(e,r.Ja,r.credentials,r.serializer,n)}(this.Du,n,{wu:this.rc.bind(this),cu:this.oc.bind(this),Eu:this.hc.bind(this)}),this.ac=function(t,e,n){var r=m(t);return new To(e,r.Ja,r.credentials,r.serializer,n)}(this.Du,n,{wu:this.uc.bind(this),cu:this.cc.bind(this),gu:this.lc.bind(this),Vu:this.Vu.bind(this)})}return t.prototype.start=function(){return this.enableNetwork()},t.prototype.enableNetwork=function(){return this.Xu.delete(0),this._c()},t.prototype._c=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return this.ec()?(this.fc()?this.dc():this.sc.set("Unknown"),[4,this.wc()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.disableNetwork=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return this.Xu.add(0),[4,this.Tc()];case 1:return t.sent(),this.sc.set("Offline"),[2]}}))}))},t.prototype.Tc=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return[4,this.ac.stop()];case 1:return t.sent(),[4,this.ic.stop()];case 2:return t.sent(),this.Hu.length>0&&(p("RemoteStore","Stopping write stream with "+this.Hu.length+" pending writes"),this.Hu=[]),this.Ec(),[2]}}))}))},t.prototype.gr=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return p("RemoteStore","RemoteStore shutting down."),this.Xu.add(5),[4,this.Tc()];case 1:return t.sent(),this.Zu.gr(),this.sc.set("Unknown"),[2]}}))}))},t.prototype.listen=function(t){this.Yu.has(t.targetId)||(this.Yu.set(t.targetId,t),this.fc()?this.dc():this.ic.nu()&&this.Ic(t))},t.prototype.mc=function(t){this.Yu.delete(t),this.ic.nu()&&this.Ac(t),0===this.Yu.size&&(this.ic.nu()?this.ic.ru():this.ec()&&this.sc.set("Unknown"))},t.prototype.Me=function(t){return this.Yu.get(t)||null},t.prototype.xe=function(t){return this.Rc.xe(t)},t.prototype.Ic=function(t){this.Ju.de(t.targetId),this.ic.Iu(t)},t.prototype.Ac=function(t){this.Ju.de(t),this.ic.mu(t)},t.prototype.dc=function(){this.Ju=new Tt(this),this.ic.start(),this.sc.Qu()},t.prototype.fc=function(){return this.ec()&&!this.ic.eu()&&this.Yu.size>0},t.prototype.ec=function(){return 0===this.Xu.size},t.prototype.Ec=function(){this.Ju=null},t.prototype.rc=function(){return i.__awaiter(this,void 0,void 0,(function(){var t=this;return i.__generator(this,(function(e){return this.Yu.forEach((function(e,n){t.Ic(e)})),[2]}))}))},t.prototype.oc=function(t){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){return this.Ec(),this.fc()?(this.sc.Ku(t),this.dc()):this.sc.set("Unknown"),[2]}))}))},t.prototype.hc=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n,r,o;return i.__generator(this,(function(i){switch(i.label){case 0:if(this.sc.set("Online"),!(t instanceof It&&2===t.state&&t.cause))return[3,6];i.label=1;case 1:return i.trys.push([1,3,,5]),[4,this.Pc(t)];case 2:return i.sent(),[3,5];case 3:return n=i.sent(),p("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),[4,this.Vc(n)];case 4:return i.sent(),[3,5];case 5:return[3,13];case 6:if(t instanceof _t?this.Ju.Pe(t):t instanceof bt?this.Ju.De(t):this.Ju.ye(t),e.isEqual(O.min()))return[3,13];i.label=7;case 7:return i.trys.push([7,11,,13]),[4,this.zu.mi()];case 8:return r=i.sent(),e.o(r)>=0?[4,this.gc(e)]:[3,10];case 9:i.sent(),i.label=10;case 10:return[3,13];case 11:return p("RemoteStore","Failed to raise snapshot:",o=i.sent()),[4,this.Vc(o)];case 12:return i.sent(),[3,13];case 13:return[2]}}))}))},t.prototype.Vc=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n=this;return i.__generator(this,(function(r){switch(r.label){case 0:if(!Wr(t))throw t;return this.Xu.add(1),[4,this.Tc()];case 1:return r.sent(),this.sc.set("Offline"),e||(e=function(){return n.zu.mi()}),this.mo._r((function(){return i.__awaiter(n,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return p("RemoteStore","Retrying IndexedDB access"),[4,e()];case 1:return t.sent(),this.Xu.delete(1),[4,this._c()];case 2:return t.sent(),[2]}}))}))})),[2]}}))}))},t.prototype.yc=function(t){var e=this;return t().catch((function(n){return e.Vc(n,t)}))},t.prototype.gc=function(t){var e=this,n=this.Ju.Ne(t);return n.Qt.forEach((function(n,r){if(n.resumeToken.H()>0){var i=e.Yu.get(r);i&&e.Yu.set(r,i.tt(n.resumeToken,t))}})),n.Wt.forEach((function(t){var n=e.Yu.get(t);if(n){e.Yu.set(t,n.tt($.Y,n.X)),e.Ac(t);var r=new J(n.target,t,1,n.sequenceNumber);e.Ic(r)}})),this.Rc.Lh(n)},t.prototype.Pc=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n,r,o;return i.__generator(this,(function(i){switch(i.label){case 0:e=t.cause,n=0,r=t.targetIds,i.label=1;case 1:return n<r.length?(o=r[n],this.Yu.has(o)?[4,this.Rc.pc(o,e)]:[3,3]):[3,5];case 2:i.sent(),this.Yu.delete(o),this.Ju.removeTarget(o),i.label=3;case 3:i.label=4;case 4:return n++,[3,1];case 5:return[2]}}))}))},t.prototype.wc=function(){return i.__awaiter(this,void 0,void 0,(function(){var t,e,n;return i.__generator(this,(function(r){switch(r.label){case 0:t=this.Hu.length>0?this.Hu[this.Hu.length-1].batchId:-1,r.label=1;case 1:if(!this.bc())return[3,7];r.label=2;case 2:return r.trys.push([2,4,,6]),[4,this.zu.Qh(t)];case 3:return null===(e=r.sent())?(0===this.Hu.length&&this.ac.ru(),[3,7]):(t=e.batchId,this.vc(e),[3,6]);case 4:return n=r.sent(),[4,this.Vc(n)];case 5:return r.sent(),[3,6];case 6:return[3,1];case 7:return this.Sc()&&this.Dc(),[2]}}))}))},t.prototype.bc=function(){return this.ec()&&this.Hu.length<10},t.prototype.Cc=function(){return this.Hu.length},t.prototype.vc=function(t){this.Hu.push(t),this.ac.nu()&&this.ac.Ru&&this.ac.Pu(t.mutations)},t.prototype.Sc=function(){return this.ec()&&!this.ac.eu()&&this.Hu.length>0},t.prototype.Dc=function(){this.ac.start()},t.prototype.uc=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(t){return this.ac.yu(),[2]}))}))},t.prototype.lc=function(){return i.__awaiter(this,void 0,void 0,(function(){var t,e,n;return i.__generator(this,(function(r){for(t=0,e=this.Hu;t<e.length;t++)n=e[t],this.ac.Pu(n.mutations);return[2]}))}))},t.prototype.Vu=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n,r,o=this;return i.__generator(this,(function(i){switch(i.label){case 0:return n=this.Hu.shift(),r=xn.from(n,t,e),[4,this.yc((function(){return o.Rc.Fc(r)}))];case 1:return i.sent(),[4,this.wc()];case 2:return i.sent(),[2]}}))}))},t.prototype.cc=function(t){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){switch(e.label){case 0:return t&&this.ac.Ru?[4,this.Nc(t)]:[3,2];case 1:e.sent(),e.label=2;case 2:return this.Sc()&&this.Dc(),[2]}}))}))},t.prototype.Nc=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n,r=this;return i.__generator(this,(function(i){switch(i.label){case 0:return X(n=t.code)&&n!==k.ABORTED?(e=this.Hu.shift(),this.ac.iu(),[4,this.yc((function(){return r.Rc.$c(e.batchId,t)}))]):[3,3];case 1:return i.sent(),[4,this.wc()];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))},t.prototype.kc=function(){return new Ao(this.Du)},t.prototype.nc=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return this.Xu.add(4),[4,this.Tc()];case 1:return t.sent(),this.sc.set("Unknown"),this.ac.iu(),this.ic.iu(),this.Xu.delete(4),[4,this._c()];case 2:return t.sent(),[2]}}))}))},t.prototype.xc=function(t){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){switch(e.label){case 0:return this.mo.Wo(),p("RemoteStore","RemoteStore received new credentials"),this.Xu.add(3),[4,this.Tc()];case 1:return e.sent(),this.sc.set("Unknown"),[4,this.Rc.xc(t)];case 2:return e.sent(),this.Xu.delete(3),[4,this._c()];case 3:return e.sent(),[2]}}))}))},t.prototype.Mc=function(t){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){switch(e.label){case 0:return t?(this.Xu.delete(2),[4,this._c()]):[3,2];case 1:return e.sent(),[3,5];case 2:return t?[3,4]:(this.Xu.add(2),[4,this.Tc()]);case 3:e.sent(),this.sc.set("Unknown"),e.label=4;case 4:e.label=5;case 5:return[2]}}))}))},t}();function So(t,e){return"firestore_clients_"+t+"_"+e}function ko(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.zr()&&(r+="_"+e.uid),r}function Po(t,e){return"firestore_targets_"+t+"_"+e}var Lo=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Oc=function(e,n,r){var i=JSON.parse(r),o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error),s=void 0;return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(s=new P(i.error.code,i.error.message)),o?new t(e,n,i.state,s):(d("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Lc=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Oo=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Oc=function(e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new P(r.error.code,r.error.message)),i?new t(e,r.state,o):(d("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Lc=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Ro=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Oc=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=dt(),s=0;i&&s<r.activeTargetIds.length;++s)i=j(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(d("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),Vo=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Oc=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(d("SharedClientState","Failed to parse online state: "+e),null)},t}(),Uo=function(){function t(){this.activeTargetIds=dt()}return t.prototype.Bc=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.qc=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Lc=function(){var t={activeTargetIds:this.activeTargetIds.F(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),Co=function(){function t(t,e,n,r,i){this.window=t,this.bs=e,this.persistenceKey=n,this.Uc=r,this.Rc=null,this.Lu=null,this.Ps=null,this.Qc=this.Wc.bind(this),this.jc=new tt(b),this.or=!1,this.Kc=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Gc=So(this.persistenceKey,this.Uc),this.zc=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.jc=this.jc.nt(this.Uc,new Uo),this.Hc=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Yc=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.Jc=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Xc=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.Qc)}return t.Hi=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return i.__awaiter(this,void 0,void 0,(function(){var t,e,n,r,o,s,u,a,c,h,f,l=this;return i.__generator(this,(function(i){switch(i.label){case 0:return[4,this.Rc.Sr()];case 1:for(t=i.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Uc&&(o=this.getItem(So(this.persistenceKey,r)))&&(s=Ro.Oc(r,o))&&(this.jc=this.jc.nt(s.clientId,s));for(this.Zc(),(u=this.storage.getItem(this.Xc))&&(a=this.tl(u))&&this.el(a),c=0,h=this.Kc;c<h.length;c++)f=h[c],this.Wc(f);return this.Kc=[],this.window.addEventListener("unload",(function(){return l.gr()})),this.or=!0,[2]}}))}))},t.prototype.ys=function(t){this.setItem(this.zc,JSON.stringify(t))},t.prototype.nl=function(){return this.sl(this.jc)},t.prototype.il=function(t){var e=!1;return this.jc.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},t.prototype.rl=function(t){this.ol(t,"pending")},t.prototype.hl=function(t,e,n){this.ol(t,e,n),this.al(t)},t.prototype.ul=function(t){var e="not-current";if(this.il(t)){var n=this.storage.getItem(Po(this.persistenceKey,t));if(n){var r=Oo.Oc(t,n);r&&(e=r.state)}}return this.cl.Bc(t),this.Zc(),e},t.prototype.ll=function(t){this.cl.qc(t),this.Zc()},t.prototype._l=function(t){return this.cl.activeTargetIds.has(t)},t.prototype.fl=function(t){this.removeItem(Po(this.persistenceKey,t))},t.prototype.dl=function(t,e,n){this.wl(t,e,n)},t.prototype.Ch=function(t,e,n){var r=this;e.forEach((function(t){r.al(t)})),this.currentUser=t,n.forEach((function(t){r.rl(t)}))},t.prototype.Tl=function(t){this.El(t)},t.prototype.gr=function(){this.or&&(this.window.removeEventListener("storage",this.Qc),this.removeItem(this.Gc),this.or=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return p("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){p("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){p("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Wc=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(p("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Gc)return void d("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.bs._r((function(){return i.__awaiter(e,void 0,void 0,(function(){var t,e,r,o,s,u;return i.__generator(this,(function(i){if(this.or){if(null!==n.key)if(this.Hc.test(n.key)){if(null==n.newValue)return t=this.Il(n.key),[2,this.ml(t,null)];if(e=this.Al(n.key,n.newValue))return[2,this.ml(e.clientId,e)]}else if(this.Yc.test(n.key)){if(null!==n.newValue&&(r=this.Rl(n.key,n.newValue)))return[2,this.Pl(r)]}else if(this.Jc.test(n.key)){if(null!==n.newValue&&(o=this.Vl(n.key,n.newValue)))return[2,this.gl(o)]}else if(n.key===this.Xc){if(null!==n.newValue&&(s=this.tl(n.newValue)))return[2,this.el(s)]}else n.key===this.zc&&(u=function(t){var e=Rn.ps;if(null!=t)try{var n=JSON.parse(t);g("number"==typeof n),e=n}catch(t){d("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==Rn.ps&&this.Ps(u)}else this.Kc.push(n);return[2]}))}))}))}},Object.defineProperty(t.prototype,"cl",{get:function(){return this.jc.get(this.Uc)},enumerable:!1,configurable:!0}),t.prototype.Zc=function(){this.setItem(this.Gc,this.cl.Lc())},t.prototype.ol=function(t,e,n){var r=new Lo(this.currentUser,t,e,n),i=ko(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Lc())},t.prototype.al=function(t){var e=ko(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.El=function(t){var e={clientId:this.Uc,onlineState:t};this.storage.setItem(this.Xc,JSON.stringify(e))},t.prototype.wl=function(t,e,n){var r=Po(this.persistenceKey,t),i=new Oo(t,e,n);this.setItem(r,i.Lc())},t.prototype.Il=function(t){var e=this.Hc.exec(t);return e?e[1]:null},t.prototype.Al=function(t,e){var n=this.Il(t);return Ro.Oc(n,e)},t.prototype.Rl=function(t,e){var n=this.Yc.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Lo.Oc(new vo(i),r,e)},t.prototype.Vl=function(t,e){var n=this.Jc.exec(t),r=Number(n[1]);return Oo.Oc(r,e)},t.prototype.tl=function(t){return Vo.Oc(t)},t.prototype.Pl=function(t){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this.Rc.yl(t.batchId,t.state,t.error)]:(p("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},t.prototype.gl=function(t){return this.Rc.pl(t.targetId,t.state,t.error)},t.prototype.ml=function(t,e){var n=this,r=e?this.jc.nt(t,e):this.jc.remove(t),i=this.sl(this.jc),o=this.sl(r),s=[],u=[];return o.forEach((function(t){i.has(t)||s.push(t)})),i.forEach((function(t){o.has(t)||u.push(t)})),this.Rc.bl(s,u).then((function(){n.jc=r}))},t.prototype.el=function(t){this.jc.get(t.clientId)&&this.Lu(t.onlineState)},t.prototype.sl=function(t){var e=dt();return t.forEach((function(t,n){e=e.Ct(n.activeTargetIds)})),e},t}(),Mo=function(){function t(){this.vl=new Uo,this.Sl={},this.Rc=null,this.Lu=null,this.Ps=null}return t.prototype.rl=function(t){},t.prototype.hl=function(t,e,n){},t.prototype.ul=function(t){return this.vl.Bc(t),this.Sl[t]||"not-current"},t.prototype.dl=function(t,e,n){this.Sl[t]=e},t.prototype.ll=function(t){this.vl.qc(t)},t.prototype._l=function(t){return this.vl.activeTargetIds.has(t)},t.prototype.fl=function(t){delete this.Sl[t]},t.prototype.nl=function(){return this.vl.activeTargetIds},t.prototype.il=function(t){return this.vl.activeTargetIds.has(t)},t.prototype.start=function(){return this.vl=new Uo,Promise.resolve()},t.prototype.Ch=function(t,e,n){},t.prototype.Tl=function(t){},t.prototype.gr=function(){},t.prototype.ys=function(t){},t}(),Fo=function(t){this.key=t},qo=function(t){this.key=t},jo=function(){function t(t,e){this.query=t,this.Dl=e,this.Cl=null,this.Ht=!1,this.Fl=lt(),this.Lt=lt(),this.Nl=ln(t),this.$l=new yt(this.Nl)}return Object.defineProperty(t.prototype,"kl",{get:function(){return this.Dl},enumerable:!1,configurable:!0}),t.prototype.xl=function(t,e){var n=this,r=e?e.Ml:new vt,i=e?e.$l:this.$l,o=e?e.Lt:this.Lt,s=i,u=!1,a=this.query.In()&&i.size===this.query.limit?i.last():null,c=this.query.mn()&&i.size===this.query.limit?i.first():null;if(t.ot((function(t,e){var h=i.get(t),f=e instanceof rn?e:null;f&&(f=fn(n.query,f)?f:null);var l=!!h&&n.Lt.has(h.key),p=!!f&&(f.Ge||n.Lt.has(f.key)&&f.hasCommittedMutations),d=!1;h&&f?h.data().isEqual(f.data())?l!==p&&(r.track({type:3,doc:f}),d=!0):n.Ol(h,f)||(r.track({type:2,doc:f}),d=!0,(a&&n.Nl(f,a)>0||c&&n.Nl(f,c)<0)&&(u=!0)):!h&&f?(r.track({type:0,doc:f}),d=!0):h&&!f&&(r.track({type:1,doc:h}),d=!0,(a||c)&&(u=!0)),d&&(f?(s=s.add(f),o=p?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))})),this.query.In()||this.query.mn())for(;s.size>this.query.limit;){var h=this.query.In()?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{$l:s,Ml:r,Ll:u,Lt:o}},t.prototype.Ol=function(t,e){return t.Ge&&e.hasCommittedMutations&&!e.Ge},t.prototype.Jn=function(t,e,n){var r=this,i=this.$l;this.$l=t.$l,this.Lt=t.Lt;var o=t.Ml.Mt();o.sort((function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return v()}};return n(t)-n(e)}(t.type,e.type)||r.Nl(t.doc,e.doc)})),this.Bl(n);var s=e?this.ql():[],u=0===this.Fl.size&&this.Ht?1:0,a=u!==this.Cl;return this.Cl=u,0!==o.length||a?{snapshot:new gt(this.query,t.$l,i,o,t.Lt,0===u,a,!1),Ul:s}:{Ul:s}},t.prototype.Ql=function(t){return this.Ht&&"Offline"===t?(this.Ht=!1,this.Jn({$l:this.$l,Ml:new vt,Lt:this.Lt,Ll:!1},!1)):{Ul:[]}},t.prototype.Wl=function(t){return!this.Dl.has(t)&&!!this.$l.has(t)&&!this.$l.get(t).Ge},t.prototype.Bl=function(t){var e=this;t&&(t.Yt.forEach((function(t){return e.Dl=e.Dl.add(t)})),t.Jt.forEach((function(t){})),t.Xt.forEach((function(t){return e.Dl=e.Dl.delete(t)})),this.Ht=t.Ht)},t.prototype.ql=function(){var t=this;if(!this.Ht)return[];var e=this.Fl;this.Fl=lt(),this.$l.forEach((function(e){t.Wl(e.key)&&(t.Fl=t.Fl.add(e.key))}));var n=[];return e.forEach((function(e){t.Fl.has(e)||n.push(new qo(e))})),this.Fl.forEach((function(t){e.has(t)||n.push(new Fo(t))})),n},t.prototype.jl=function(t){this.Dl=t.zh,this.Fl=lt();var e=this.xl(t.documents);return this.Jn(e,!0)},t.prototype.Kl=function(){return gt.Ut(this.query,this.$l,this.Lt,0===this.Cl)},t}(),zo=function(){function t(t,e,n,r){this.mo=t,this.Du=e,this.updateFunction=n,this.Po=r,this.Gl=5,this.$o=new Un(this.mo,"transaction_retry")}return t.prototype.run=function(){this.zl()},t.prototype.zl=function(){var t=this;this.$o.xs((function(){return i.__awaiter(t,void 0,void 0,(function(){var t,e,n=this;return i.__generator(this,(function(r){return t=new Ao(this.Du),(e=this.Hl(t))&&e.then((function(e){n.mo.cr((function(){return t.commit().then((function(){n.Po.resolve(e)})).catch((function(t){n.Yl(t)}))}))})).catch((function(t){n.Yl(t)})),[2]}))}))}))},t.prototype.Hl=function(t){try{var e=this.updateFunction(t);return!F(e)&&e.catch&&e.then?e:(this.Po.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.Po.reject(t),null}},t.prototype.Yl=function(t){var e=this;this.Gl>0&&this.Jl(t)?(this.Gl-=1,this.mo.cr((function(){return e.zl(),Promise.resolve()}))):this.Po.reject(t)},t.prototype.Jl=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!X(e)}return!1},t}(),Bo=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Go=function(t){this.key=t,this.Xl=!1},Qo=function(){function t(t,e,n,r,i,o){this.zu=t,this.Zl=e,this.Du=n,this.t_=r,this.currentUser=i,this.e_=o,this.n_=null,this.s_=new S((function(t){return cn(t)}),an),this.i_=new Map,this.r_=[],this.o_=new tt(M.P),this.h_=new Map,this.a_=new li,this.u_={},this.c_=new Map,this.l_=sr.di(),this.onlineState="Unknown"}return Object.defineProperty(t.prototype,"__",{get:function(){return!0},enumerable:!1,configurable:!0}),t.prototype.subscribe=function(t){this.n_=t},t.prototype.listen=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n,r,o,s;return i.__generator(this,(function(i){switch(i.label){case 0:return this.f_("listen()"),(r=this.s_.get(t))?(e=r.targetId,this.t_.ul(e),n=r.view.Kl(),[3,4]):[3,1];case 1:return[4,this.zu.jh(t.We())];case 2:return o=i.sent(),s=this.t_.ul(o.targetId),e=o.targetId,[4,this.d_(t,e,"current"===s)];case 3:n=i.sent(),this.__&&this.Zl.listen(o),i.label=4;case 4:return[2,n]}}))}))},t.prototype.d_=function(t,e,n){return i.__awaiter(this,void 0,void 0,(function(){var r,o,s,u,a,c;return i.__generator(this,(function(i){switch(i.label){case 0:return[4,this.zu.Gh(t,!0)];case 1:return r=i.sent(),o=new jo(t,r.zh),s=o.xl(r.documents),u=wt.zt(e,n&&"Offline"!==this.onlineState),a=o.Jn(s,this.__,u),this.w_(e,a.Ul),c=new Bo(t,e,o),[2,(this.s_.set(t,c),this.i_.has(e)?this.i_.get(e).push(t):this.i_.set(e,[t]),a.snapshot)]}}))}))},t.prototype.mc=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n,r=this;return i.__generator(this,(function(i){switch(i.label){case 0:return this.f_("unlisten()"),e=this.s_.get(t),(n=this.i_.get(e.targetId)).length>1?[2,(this.i_.set(e.targetId,n.filter((function(e){return!an(e,t)}))),void this.s_.delete(t))]:this.__?(this.t_.ll(e.targetId),this.t_.il(e.targetId)?[3,2]:[4,this.zu.Kh(e.targetId,!1).then((function(){r.t_.fl(e.targetId),r.Zl.mc(e.targetId),r.T_(e.targetId)})).catch(fi)]):[3,3];case 1:i.sent(),i.label=2;case 2:return[3,5];case 3:return this.T_(e.targetId),[4,this.zu.Kh(e.targetId,!0)];case 4:i.sent(),i.label=5;case 5:return[2]}}))}))},t.prototype.write=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n,r,o;return i.__generator(this,(function(i){switch(i.label){case 0:this.f_("write()"),i.label=1;case 1:return i.trys.push([1,5,,6]),[4,this.zu.kh(t)];case 2:return n=i.sent(),this.t_.rl(n.batchId),this.E_(n.batchId,e),[4,this.I_(n.Un)];case 3:return i.sent(),[4,this.Zl.wc()];case 4:return i.sent(),[3,6];case 5:return r=i.sent(),o=ei(r,"Failed to persist write"),e.reject(o),[3,6];case 6:return[2]}}))}))},t.prototype.runTransaction=function(t,e,n){new zo(t,this.Du,e,n).run()},t.prototype.Lh=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n=this;return i.__generator(this,(function(r){switch(r.label){case 0:this.f_("applyRemoteEvent()"),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.zu.Lh(t)];case 2:return e=r.sent(),t.Qt.forEach((function(t,e){var r=n.h_.get(e);r&&(g(t.Yt.size+t.Jt.size+t.Xt.size<=1),t.Yt.size>0?r.Xl=!0:t.Jt.size>0?g(r.Xl):t.Xt.size>0&&(g(r.Xl),r.Xl=!1))})),[4,this.I_(e,t)];case 3:return r.sent(),[3,6];case 4:return[4,fi(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},t.prototype.Ql=function(t,e){this.f_("applyOnlineStateChange()");var n=[];this.s_.forEach((function(e,r){var i=r.view.Ql(t);i.snapshot&&n.push(i.snapshot)})),this.n_.m_(t),this.n_.Eu(n),this.onlineState=t},t.prototype.pc=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n,r,o,s,u,a=this;return i.__generator(this,(function(i){switch(i.label){case 0:return this.f_("rejectListens()"),this.t_.dl(t,"rejected",e),n=this.h_.get(t),(r=n&&n.key)?(o=(o=new tt(M.P)).nt(r,new on(r,O.min())),s=lt().add(r),u=new mt(O.min(),new Map,new rt(b),o,s),[4,this.Lh(u)]):[3,2];case 1:return i.sent(),this.o_=this.o_.remove(r),this.h_.delete(t),this.A_(),[3,4];case 2:return[4,this.zu.Kh(t,!1).then((function(){return a.T_(t,e)})).catch(fi)];case 3:i.sent(),i.label=4;case 4:return[2]}}))}))},t.prototype.Fc=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n;return i.__generator(this,(function(r){switch(r.label){case 0:this.f_("applySuccessfulWrite()"),e=t.batch.batchId,r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.zu.xh(t)];case 2:return n=r.sent(),this.R_(e,null),this.P_(e),this.t_.hl(e,"acknowledged"),[4,this.I_(n)];case 3:return r.sent(),[3,6];case 4:return[4,fi(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},t.prototype.$c=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n;return i.__generator(this,(function(r){switch(r.label){case 0:this.f_("rejectFailedWrite()"),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.zu.Oh(t)];case 2:return n=r.sent(),this.R_(t,e),this.P_(t),this.t_.hl(t,"rejected",e),[4,this.I_(n)];case 3:return r.sent(),[3,6];case 4:return[4,fi(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},t.prototype.V_=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n,r,o;return i.__generator(this,(function(i){switch(i.label){case 0:this.Zl.ec()||p("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.zu.to()];case 2:return-1===(e=i.sent())?[2,void t.resolve()]:((n=this.c_.get(e)||[]).push(t),this.c_.set(e,n),[3,4]);case 3:return r=i.sent(),o=ei(r,"Initialization of waitForPendingWrites() operation failed"),t.reject(o),[3,4];case 4:return[2]}}))}))},t.prototype.P_=function(t){(this.c_.get(t)||[]).forEach((function(t){t.resolve()})),this.c_.delete(t)},t.prototype.g_=function(t){this.c_.forEach((function(e){e.forEach((function(e){e.reject(new P(k.CANCELLED,t))}))})),this.c_.clear()},t.prototype.E_=function(t,e){var n=this.u_[this.currentUser.ka()];n||(n=new tt(b)),n=n.nt(t,e),this.u_[this.currentUser.ka()]=n},t.prototype.R_=function(t,e){var n=this.u_[this.currentUser.ka()];if(n){var r=n.get(t);r&&(e?r.reject(e):r.resolve(),n=n.remove(t)),this.u_[this.currentUser.ka()]=n}},t.prototype.T_=function(t,e){var n=this;void 0===e&&(e=null),this.t_.ll(t);for(var r=0,i=this.i_.get(t);r<i.length;r++){var o=i[r];this.s_.delete(o),e&&this.n_.y_(o,e)}this.i_.delete(t),this.__&&this.a_.oa(t).forEach((function(t){n.a_.Mi(t)||n.p_(t)}))},t.prototype.p_=function(t){var e=this.o_.get(t);null!==e&&(this.Zl.mc(e),this.o_=this.o_.remove(t),this.h_.delete(e),this.A_())},t.prototype.w_=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof Fo?(this.a_.Fi(i.key,t),this.b_(i)):i instanceof qo?(p("SyncEngine","Document no longer in limbo: "+i.key),this.a_.$i(i.key,t),this.a_.Mi(i.key)||this.p_(i.key)):v()}},t.prototype.b_=function(t){var e=t.key;this.o_.get(e)||(p("SyncEngine","New document in limbo: "+e),this.r_.push(e),this.A_())},t.prototype.A_=function(){for(;this.r_.length>0&&this.o_.size<this.e_;){var t=this.r_.shift(),e=this.l_.next();this.h_.set(e,new Go(t)),this.o_=this.o_.nt(t,e),this.Zl.listen(new J(un.hn(t.path).We(),e,2,Rn.ps))}},t.prototype.v_=function(){return this.o_},t.prototype.S_=function(){return this.r_},t.prototype.I_=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n,r,o,s=this;return i.__generator(this,(function(i){switch(i.label){case 0:return n=[],r=[],o=[],this.s_.forEach((function(i,u){o.push(Promise.resolve().then((function(){var e=u.view.xl(t);return e.Ll?s.zu.Gh(u.query,!1).then((function(t){var n=t.documents;return u.view.xl(n,e)})):e})).then((function(t){var i=e&&e.Qt.get(u.targetId),o=u.view.Jn(t,s.__,i);if(s.w_(u.targetId,o.Ul),o.snapshot){s.__&&s.t_.dl(u.targetId,o.snapshot.fromCache?"not-current":"current"),n.push(o.snapshot);var a=On.Rs(u.targetId,o.snapshot);r.push(a)}})))})),[4,Promise.all(o)];case 1:return i.sent(),this.n_.Eu(n),[4,this.zu.Uh(r)];case 2:return i.sent(),[2]}}))}))},t.prototype.f_=function(t){},t.prototype.xc=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e;return i.__generator(this,(function(n){switch(n.label){case 0:return this.currentUser.isEqual(t)?[3,3]:(p("SyncEngine","User change. New user:",t.ka()),[4,this.zu.Ch(t)]);case 1:return e=n.sent(),this.currentUser=t,this.g_("'waitForPendingWrites' promise is rejected due to a user change."),this.t_.Ch(t,e.Nh,e.$h),[4,this.I_(e.Fh)];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))},t.prototype.enableNetwork=function(){return this.Zl.enableNetwork()},t.prototype.disableNetwork=function(){return this.Zl.disableNetwork()},t.prototype.xe=function(t){var e=this.h_.get(t);if(e&&e.Xl)return lt().add(e.key);var n=lt(),r=this.i_.get(t);if(!r)return n;for(var i=0,o=r;i<o.length;i++){var s=o[i],u=this.s_.get(s);n=n.Ct(u.view.kl)}return n},t}();function Wo(t,e,n,r,i,o){return new Qo(t,e,n,r,i,o)}var $o=function(t){function e(e,n,r,i,o,s){var u=this;return(u=t.call(this,e,n,r,i,o,s)||this).zu=e,u.D_=void 0,u}return i.__extends(e,t),Object.defineProperty(e.prototype,"__",{get:function(){return!0===this.D_},enumerable:!1,configurable:!0}),e.prototype.enableNetwork=function(){return this.zu.ur(!0),t.prototype.enableNetwork.call(this)},e.prototype.disableNetwork=function(){return this.zu.ur(!1),t.prototype.disableNetwork.call(this)},e.prototype.C_=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n;return i.__generator(this,(function(r){switch(r.label){case 0:return[4,this.zu.Gh(t.query,!0)];case 1:return e=r.sent(),n=t.view.jl(e),[2,(this.D_&&this.w_(t.targetId,n.Ul),n)]}}))}))},e.prototype.Ql=function(e,n){this.__&&0===n&&(t.prototype.Ql.call(this,e,n),this.t_.Tl(e)),this.__||1!==n||t.prototype.Ql.call(this,e,n)},e.prototype.yl=function(t,e,n){return i.__awaiter(this,void 0,void 0,(function(){var r;return i.__generator(this,(function(i){switch(i.label){case 0:return this.f_("applyBatchState()"),[4,this.zu.Yh(t)];case 1:return null===(r=i.sent())?[3,6]:"pending"!==e?[3,3]:[4,this.Zl.wc()];case 2:return i.sent(),[3,4];case 3:"acknowledged"===e||"rejected"===e?(this.R_(t,n||null),this.zu.Jh(t)):v(),i.label=4;case 4:return[4,this.I_(r)];case 5:return i.sent(),[3,7];case 6:p("SyncEngine","Cannot apply mutation batch with id: "+t),i.label=7;case 7:return[2]}}))}))},e.prototype.Mc=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n,r,o,s,u,a,c=this;return i.__generator(this,(function(i){switch(i.label){case 0:return!0!==t||!0===this.D_?[3,3]:(e=this.t_.nl(),[4,this.F_(e.F(),!0)]);case 1:return n=i.sent(),this.D_=!0,[4,this.Zl.Mc(!0)];case 2:for(i.sent(),r=0,o=n;r<o.length;r++)s=o[r],this.Zl.listen(s);return[3,7];case 3:return!1!==t||!1===this.D_?[3,7]:(u=[],a=Promise.resolve(),this.i_.forEach((function(t,e){c.t_._l(e)?u.push(e):a=a.then((function(){return c.T_(e),c.zu.Kh(e,!0)})),c.Zl.mc(e)})),[4,a]);case 4:return i.sent(),[4,this.F_(u,!1)];case 5:return i.sent(),this.N_(),this.D_=!1,[4,this.Zl.Mc(!1)];case 6:i.sent(),i.label=7;case 7:return[2]}}))}))},e.prototype.N_=function(){var t=this;this.h_.forEach((function(e,n){t.Zl.mc(n)})),this.a_.ha(),this.h_=new Map,this.o_=new tt(M.P)},e.prototype.F_=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var e,n,r,o,s,u,a,c,h,f,l,p,d;return i.__generator(this,(function(i){switch(i.label){case 0:e=[],n=[],r=0,o=t,i.label=1;case 1:return r<o.length?(s=o[r],u=void 0,(a=this.i_.get(s))&&0!==a.length?[4,this.zu.jh(a[0].We())]:[3,7]):[3,13];case 2:u=i.sent(),c=0,h=a,i.label=3;case 3:return c<h.length?(f=h[c],l=this.s_.get(f),[4,this.C_(l)]):[3,6];case 4:(p=i.sent()).snapshot&&n.push(p.snapshot),i.label=5;case 5:return c++,[3,3];case 6:return[3,11];case 7:return[4,this.zu.Xh(s)];case 8:return d=i.sent(),[4,this.zu.jh(d)];case 9:return u=i.sent(),[4,this.d_(this.k_(d),s,!1)];case 10:i.sent(),i.label=11;case 11:e.push(u),i.label=12;case 12:return r++,[3,1];case 13:return[2,(this.n_.Eu(n),e)]}}))}))},e.prototype.k_=function(t){return new un(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)},e.prototype.Sr=function(){return this.zu.Sr()},e.prototype.pl=function(t,e,n){return i.__awaiter(this,void 0,void 0,(function(){var r,o;return i.__generator(this,(function(i){switch(i.label){case 0:return this.D_?(p("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!this.i_.has(t))return[3,8];switch(e){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,this.zu.si()];case 3:return r=i.sent(),o=mt.Gt(t,"current"===e),[4,this.I_(r,o)];case 4:return i.sent(),[3,8];case 5:return[4,this.zu.Kh(t,!0)];case 6:return i.sent(),this.T_(t,n),[3,8];case 7:v(),i.label=8;case 8:return[2]}}))}))},e.prototype.bl=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n,r,o,s,u,a,c,h,f,l,d=this;return i.__generator(this,(function(y){switch(y.label){case 0:if(!this.D_)return[3,10];n=0,r=t,y.label=1;case 1:return n<r.length?(o=r[n],this.i_.has(o)?(p("SyncEngine","Adding an already active target "+o),[3,5]):[4,this.zu.Xh(o)]):[3,6];case 2:return s=y.sent(),[4,this.zu.jh(s)];case 3:return u=y.sent(),[4,this.d_(this.k_(s),u.targetId,!1)];case 4:y.sent(),this.Zl.listen(u),y.label=5;case 5:return n++,[3,1];case 6:a=function(t){return i.__generator(this,(function(e){switch(e.label){case 0:return c.i_.has(t)?[4,c.zu.Kh(t,!1).then((function(){d.Zl.mc(t),d.T_(t)})).catch(fi)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},c=this,h=0,f=e,y.label=7;case 7:return h<f.length?(l=f[h],[5,a(l)]):[3,10];case 8:y.sent(),y.label=9;case 9:return h++,[3,7];case 10:return[2]}}))}))},e}(Qo),Ko=function(){this.x_=void 0,this.listeners=[]},Ho=function(){function t(t){this.Rc=t,this.M_=new S((function(t){return cn(t)}),an),this.onlineState="Unknown",this.O_=new Set,this.Rc.subscribe(this)}return t.prototype.listen=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n,r,o,s,u;return i.__generator(this,(function(i){switch(i.label){case 0:if(e=t.query,n=!1,(r=this.M_.get(e))||(n=!0,r=new Ko),!n)return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),o=r,[4,this.Rc.listen(e)];case 2:return o.x_=i.sent(),[3,4];case 3:return s=i.sent(),u=ei(s,"Initialization of query '"+hn(t.query)+"' failed"),[2,void t.onError(u)];case 4:return this.M_.set(e,r),r.listeners.push(t),t.Ql(this.onlineState),r.x_&&t.L_(r.x_)&&this.B_(),[2]}}))}))},t.prototype.mc=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n,r,o;return i.__generator(this,(function(i){return e=t.query,n=!1,(r=this.M_.get(e))&&(o=r.listeners.indexOf(t))>=0&&(r.listeners.splice(o,1),n=0===r.listeners.length),n?[2,(this.M_.delete(e),this.Rc.mc(e))]:[2]}))}))},t.prototype.Eu=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,s=this.M_.get(o);if(s){for(var u=0,a=s.listeners;u<a.length;u++)a[u].L_(i)&&(e=!0);s.x_=i}}e&&this.B_()},t.prototype.y_=function(t,e){var n=this.M_.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.M_.delete(t)},t.prototype.m_=function(t){this.onlineState=t;var e=!1;this.M_.forEach((function(n,r){for(var i=0,o=r.listeners;i<o.length;i++)o[i].Ql(t)&&(e=!0)})),e&&this.B_()},t.prototype.q_=function(t){this.O_.add(t),t.next()},t.prototype.U_=function(t){this.O_.delete(t)},t.prototype.B_=function(){this.O_.forEach((function(t){t.next()}))},t}(),Jo=function(){function t(t,e,n){this.query=t,this.Q_=e,this.W_=!1,this.j_=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.L_=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new gt(t.query,t.docs,t.Ot,e,t.Lt,t.fromCache,t.Bt,!0)}var o=!1;return this.W_?this.K_(t)&&(this.Q_.next(t),o=!0):this.G_(t,this.onlineState)&&(this.z_(t),o=!0),this.j_=t,o},t.prototype.onError=function(t){this.Q_.error(t)},t.prototype.Ql=function(t){this.onlineState=t;var e=!1;return this.j_&&!this.W_&&this.G_(this.j_,t)&&(this.z_(this.j_),e=!0),e},t.prototype.G_=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.H_&&n||t.docs._()&&"Offline"!==e)},t.prototype.K_=function(t){if(t.docChanges.length>0)return!0;var e=this.j_&&this.j_.hasPendingWrites!==t.hasPendingWrites;return!(!t.Bt&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.z_=function(t){t=gt.Ut(t.query,t.docs,t.Lt,t.fromCache),this.W_=!0,this.Q_.next(t)},t}(),Yo=function(){function t(){}return t.prototype.Dh=function(t){this.Y_=t},t.prototype._s=function(t,e,n,r){var i=this;return e.En()||n.isEqual(O.min())?this.J_(t,e):this.Y_.us(t,r).next((function(o){var u=i.X_(e,o);return(e.In()||e.mn())&&i.Ll(e.nn,u,r,n)?i.J_(t,e):(l()<=s.LogLevel.DEBUG&&p("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),hn(e)),i.Y_._s(t,e,n).next((function(t){return u.forEach((function(e){t=t.nt(e.key,e)})),t})))}))},t.prototype.X_=function(t,e){var n=new rt(ln(t));return e.forEach((function(e,r){r instanceof rn&&fn(t,r)&&(n=n.add(r))})),n},t.prototype.Ll=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.o(r)>0)},t.prototype.J_=function(t,e){return l()<=s.LogLevel.DEBUG&&p("IndexFreeQueryEngine","Using full collection scan to execute query:",hn(e)),this.Y_._s(t,e,O.min())},t}(),Xo=function(){function t(t,e){this.ss=t,this.wi=e,this.ns=[],this.Z_=1,this.tf=new rt(pi.ta)}return t.prototype.Hr=function(t){return Dn.resolve(0===this.ns.length)},t.prototype.Yr=function(t,e,n,r){var i=this.Z_;this.Z_++,this.ns.length>0&&this.ns[this.ns.length-1];var o=new An(i,e,n,r);this.ns.push(o);for(var s=0,u=r;s<u.length;s++){var a=u[s];this.tf=this.tf.add(new pi(a.key,i)),this.ss.Us(t,a.key.path.p())}return Dn.resolve(o)},t.prototype.Jr=function(t,e){return Dn.resolve(this.ef(e))},t.prototype.Zr=function(t,e){var n=e+1,r=this.nf(n),i=r<0?0:r;return Dn.resolve(this.ns.length>i?this.ns[i]:null)},t.prototype.to=function(){return Dn.resolve(0===this.ns.length?-1:this.Z_-1)},t.prototype.eo=function(t){return Dn.resolve(this.ns.slice())},t.prototype.os=function(t,e){var n=this,r=new pi(e,0),i=new pi(e,Number.POSITIVE_INFINITY),o=[];return this.tf.vt([r,i],(function(t){var e=n.ef(t.ua);o.push(e)})),Dn.resolve(o)},t.prototype.ls=function(t,e){var n=this,r=new rt(b);return e.forEach((function(t){var e=new pi(t,0),i=new pi(t,Number.POSITIVE_INFINITY);n.tf.vt([e,i],(function(t){r=r.add(t.ua)}))})),Dn.resolve(this.sf(r))},t.prototype.Es=function(t,e){var n=e.path,r=n.length+1,i=n;M.W(i)||(i=i.child(""));var o=new pi(new M(i),0),s=new rt(b);return this.tf.St((function(t){var e=t.key.path;return!!n.D(e)&&(e.length===r&&(s=s.add(t.ua)),!0)}),o),Dn.resolve(this.sf(s))},t.prototype.sf=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.ef(t);null!==r&&n.push(r)})),n},t.prototype.so=function(t,e){var n=this;g(0===this.if(e.batchId,"removed")),this.ns.shift();var r=this.tf;return Dn.forEach(e.mutations,(function(i){var o=new pi(i.key,e.batchId);return r=r.delete(o),n.wi.qr(t,i.key)})).next((function(){n.tf=r}))},t.prototype.io=function(t){},t.prototype.Mi=function(t,e){var n=new pi(e,0),r=this.tf.Dt(n);return Dn.resolve(e.isEqual(r&&r.key))},t.prototype.ro=function(t){return this.ns.length,Dn.resolve()},t.prototype.if=function(t,e){return this.nf(t)},t.prototype.nf=function(t){return 0===this.ns.length?0:t-this.ns[0].batchId},t.prototype.ef=function(t){var e=this.nf(t);return e<0||e>=this.ns.length?null:this.ns[e]},t}(),Zo=function(){function t(t,e){this.ss=t,this.rf=e,this.docs=new tt(M.P),this.size=0}return t.prototype.jn=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.rf(e);return this.docs=this.docs.nt(r,{Ys:e,size:s,readTime:n}),this.size+=s-o,this.ss.Us(t,r.path.p())},t.prototype.Gn=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.zn=function(t,e){var n=this.docs.get(e);return Dn.resolve(n?n.Ys:null)},t.prototype.getEntries=function(t,e){var n=this,r=ut();return e.forEach((function(t){var e=n.docs.get(t);r=r.nt(t,e?e.Ys:null)})),Dn.resolve(r)},t.prototype._s=function(t,e,n){for(var r=ct(),i=new M(e.path.child("")),o=this.docs.ut(i);o.wt();){var s=o.dt(),u=s.key,a=s.value,c=a.Ys,h=a.readTime;if(!e.path.D(u.path))break;h.o(n)<=0||c instanceof rn&&fn(e,c)&&(r=r.nt(c.key,c))}return Dn.resolve(r)},t.prototype.hf=function(t,e){return Dn.forEach(this.docs,(function(t){return e(t)}))},t.prototype.oi=function(e){return new t.hi(this)},t.prototype.ui=function(t){return Dn.resolve(this.size)},t}();Zo.hi=function(t){function e(e){var n=this;return(n=t.call(this)||this).ci=e,n}return i.__extends(e,t),e.prototype.Jn=function(t){var e=this,n=[];return this.Un.forEach((function(r,i){i?n.push(e.ci.jn(t,i,e.readTime)):e.ci.Gn(r)})),Dn.Bn(n)},e.prototype.Hn=function(t,e){return this.ci.zn(t,e)},e.prototype.Yn=function(t,e){return this.ci.getEntries(t,e)},e}(Sn);var ts=function(){function t(t){this.persistence=t,this.af=new S((function(t){return G(t)}),Q),this.lastRemoteSnapshotVersion=O.min(),this.highestTargetId=0,this.uf=0,this.cf=new li,this.targetCount=0,this.lf=sr.fi()}return t.prototype.pe=function(t,e){return this.af.forEach((function(t,n){return e(n)})),Dn.resolve()},t.prototype.mi=function(t){return Dn.resolve(this.lastRemoteSnapshotVersion)},t.prototype.Ai=function(t){return Dn.resolve(this.uf)},t.prototype.Ti=function(t){return this.highestTargetId=this.lf.next(),Dn.resolve(this.highestTargetId)},t.prototype.Ri=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.uf&&(this.uf=e),Dn.resolve()},t.prototype.Vi=function(t){this.af.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.lf=new sr(e),this.highestTargetId=e),t.sequenceNumber>this.uf&&(this.uf=t.sequenceNumber)},t.prototype.Pi=function(t,e){return this.Vi(e),this.targetCount+=1,Dn.resolve()},t.prototype.yi=function(t,e){return this.Vi(e),Dn.resolve()},t.prototype.pi=function(t,e){return this.af.delete(e.target),this.cf.oa(e.targetId),this.targetCount-=1,Dn.resolve()},t.prototype.vi=function(t,e,n){var r=this,i=0,o=[];return this.af.forEach((function(s,u){u.sequenceNumber<=e&&null===n.get(u.targetId)&&(r.af.delete(s),o.push(r.bi(t,u.targetId)),i++)})),Dn.Bn(o).next((function(){return i}))},t.prototype.Si=function(t){return Dn.resolve(this.targetCount)},t.prototype.Di=function(t,e){var n=this.af.get(e)||null;return Dn.resolve(n)},t.prototype.Ci=function(t,e,n){return this.cf.sa(e,n),Dn.resolve()},t.prototype.Ni=function(t,e,n){this.cf.ra(e,n);var r=this.persistence.wi,i=[];return r&&e.forEach((function(e){i.push(r.qr(t,e))})),Dn.Bn(i)},t.prototype.bi=function(t,e){return this.cf.oa(e),Dn.resolve()},t.prototype.ki=function(t,e){var n=this.cf.aa(e);return Dn.resolve(n)},t.prototype.Mi=function(t,e){return Dn.resolve(this.cf.Mi(e))},t}(),es=function(){function t(t){var e=this;this._f={},this.Ui=new Rn(0),this.Qi=!1,this.Qi=!0,this.wi=t(this),this.Ji=new ts(this),this.ss=new jn,this.es=new Zo(this.ss,(function(t){return e.wi.ff(t)}))}return t.prototype.start=function(){return Promise.resolve()},t.prototype.gr=function(){return this.Qi=!1,Promise.resolve()},Object.defineProperty(t.prototype,"or",{get:function(){return this.Qi},enumerable:!1,configurable:!0}),t.prototype.hr=function(){},t.prototype.$r=function(){return this.ss},t.prototype.Dr=function(t){var e=this._f[t.ka()];return e||(e=new Xo(this.ss,this.wi),this._f[t.ka()]=e),e},t.prototype.Fr=function(){return this.Ji},t.prototype.Nr=function(){return this.es},t.prototype.runTransaction=function(t,e,n){var r=this;p("MemoryPersistence","Starting transaction:",t);var i=new ns(this.Ui.next());return this.wi.df(),n(i).next((function(t){return r.wi.wf(i).next((function(){return t}))})).On().then((function(t){return i.ts(),t}))},t.prototype.Tf=function(t,e){return Dn.qn(Object.values(this._f).map((function(n){return function(){return n.Mi(t,e)}})))},t}(),ns=function(t){function e(e){var n=this;return(n=t.call(this)||this).Li=e,n}return i.__extends(e,t),e}(Pn),rs=function(){function t(t){this.persistence=t,this.Ef=new li,this.If=null}return t.mf=function(e){return new t(e)},Object.defineProperty(t.prototype,"Af",{get:function(){if(this.If)return this.If;throw v()},enumerable:!1,configurable:!0}),t.prototype.Fi=function(t,e,n){return this.Ef.Fi(n,e),this.Af.delete(n),Dn.resolve()},t.prototype.$i=function(t,e,n){return this.Ef.$i(n,e),this.Af.add(n),Dn.resolve()},t.prototype.qr=function(t,e){return this.Af.add(e),Dn.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.Ef.oa(e.targetId).forEach((function(t){return n.Af.add(t)}));var r=this.persistence.Fr();return r.ki(t,e.targetId).next((function(t){t.forEach((function(t){return n.Af.add(t)}))})).next((function(){return r.pi(t,e)}))},t.prototype.df=function(){this.If=new Set},t.prototype.wf=function(t){var e=this,n=this.persistence.Nr().oi();return Dn.forEach(this.Af,(function(r){return e.Rf(t,r).next((function(t){t||n.Gn(r)}))})).next((function(){return e.If=null,n.apply(t)}))},t.prototype.jr=function(t,e){var n=this;return this.Rf(t,e).next((function(t){t?n.Af.delete(e):n.Af.add(e)}))},t.prototype.ff=function(t){return 0},t.prototype.Rf=function(t,e){var n=this;return Dn.qn([function(){return Dn.resolve(n.Ef.Mi(e))},function(){return n.persistence.Fr().Mi(t,e)},function(){return n.persistence.Tf(t,e)}])},t}(),is=function(){function t(t){this.Pf=t.Pf,this.Vf=t.Vf}return t.prototype.wu=function(t){this.gf=t},t.prototype.cu=function(t){this.yf=t},t.prototype.onMessage=function(t){this.pf=t},t.prototype.close=function(){this.Vf()},t.prototype.send=function(t){this.Pf(t)},t.prototype.bf=function(){this.gf()},t.prototype.vf=function(t){this.yf(t)},t.prototype.Sf=function(t){this.pf(t)},t}(),os={BatchGetDocuments:"batchGet",Commit:"commit"},ss="gl-js/ fire/"+h,us=function(){function t(t){this.s=t.s;var e=t.ssl?"https":"http";this.Df=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}return t.prototype.Cf=function(t,e){if(e)for(var n in e.Oa)e.Oa.hasOwnProperty(n)&&(t[n]=e.Oa[n]);t["X-Goog-Api-Client"]=ss},t.prototype.vu=function(t,e,n){var r=this,i=this.Ff(t);return new Promise((function(o,s){var u=new a.XhrIo;u.listenOnce(a.EventType.COMPLETE,(function(){try{switch(u.getLastErrorCode()){case a.ErrorCode.NO_ERROR:var e=u.getResponseJson();p("Connection","XHR received:",JSON.stringify(e)),o(e);break;case a.ErrorCode.TIMEOUT:p("Connection",'RPC "'+t+'" timed out'),s(new P(k.DEADLINE_EXCEEDED,"Request time out"));break;case a.ErrorCode.HTTP_ERROR:var n=u.getStatus();if(p("Connection",'RPC "'+t+'" failed with status:',n,"response text:",u.getResponseText()),n>0){var r=u.getResponseJson().error;if(r&&r.status&&r.message){var i=function(t){var e=t.toLowerCase().replace("_","-");return Object.values(k).indexOf(e)>=0?e:k.UNKNOWN}(r.status);s(new P(i,r.message))}else s(new P(k.UNKNOWN,"Server responded with status "+u.getStatus()))}else p("Connection",'RPC "'+t+'" failed'),s(new P(k.UNAVAILABLE,"Connection failed."));break;default:v()}}finally{p("Connection",'RPC "'+t+'" completed.')}}));var c=Object.assign({},e);delete c.database;var h=JSON.stringify(c);p("Connection","XHR sending: ",i+" "+h);var f={"Content-Type":"text/plain"};r.Cf(f,n),u.send(i,"POST",h,f,15)}))},t.prototype.Su=function(t,e,n){return this.vu(t,e,n)},t.prototype.Tu=function(t,e){var n=[this.Df,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=a.createWebChannelTransport(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.s.projectId+"/databases/"+this.s.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.Cf(o.initMessageHeaders,e),u.isMobileCordova()||u.isReactNative()||u.isElectron()||u.isIE()||u.isUWP()||u.isBrowserExtension()||(o.httpHeadersOverwriteParam="$httpHeaders");var c=n.join("");p("Connection","Creating WebChannel: "+c+" "+o);var l=r.createWebChannel(c,o),d=!1,v=!1,m=new is({Pf:function(t){v?p("Connection","Not sending because WebChannel is closed:",t):(d||(p("Connection","Opening WebChannel transport."),l.open(),d=!0),p("Connection","WebChannel sending:",t),l.send(t))},Vf:function(){return l.close()}}),w=function(t,e){l.listen(t,(function(t){try{e(t)}catch(t){setTimeout((function(){throw t}),0)}}))};return w(a.WebChannel.EventType.OPEN,(function(){v||p("Connection","WebChannel transport opened.")})),w(a.WebChannel.EventType.CLOSE,(function(){v||(v=!0,p("Connection","WebChannel transport closed"),m.vf())})),w(a.WebChannel.EventType.ERROR,(function(t){v||(v=!0,function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(f.logLevel<=s.LogLevel.WARN){var r=e.map(y);f.warn.apply(f,i.__spreadArrays(["Firestore ("+h+"): "+t],r))}}("Connection","WebChannel transport errored:",t),m.vf(new P(k.UNAVAILABLE,"The operation could not be completed")))})),w(a.WebChannel.EventType.MESSAGE,(function(t){var e;if(!v){var n=t.data[0];g(!!n);var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){p("Connection","WebChannel received error:",i);var o=i.status,s=function(t){var e=K[t];if(void 0!==e)return Z(e)}(o),u=i.message;void 0===s&&(s=k.INTERNAL,u="Unknown error status: "+o+" with message "+i.message),v=!0,m.vf(new P(s,u)),l.close()}else p("Connection","WebChannel received:",n),m.Sf(n)}})),setTimeout((function(){m.bf()}),0),m},t.prototype.Ff=function(t){var e=os[t];return this.Df+"/v1/projects/"+this.s.projectId+"/databases/"+this.s.database+"/documents:"+e},t}(),as=function(){function t(){var t=this;this.Nf=function(){return t.$f()},this.kf=function(){return t.xf()},this.Mf=[],this.Of()}return t.prototype.tc=function(t){this.Mf.push(t)},t.prototype.gr=function(){window.removeEventListener("online",this.Nf),window.removeEventListener("offline",this.kf)},t.prototype.Of=function(){window.addEventListener("online",this.Nf),window.addEventListener("offline",this.kf)},t.prototype.$f=function(){p("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.Mf;t<e.length;t++)(0,e[t])(0)},t.prototype.xf=function(){p("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.Mf;t<e.length;t++)(0,e[t])(1)},t.Hi=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),cs=function(){function t(){}return t.prototype.tc=function(t){},t.prototype.gr=function(){},t}(),hs="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.",fs=function(){function t(){}return t.prototype.initialize=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e=this;return i.__generator(this,(function(n){switch(n.label){case 0:return this.t_=this.Lf(t),this.persistence=this.Bf(t),[4,this.persistence.start()];case 1:return n.sent(),this.qf=this.Uf(t),this.zu=this.Qf(t),this.Zl=this.Wf(t),this.Rc=this.jf(t),this.Kf=this.Gf(t),this.t_.Lu=function(t){return e.Rc.Ql(t,1)},this.Zl.Rc=this.Rc,[4,this.zu.start()];case 2:return n.sent(),[4,this.t_.start()];case 3:return n.sent(),[4,this.Zl.start()];case 4:return n.sent(),[4,this.Zl.Mc(this.Rc.__)];case 5:return n.sent(),[2]}}))}))},t.prototype.Gf=function(t){return new Ho(this.Rc)},t.prototype.Uf=function(t){return null},t.prototype.Qf=function(t){return ci(this.persistence,new Yo,t.zf)},t.prototype.Bf=function(t){if(t.Yf.Hf)throw new P(k.FAILED_PRECONDITION,hs);return new es(rs.mf)},t.prototype.Wf=function(t){var e=this;return new Do(this.zu,t.Du,t.mo,(function(t){return e.Rc.Ql(t,0)}),as.Hi()?new as:new cs)},t.prototype.Lf=function(t){return new Mo},t.prototype.jf=function(t){return Wo(this.zu,this.Zl,t.Du,this.t_,t.zf,t.e_)},t.prototype.clearPersistence=function(t,e){throw new P(k.FAILED_PRECONDITION,hs)},t}(),ls=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.prototype.initialize=function(e){return i.__awaiter(this,void 0,void 0,(function(){var n=this;return i.__generator(this,(function(r){switch(r.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return r.sent(),[4,this.persistence.rr((function(t){return i.__awaiter(n,void 0,void 0,(function(){return i.__generator(this,(function(e){switch(e.label){case 0:return[4,this.Rc.Mc(t)];case 1:return e.sent(),this.qf&&(t&&!this.qf.or?this.qf.start(this.zu):t||this.qf.stop()),[2]}}))}))}))];case 2:return r.sent(),[2]}}))}))},e.prototype.Qf=function(t){return e=this.persistence,n=new Yo,r=t.zf,new hi(e,n,r);var e,n,r},e.prototype.jf=function(t){var e,n,r,i,o,s,u=(e=this.zu,n=this.Zl,r=t.Du,i=this.t_,o=t.zf,s=t.e_,new $o(e,n,r,i,o,s));return this.t_ instanceof Co&&(this.t_.Rc=u),u},e.prototype.Lf=function(t){if(t.Yf.Hf&&t.Yf.synchronizeTabs){var e=Xr();if(!Co.Hi(e))throw new P(k.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=mr(t.Jf.s,t.Jf.persistenceKey);return new Co(e,t.mo,n,t.clientId,t.zf)}return new Mo},e}(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.prototype.Qf=function(t){return ci(this.persistence,new Yo,t.zf)},e.prototype.jf=function(t){return Wo(this.zu,this.Zl,t.Du,this.t_,t.zf,t.e_)},e.prototype.Uf=function(t){var e=this.persistence.wi.xr;return new si(e,t.mo)},e.prototype.Bf=function(t){var e=mr(t.Jf.s,t.Jf.persistenceKey),n=Hi(t.Jf.s);return new pr(t.Yf.synchronizeTabs,e,t.clientId,oi.oh(t.Yf.cacheSizeBytes),t.mo,Xr(),"undefined"!=typeof document?document:null,n,this.t_,t.Yf.qi)},e.prototype.Lf=function(t){return new Mo},e.prototype.clearPersistence=function(t,e){return function(t){return i.__awaiter(this,void 0,void 0,(function(){var e;return i.__generator(this,(function(n){switch(n.label){case 0:return Br.Hi()?(e=t+"main",[4,Br.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}}))}))}(mr(t,e))},e}(fs)),ps=function(){function t(t,e){this.credentials=t,this.mo=e,this.clientId=_.t()}return t.prototype.start=function(t,e,n){var r=this;this.bu(),this.Jf=t;var i=new Vn,o=new Vn,s=!1;return this.credentials.qa((function(t){if(!s)return s=!0,p("FirestoreClient","Initializing. user=",t.uid),r.Xf(e,n,t,o).then(i.resolve,i.reject);r.mo._r((function(){return r.Zl.xc(t)}))})),this.mo.cr((function(){return i.promise})),o.promise},t.prototype.enableNetwork=function(){var t=this;return this.bu(),this.mo.enqueue((function(){return t.Rc.enableNetwork()}))},t.prototype.Xf=function(t,e,n,r){return i.__awaiter(this,void 0,void 0,(function(){var o,s,u,a,c,h=this;return i.__generator(this,(function(f){switch(f.label){case 0:return f.trys.push([0,3,,4]),[4,(c=this.Jf,Promise.resolve(new us(c)))];case 1:return o=f.sent(),s=Hi(this.Jf.s),u=function(t,e,n){return new No(t,e,n)}(o,this.credentials,s),[4,t.initialize({mo:this.mo,Jf:this.Jf,Du:u,clientId:this.clientId,zf:n,e_:100,Yf:e})];case 2:return f.sent(),this.persistence=t.persistence,this.t_=t.t_,this.zu=t.zu,this.Zl=t.Zl,this.Rc=t.Rc,this.qf=t.qf,this.Zf=t.Kf,this.persistence.hr((function(){return i.__awaiter(h,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}}))}))})),r.resolve(),[3,4];case 3:if(a=f.sent(),r.reject(a),!this.td(a))throw a;return[2,(console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+a),this.Xf(new fs,{Hf:!1},n,r))];case 4:return[2]}}))}))},t.prototype.td=function(t){return"FirebaseError"===t.name?t.code===k.FAILED_PRECONDITION||t.code===k.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},t.prototype.bu=function(){if(this.mo.xo)throw new P(k.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.disableNetwork=function(){var t=this;return this.bu(),this.mo.enqueue((function(){return t.Rc.disableNetwork()}))},t.prototype.terminate=function(){var t=this;return this.mo.qo((function(){return i.__awaiter(t,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return this.qf&&this.qf.stop(),[4,this.Zl.gr()];case 1:return t.sent(),[4,this.t_.gr()];case 2:return t.sent(),[4,this.persistence.gr()];case 3:return t.sent(),this.credentials.Ua(),[2]}}))}))}))},t.prototype.waitForPendingWrites=function(){var t=this;this.bu();var e=new Vn;return this.mo.cr((function(){return t.Rc.V_(e)})),e.promise},t.prototype.listen=function(t,e,n){var r=this;this.bu();var i=new Jo(t,e,n);return this.mo.cr((function(){return r.Zf.listen(i)})),i},t.prototype.mc=function(t){var e=this;this.ed||this.mo.cr((function(){return e.Zf.mc(t)}))},t.prototype.nd=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n=this;return i.__generator(this,(function(r){switch(r.label){case 0:return this.bu(),e=new Vn,[4,this.mo.enqueue((function(){return i.__awaiter(n,void 0,void 0,(function(){var n,r,o;return i.__generator(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.zu.Wh(t)];case 1:return(n=i.sent())instanceof rn?e.resolve(n):n instanceof on?e.resolve(null):e.reject(new P(k.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=i.sent(),o=ei(r,"Failed to get document '"+t+" from cache"),e.reject(o),[3,3];case 3:return[2]}}))}))}))];case 1:return[2,(r.sent(),e.promise)]}}))}))},t.prototype.sd=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n=this;return i.__generator(this,(function(r){switch(r.label){case 0:return this.bu(),e=new Vn,[4,this.mo.enqueue((function(){return i.__awaiter(n,void 0,void 0,(function(){var n,r,o,s,u,a;return i.__generator(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.zu.Gh(t,!0)];case 1:return n=i.sent(),r=new jo(t,n.zh),o=r.xl(n.documents),s=r.Jn(o,!1),e.resolve(s.snapshot),[3,3];case 2:return u=i.sent(),a=ei(u,"Failed to execute query '"+t+" against cache"),e.reject(a),[3,3];case 3:return[2]}}))}))}))];case 1:return[2,(r.sent(),e.promise)]}}))}))},t.prototype.write=function(t){var e=this;this.bu();var n=new Vn;return this.mo.cr((function(){return e.Rc.write(t,n)})),n.promise},t.prototype.s=function(){return this.Jf.s},t.prototype.q_=function(t){var e=this;this.bu(),this.mo.cr((function(){return e.Zf.q_(t),Promise.resolve()}))},t.prototype.U_=function(t){var e=this;this.ed||this.mo.cr((function(){return e.Zf.U_(t),Promise.resolve()}))},Object.defineProperty(t.prototype,"ed",{get:function(){return this.mo.xo},enumerable:!1,configurable:!0}),t.prototype.transaction=function(t){var e=this;this.bu();var n=new Vn;return this.mo.cr((function(){return e.Rc.runTransaction(e.mo,t,n),Promise.resolve()})),n.promise},t}(),ds=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.rd(this.observer.next,t)},t.prototype.error=function(t){this.rd(this.observer.error,t)},t.prototype.od=function(){this.muted=!0},t.prototype.rd=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}();function ys(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}var vs=function(){function t(t,e,n,r){this.s=t,this.timestampsInSnapshots=e,this.hd=n,this.ad=r}return t.prototype.ud=function(t){switch(kt(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Ct(t.integerValue||t.doubleValue);case 3:return this.ld(t.timestampValue);case 4:return this._d(t);case 5:return t.stringValue;case 6:return new Vi(Mt(t.bytesValue));case 7:return this.fd(t.referenceValue);case 8:return this.dd(t.geoPointValue);case 9:return this.wd(t.arrayValue);case 10:return this.Td(t.mapValue);default:throw v()}},t.prototype.Td=function(t){var e=this,n={};return x(t.fields||{},(function(t,r){n[t]=e.ud(r)})),n},t.prototype.dd=function(t){return new Ki(Ct(t.latitude),Ct(t.longitude))},t.prototype.wd=function(t){var e=this;return(t.values||[]).map((function(t){return e.ud(t)}))},t.prototype._d=function(t){switch(this.hd){case"previous":var e=function t(e){var n=e.mapValue.fields.__previous_value__;return xt(n)?t(n):n}(t);return null==e?null:this.ud(e);case"estimate":return this.ld(Dt(t));default:return null}},t.prototype.ld=function(t){var e=Ut(t),n=new L(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()},t.prototype.fd=function(t){var e=V.$(t);g(be(e));var n=new N(e.get(1),e.get(3)),r=new M(e.g(5));return n.isEqual(this.s)||d("Document "+r+" contains a document reference within a different database ("+n.projectId+"/"+n.database+") which is not supported. It will be treated as a reference in the current database ("+this.s.projectId+"/"+this.s.database+") instead."),this.ad(r)},t}(),gs=oi.uh,ms=function(){function t(t){var e,n,r,i;if(void 0===t.host){if(void 0!==t.ssl)throw new P(k.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else _i("settings","non-empty string","host",t.host),this.host=t.host,bi("settings","boolean","ssl",t.ssl),this.ssl=null===(e=t.ssl)||void 0===e||e;if(Di("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling","ignoreUndefinedProperties"]),bi("settings","object","credentials",t.credentials),this.credentials=t.credentials,bi("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),bi("settings","boolean","ignoreUndefinedProperties",t.ignoreUndefinedProperties),!0===t.timestampsInSnapshots?d("The setting 'timestampsInSnapshots: true' is no longer required and should be removed."):!1===t.timestampsInSnapshots&&d("Support for 'timestampsInSnapshots: false' will be removed soon. You must update your code to handle Timestamp objects."),this.timestampsInSnapshots=null===(n=t.timestampsInSnapshots)||void 0===n||n,this.ignoreUndefinedProperties=null!==(r=t.ignoreUndefinedProperties)&&void 0!==r&&r,bi("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=oi._h;else{if(t.cacheSizeBytes!==gs&&t.cacheSizeBytes<oi.lh)throw new P(k.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+oi.lh);this.cacheSizeBytes=t.cacheSizeBytes}bi("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=null!==(i=t.experimentalForceLongPolling)&&void 0!==i&&i}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},t}(),ws=function(){function t(e,n,r){var o=this;if(void 0===r&&(r=new fs),this.Ed=null,this.Id=new ti,this.INTERNAL={delete:function(){return i.__awaiter(o,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return this.md(),[4,this.Ad.terminate()];case 1:return t.sent(),[2]}}))}))}},"object"==typeof e.options){var s=e;this.Ed=s,this.Va=t.Rd(s),this.Pd=s.name,this.Vd=new wo(n)}else{var u=e;if(!u.projectId)throw new P(k.INVALID_ARGUMENT,"Must provide projectId");this.Va=new N(u.projectId,u.database),this.Pd="[DEFAULT]",this.Vd=new mo}this.gd=r,this.yd=new ms({})}return Object.defineProperty(t.prototype,"pd",{get:function(){return this.bd||(this.bd=new no(this.Va,this.yd.ignoreUndefinedProperties)),this.bd},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){yi("Firestore.settings",arguments,1),mi("Firestore.settings","object",1,t);var e=new ms(t);if(this.Ad&&!this.yd.isEqual(e))throw new P(k.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");this.yd=e,void 0!==e.credentials&&(this.Vd=function(t){if(!t)return new mo;switch(t.type){case"gapi":var e=t.vd;return g(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new bo(e,t.za||"0");case"provider":return t.vd;default:throw new P(k.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},t.prototype.enableNetwork=function(){return this.md(),this.Ad.enableNetwork()},t.prototype.disableNetwork=function(){return this.md(),this.Ad.disableNetwork()},t.prototype.enablePersistence=function(t){var e,n;if(this.Ad)throw new P(k.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var r=!1,i=!1;if(t&&(void 0!==t.experimentalTabSynchronization&&d("The 'experimentalTabSynchronization' setting will be removed. Use 'synchronizeTabs' instead."),r=null!==(n=null!==(e=t.synchronizeTabs)&&void 0!==e?e:t.experimentalTabSynchronization)&&void 0!==n&&n,i=!!t.experimentalForceOwningTab&&t.experimentalForceOwningTab,r&&i))throw new P(k.INVALID_ARGUMENT,"The 'experimentalForceOwningTab' setting cannot be used with 'synchronizeTabs'.");return this.Sd(this.gd,{Hf:!0,cacheSizeBytes:this.yd.cacheSizeBytes,synchronizeTabs:r,qi:i})},t.prototype.clearPersistence=function(){return i.__awaiter(this,void 0,void 0,(function(){var t,e=this;return i.__generator(this,(function(n){if(void 0!==this.Ad&&!this.Ad.ed)throw new P(k.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");return t=new Vn,[2,(this.Id.Mo((function(){return i.__awaiter(e,void 0,void 0,(function(){var e;return i.__generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.gd.clearPersistence(this.Va,this.Pd)];case 1:return n.sent(),t.resolve(),[3,3];case 2:return e=n.sent(),t.reject(e),[3,3];case 3:return[2]}}))}))})),t.promise)]}))}))},t.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(t.prototype,"Dd",{get:function(){return this.md(),this.Ad.ed},enumerable:!1,configurable:!0}),t.prototype.waitForPendingWrites=function(){return this.md(),this.Ad.waitForPendingWrites()},t.prototype.onSnapshotsInSync=function(t){if(this.md(),ys(t))return _s(this.Ad,t);mi("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return _s(this.Ad,e)},t.prototype.md=function(){return this.Ad||this.Sd(new fs,{Hf:!1}),this.Ad},t.prototype.Cd=function(){return new T(this.Va,this.Pd,this.yd.host,this.yd.ssl,this.yd.forceLongPolling)},t.prototype.Sd=function(t,e){var n=this.Cd();return this.Ad=new ps(this.Vd,this.Id),this.Ad.start(n,t,e)},t.Rd=function(t){if(e=t.options,!Object.prototype.hasOwnProperty.call(e,"projectId"))throw new P(k.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var e,n=t.options.projectId;if(!n||"string"!=typeof n)throw new P(k.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new N(n)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.Ed)throw new P(k.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Ed},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){return yi("Firestore.collection",arguments,1),mi("Firestore.collection","non-empty string",1,t),this.md(),new Ls(V.$(t),this,null)},t.prototype.doc=function(t){return yi("Firestore.doc",arguments,1),mi("Firestore.doc","non-empty string",1,t),this.md(),Es.Fd(V.$(t),this,null)},t.prototype.collectionGroup=function(t){if(yi("Firestore.collectionGroup",arguments,1),mi("Firestore.collectionGroup","non-empty string",1,t),t.indexOf("/")>=0)throw new P(k.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.md(),new Ss(new un(V.k(),t),this,null)},t.prototype.runTransaction=function(t){var e=this;return yi("Firestore.runTransaction",arguments,1),mi("Firestore.runTransaction","function",1,t),this.md().transaction((function(n){return t(new bs(e,n))}))},t.prototype.batch=function(){return this.md(),new Is(this)},Object.defineProperty(t,"logLevel",{get:function(){switch(l()){case s.LogLevel.DEBUG:return"debug";case s.LogLevel.ERROR:return"error";case s.LogLevel.SILENT:return"silent";case s.LogLevel.WARN:return"warn";case s.LogLevel.INFO:return"info";case s.LogLevel.VERBOSE:return"verbose";default:return"error"}},enumerable:!1,configurable:!0}),t.setLogLevel=function(t){var e;yi("Firestore.setLogLevel",arguments,1),Ei("setLogLevel",["debug","error","silent","warn","info","verbose"],1,t),e=t,f.setLogLevel(e)},t.prototype.Nd=function(){return this.yd.timestampsInSnapshots},t}();function _s(t,e){var n=new ds({next:function(){e.next&&e.next()},error:function(t){throw v()}});return t.q_(n),function(){n.od(),t.U_(n)}}var bs=function(){function t(t,e){this.$d=t,this.kd=e}return t.prototype.get=function(t){var e=this;yi("Transaction.get",arguments,1);var n=Us("Transaction.get",t,this.$d);return this.kd.ku([n.ga]).then((function(t){if(!t||1!==t.length)return v();var r=t[0];if(r instanceof on)return new As(e.$d,n.ga,null,!1,!1,n.ya);if(r instanceof rn)return new As(e.$d,n.ga,r,!1,!1,n.ya);throw v()}))},t.prototype.set=function(t,e,n){gi("Transaction.set",arguments,2,3);var r=Us("Transaction.set",t,this.$d);n=Os("Transaction.set",n);var i=Ms(r.ya,e,n),o=ro(this.$d.pd,"Transaction.set",r.ga,i,null!==r.ya,n);return this.kd.set(r.ga,o),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return"string"==typeof e||e instanceof Ci?(vi("Transaction.update",arguments,3),r=Us("Transaction.update",t,this.$d),i=oo(this.$d.pd,"Transaction.update",r.ga,e,n,o)):(yi("Transaction.update",arguments,2),r=Us("Transaction.update",t,this.$d),i=io(this.$d.pd,"Transaction.update",r.ga,e)),this.kd.update(r.ga,i),this},t.prototype.delete=function(t){yi("Transaction.delete",arguments,1);var e=Us("Transaction.delete",t,this.$d);return this.kd.delete(e.ga),this},t}(),Is=function(){function t(t){this.$d=t,this.xd=[],this.Md=!1}return t.prototype.set=function(t,e,n){gi("WriteBatch.set",arguments,2,3),this.Od();var r=Us("WriteBatch.set",t,this.$d);n=Os("WriteBatch.set",n);var i=Ms(r.ya,e,n),o=ro(this.$d.pd,"WriteBatch.set",r.ga,i,null!==r.ya,n);return this.xd=this.xd.concat(o.pa(r.ga,Ce.Qe())),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.Od(),"string"==typeof e||e instanceof Ci?(vi("WriteBatch.update",arguments,3),r=Us("WriteBatch.update",t,this.$d),i=oo(this.$d.pd,"WriteBatch.update",r.ga,e,n,o)):(yi("WriteBatch.update",arguments,2),r=Us("WriteBatch.update",t,this.$d),i=io(this.$d.pd,"WriteBatch.update",r.ga,e)),this.xd=this.xd.concat(i.pa(r.ga,Ce.exists(!0))),this},t.prototype.delete=function(t){yi("WriteBatch.delete",arguments,1),this.Od();var e=Us("WriteBatch.delete",t,this.$d);return this.xd=this.xd.concat(new Ye(e.ga,Ce.Qe())),this},t.prototype.commit=function(){return this.Od(),this.Md=!0,this.xd.length>0?this.$d.md().write(this.xd):Promise.resolve()},t.prototype.Od=function(){if(this.Md)throw new P(k.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}(),Es=function(t){function e(e,n,r){var i=this;return(i=t.call(this,n.Va,e,r)||this).ga=e,i.firestore=n,i.ya=r,i.Ad=i.firestore.md(),i}return i.__extends(e,t),e.Fd=function(t,n,r){if(t.length%2!=0)throw new P(k.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.N()+" has "+t.length);return new e(new M(t),n,r)},Object.defineProperty(e.prototype,"id",{get:function(){return this.ga.path.S()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return new Ls(this.ga.path.p(),this.firestore,this.ya)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this.ga.path.N()},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){if(yi("DocumentReference.collection",arguments,1),mi("DocumentReference.collection","non-empty string",1,t),!t)throw new P(k.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=V.$(t);return new Ls(this.ga.path.child(e),this.firestore,null)},e.prototype.isEqual=function(t){if(!(t instanceof e))throw Si("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.ga.isEqual(t.ga)&&this.ya===t.ya},e.prototype.set=function(t,e){gi("DocumentReference.set",arguments,1,2),e=Os("DocumentReference.set",e);var n=Ms(this.ya,t,e),r=ro(this.firestore.pd,"DocumentReference.set",this.ga,n,null!==this.ya,e);return this.Ad.write(r.pa(this.ga,Ce.Qe()))},e.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return"string"==typeof t||t instanceof Ci?(vi("DocumentReference.update",arguments,2),n=oo(this.firestore.pd,"DocumentReference.update",this.ga,t,e,r)):(yi("DocumentReference.update",arguments,1),n=io(this.firestore.pd,"DocumentReference.update",this.ga,t)),this.Ad.write(n.pa(this.ga,Ce.exists(!0)))},e.prototype.delete=function(){return yi("DocumentReference.delete",arguments,0),this.Ad.write([new Ye(this.ga,Ce.Qe())])},e.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];gi("DocumentReference.onSnapshot",arguments,1,4);var s={includeMetadataChanges:!1},u=0;"object"!=typeof i[u]||ys(i[u])||(Di("DocumentReference.onSnapshot",s=i[u],["includeMetadataChanges"]),bi("DocumentReference.onSnapshot","boolean","includeMetadataChanges",s.includeMetadataChanges),u++);var a={includeMetadataChanges:s.includeMetadataChanges};if(ys(i[u])){var c=i[u];i[u]=null===(t=c.next)||void 0===t?void 0:t.bind(c),i[u+1]=null===(e=c.error)||void 0===e?void 0:e.bind(c),i[u+2]=null===(n=c.complete)||void 0===n?void 0:n.bind(c)}else mi("DocumentReference.onSnapshot","function",u,i[u]),wi("DocumentReference.onSnapshot","function",u+1,i[u+1]),wi("DocumentReference.onSnapshot","function",u+2,i[u+2]);var h={next:function(t){i[u]&&i[u](r.Ld(t))},error:i[u+1],complete:i[u+2]};return Ts(this.Ad,this.ga,a,h)},e.prototype.get=function(t){var e=this;return gi("DocumentReference.get",arguments,0,1),Vs("DocumentReference.get",t),t&&"cache"===t.source?this.firestore.md().nd(this.ga).then((function(t){return new As(e.firestore,e.ga,t,!0,t instanceof rn&&t.Ge,e.ya)})):function(t,e,n){var r=new Vn,i=Ts(t,e,{includeMetadataChanges:!0,H_:!0},{next:function(t){i();var o=t.docs.has(e);!o&&t.fromCache?r.reject(new P(k.UNAVAILABLE,"Failed to get document because the client is offline.")):o&&t.fromCache&&n&&"server"===n.source?r.reject(new P(k.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(t)},error:function(t){return r.reject(t)}});return r.promise}(this.Ad,this.ga,t).then((function(t){return e.Ld(t)}))},e.prototype.withConverter=function(t){return new e(this.ga,this.firestore,t)},e.prototype.Ld=function(t){var e=t.docs.get(this.ga);return new As(this.firestore,this.ga,e,t.fromCache,t.hasPendingWrites,this.ya)},e}(Yi);function Ts(t,e,n,r){var i=function(t){console.error("Uncaught Error in onSnapshot:",t)};r.error&&(i=r.error.bind(r));var o=new ds({next:function(t){r.next&&r.next(t)},error:i}),s=t.listen(un.hn(e.path),o,n);return function(){o.od(),t.mc(s)}}var Ns=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),As=function(){function t(t,e,n,r,i,o){this.$d=t,this.ga=e,this.Bd=n,this.qd=r,this.Ud=i,this.ya=o}return t.prototype.data=function(t){var e=this;if(gi("DocumentSnapshot.data",arguments,0,1),t=Rs("DocumentSnapshot.data",t),this.Bd){if(this.ya){var n=new xs(this.$d,this.ga,this.Bd,this.qd,this.Ud,null);return this.ya.fromFirestore(n,t)}return new vs(this.$d.Va,this.$d.Nd(),t.serverTimestamps||"none",(function(t){return new Es(t,e.$d,null)})).ud(this.Bd.tn())}},t.prototype.get=function(t,e){var n=this;if(gi("DocumentSnapshot.get",arguments,1,2),e=Rs("DocumentSnapshot.get",e),this.Bd){var r=this.Bd.data().field(fo("DocumentSnapshot.get",t,this.ga));if(null!==r)return new vs(this.$d.Va,this.$d.Nd(),e.serverTimestamps||"none",(function(t){return new Es(t,n.$d,n.ya)})).ud(r)}},Object.defineProperty(t.prototype,"id",{get:function(){return this.ga.path.S()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Es(this.ga,this.$d,this.ya)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return null!==this.Bd},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return new Ns(this.Ud,this.qd)},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){if(!(e instanceof t))throw Si("isEqual","DocumentSnapshot",1,e);return this.$d===e.$d&&this.qd===e.qd&&this.ga.isEqual(e.ga)&&(null===this.Bd?null===e.Bd:this.Bd.isEqual(e.Bd))&&this.ya===e.ya},t}(),xs=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.prototype.data=function(e){return t.prototype.data.call(this,e)},e}(As);function Ds(t){if(t.mn()&&0===t.en.length)throw new P(k.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Ss=function(t){function e(e,n,r){var i=this;return(i=t.call(this,n.Va,n.pd,e)||this).Qd=e,i.firestore=n,i.ya=r,i}return i.__extends(e,t),e.prototype.where=function(t,n,r){yi("Query.where",arguments,3),xi("Query.where",3,r);var i=Ei("Query.where",["<","<=","==",">=",">","array-contains","in","array-contains-any"],2,n),o=fo("Query.where",t),s=this.Wd(o,i,r);return new e(this.Qd.cn(s),this.firestore,this.ya)},e.prototype.orderBy=function(t,n){var r;if(gi("Query.orderBy",arguments,1,2),wi("Query.orderBy","non-empty string",2,n),void 0===n||"asc"===n)r="asc";else{if("desc"!==n)throw new P(k.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+n+"', expected 'asc' or 'desc'.");r="desc"}var i=fo("Query.orderBy",t),o=this.zd(i,r);return new e(this.Qd.ln(o),this.firestore,this.ya)},e.prototype.limit=function(t){return yi("Query.limit",arguments,1),mi("Query.limit","number",1,t),ki("Query.limit",1,t),new e(this.Qd._n(t),this.firestore,this.ya)},e.prototype.limitToLast=function(t){return yi("Query.limitToLast",arguments,1),mi("Query.limitToLast","number",1,t),ki("Query.limitToLast",1,t),new e(this.Qd.fn(t),this.firestore,this.ya)},e.prototype.startAt=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];vi("Query.startAt",arguments,1);var i=this.Zd("Query.startAt",t,n,!0);return new e(this.Qd.dn(i),this.firestore,this.ya)},e.prototype.startAfter=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];vi("Query.startAfter",arguments,1);var i=this.Zd("Query.startAfter",t,n,!1);return new e(this.Qd.dn(i),this.firestore,this.ya)},e.prototype.endBefore=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];vi("Query.endBefore",arguments,1);var i=this.Zd("Query.endBefore",t,n,!0);return new e(this.Qd.wn(i),this.firestore,this.ya)},e.prototype.endAt=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];vi("Query.endAt",arguments,1);var i=this.Zd("Query.endAt",t,n,!1);return new e(this.Qd.wn(i),this.firestore,this.ya)},e.prototype.isEqual=function(t){if(!(t instanceof e))throw Si("isEqual","Query",1,t);return this.firestore===t.firestore&&an(this.Qd,t.Qd)&&this.ya===t.ya},e.prototype.withConverter=function(t){return new e(this.Qd,this.firestore,t)},e.prototype.Zd=function(t,e,n,r){if(xi(t,1,e),e instanceof As)return yi(t,i.__spreadArrays([e],n),1),this.Yd(t,e.Bd,r);var o=[e].concat(n);return this.Jd(t,o,r)},e.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];gi("Query.onSnapshot",arguments,1,4);var s={},u=0;if("object"!=typeof i[u]||ys(i[u])||(Di("Query.onSnapshot",s=i[u],["includeMetadataChanges"]),bi("Query.onSnapshot","boolean","includeMetadataChanges",s.includeMetadataChanges),u++),ys(i[u])){var a=i[u];i[u]=null===(t=a.next)||void 0===t?void 0:t.bind(a),i[u+1]=null===(e=a.error)||void 0===e?void 0:e.bind(a),i[u+2]=null===(n=a.complete)||void 0===n?void 0:n.bind(a)}else mi("Query.onSnapshot","function",u,i[u]),wi("Query.onSnapshot","function",u+1,i[u+1]),wi("Query.onSnapshot","function",u+2,i[u+2]);var c={next:function(t){i[u]&&i[u](new Ps(r.firestore,r.Qd,t,r.ya))},error:i[u+1],complete:i[u+2]};return Ds(this.Qd),ks(this.firestore.md(),this.Qd,s,c)},e.prototype.get=function(t){var e=this;gi("Query.get",arguments,0,1),Vs("Query.get",t),Ds(this.Qd);var n=this.firestore.md();return(t&&"cache"===t.source?n.sd(this.Qd):function(t,e,n){var r=new Vn,i=ks(t,e,{includeMetadataChanges:!0,H_:!0},{next:function(t){i(),t.fromCache&&n&&"server"===n.source?r.reject(new P(k.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(t)},error:function(t){return r.reject(t)}});return r.promise}(n,this.Qd,t)).then((function(t){return new Ps(e.firestore,e.Qd,t,e.ya)}))},e}(function(){function t(t,e,n){this.Va=t,this.pd=e,this.Qd=n}return t.prototype.Wd=function(t,e,n){var r;if(t.O()){if("array-contains"===e||"array-contains-any"===e)throw new P(k.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+e+"' queries on FieldPath.documentId().");if("in"===e){this.jd(n,e);for(var i=[],o=0,s=n;o<s.length;o++){var u=s[o];i.push(this.Kd(u))}r={arrayValue:{values:i}}}else r=this.Kd(n)}else"in"!==e&&"array-contains-any"!==e||this.jd(n,e),r=so(this.pd,"Query.where",n,"in"===e);var a=pn.create(t,e,r);return this.Gd(a),a},t.prototype.zd=function(t,e){if(null!==this.Qd.startAt)throw new P(k.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this.Qd.endAt)throw new P(k.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var n=new En(t,e);return this.Hd(n),n},t.prototype.Yd=function(t,e,n){if(!e)throw new P(k.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");for(var r=[],i=0,o=this.Qd.orderBy;i<o.length;i++){var s=o[i];if(s.field.O())r.push(Ft(this.Va,e.key));else{var u=e.field(s.field);if(xt(u))throw new P(k.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+s.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===u){var a=s.field.N();throw new P(k.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+a+"' (used as the orderBy) does not exist.")}r.push(u)}}return new wn(r,n)},t.prototype.Jd=function(t,e,n){var r=this.Qd.en;if(e.length>r.length)throw new P(k.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var s=e[o];if(r[o].field.O()){if("string"!=typeof s)throw new P(k.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof s);if(!this.Qd.Vn()&&-1!==s.indexOf("/"))throw new P(k.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+s+"' contains a slash.");var u=this.Qd.path.child(V.$(s));if(!M.W(u))throw new P(k.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+u+"' is not because it contains an odd number of segments.");var a=new M(u);i.push(Ft(this.Va,a))}else{var c=so(this.pd,t,s);i.push(c)}}return new wn(i,n)},t.prototype.Kd=function(t){if("string"==typeof t){if(""===t)throw new P(k.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this.Qd.Vn()&&-1!==t.indexOf("/"))throw new P(k.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this.Qd.path.child(V.$(t));if(!M.W(e))throw new P(k.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return Ft(this.Va,new M(e))}if(t instanceof Yi)return Ft(this.Va,t.ga);throw new P(k.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Ai(t)+".")},t.prototype.jd=function(t,e){if(!Array.isArray(t)||0===t.length)throw new P(k.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new P(k.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(t.indexOf(null)>=0)throw new P(k.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(t.filter((function(t){return Number.isNaN(t)})).length>0)throw new P(k.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},t.prototype.Gd=function(t){if(t instanceof pn){var e=["array-contains","array-contains-any"],n=["in","array-contains-any"],r=e.indexOf(t.op)>=0,i=n.indexOf(t.op)>=0;if(t.An()){var o=this.Qd.an();if(null!==o&&!o.isEqual(t.field))throw new P(k.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var s=this.Qd.un();null!==s&&this.Xd(t.field,s)}else if(i||r){var u=null;if(i&&(u=this.Qd.Rn(n)),null===u&&r&&(u=this.Qd.Rn(e)),null!==u)throw u===t.op?new P(k.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new P(k.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+u.toString()+"' filters.")}}},t.prototype.Hd=function(t){if(null===this.Qd.un()){var e=this.Qd.an();null!==e&&this.Xd(e,t.field)}},t.prototype.Xd=function(t,e){if(!e.isEqual(t))throw new P(k.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},t}());function ks(t,e,n,r){var i=function(t){console.error("Uncaught Error in onSnapshot:",t)};r.error&&(i=r.error.bind(r));var o=new ds({next:function(t){r.next&&r.next(t)},error:i}),s=t.listen(e,o,n);return function(){o.od(),t.mc(s)}}var Ps=function(){function t(t,e,n,r){this.$d=t,this.tw=e,this.ew=n,this.ya=r,this.nw=null,this.sw=null,this.metadata=new Ns(n.hasPendingWrites,n.fromCache)}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this.ew.docs._()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.ew.docs.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;gi("QuerySnapshot.forEach",arguments,1,2),mi("QuerySnapshot.forEach","function",1,t),this.ew.docs.forEach((function(r){t.call(e,n.iw(r,n.metadata.fromCache,n.ew.Lt.has(r.key)))}))},Object.defineProperty(t.prototype,"query",{get:function(){return new Ss(this.tw,this.$d,this.ya)},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){t&&(Di("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),bi("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.ew.qt)throw new P(k.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.nw&&this.sw===e||(this.nw=function(t,e,n){if(t.Ot._()){var r=0;return t.docChanges.map((function(e){var i=n(e.doc,t.fromCache,t.Lt.has(e.doc.key));return e.doc,{type:"added",doc:i,oldIndex:-1,newIndex:r++}}))}var i=t.Ot;return t.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var r=n(e.doc,t.fromCache,t.Lt.has(e.doc.key)),o=-1,s=-1;return 0!==e.type&&(o=i.indexOf(e.doc.key),i=i.delete(e.doc.key)),1!==e.type&&(s=(i=i.add(e.doc)).indexOf(e.doc.key)),{type:Cs(e.type),doc:r,oldIndex:o,newIndex:s}}))}(this.ew,e,this.iw.bind(this)),this.sw=e),this.nw},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Si("isEqual","QuerySnapshot",1,e);return this.$d===e.$d&&an(this.tw,e.tw)&&this.ew.isEqual(e.ew)&&this.ya===e.ya},t.prototype.iw=function(t,e,n){return new xs(this.$d,t.key,t,e,n,this.ya)},t}(),Ls=function(t){function e(e,n,r){var i=this;if((i=t.call(this,un.hn(e),n,r)||this).rw=e,e.length%2!=1)throw new P(k.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+e.N()+" has "+e.length);return i}return i.__extends(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this.Qd.path.S()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this.Qd.path.p();return t._()?null:new Es(new M(t),this.firestore,null)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this.Qd.path.N()},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){gi("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=_.t()),mi("CollectionReference.doc","non-empty string",1,t);var e=V.$(t);return Es.Fd(this.Qd.path.child(e),this.firestore,this.ya)},e.prototype.add=function(t){yi("CollectionReference.add",arguments,1),mi("CollectionReference.add","object",1,this.ya?this.ya.toFirestore(t):t);var e=this.doc();return e.set(t).then((function(){return e}))},e.prototype.withConverter=function(t){return new e(this.rw,this.firestore,t)},e}(Ss);function Os(t,e){if(void 0===e)return{merge:!1};if(Di(t,e,["merge","mergeFields"]),bi(t,"boolean","merge",e.merge),function(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new P(k.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+Ai(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new P(k.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be a string or a FieldPath, but the value at index "+o+" was: "+Ai(r[o]))}(t,"mergeFields",0,r,(function(t){return"string"==typeof t||t instanceof Ci}))}(t,0,0,e.mergeFields),void 0!==e.mergeFields&&void 0!==e.merge)throw new P(k.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Rs(t,e){return void 0===e?{}:(Di(t,e,["serverTimestamps"]),Ii(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function Vs(t,e){wi(t,"object",1,e),e&&(Di(t,e,["source"]),Ii(t,0,"source",e.source,["default","server","cache"]))}function Us(t,e,n){if(e instanceof Yi){if(e.firestore!==n)throw new P(k.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw Si(t,"DocumentReference",1,e)}function Cs(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return v()}}function Ms(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Fs={Firestore:ws,GeoPoint:Ki,Timestamp:L,Blob:Vi,Transaction:bs,WriteBatch:Is,DocumentReference:Es,DocumentSnapshot:As,Query:Ss,QueryDocumentSnapshot:xs,QuerySnapshot:Ps,CollectionReference:Ls,FieldPath:Ci,FieldValue:Wi,setLogLevel:ws.setLogLevel,CACHE_SIZE_UNLIMITED:gs};function qs(t){!function(t,e){t.INTERNAL.registerComponent(new c.Component("firestore",(function(t){return function(t,e){return new ws(t,e,new ls)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))}),"PUBLIC").setServiceProps(Object.assign({},Fs)))}(t),t.registerVersion("@firebase/firestore","1.16.1")}qs(o),e.__PRIVATE_registerFirestore=qs}).call(this,n("8oxB"))}}]);